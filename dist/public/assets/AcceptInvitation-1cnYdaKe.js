import{m as e,e as a,a1 as s,r as t,n,f as i,j as r,C as l,c as o,o as c,B as m,L as d,a as h,a2 as u,b as x,g as p,A as j,h as g,l as v,I as w,p as f,d as N}from"./index-C_9oFDzq.js";function y(){const[,y]=e(),{toast:_}=a(),{t:b}=s(),[P,C]=t.useState(""),[F,k]=t.useState({username:"",password:"",confirmPassword:"",fullName:""}),[q,E]=t.useState([]);t.useEffect((()=>{const e=new URLSearchParams(window.location.search).get("token");e&&C(e)}),[]);const{data:L,isLoading:S,error:I}=n({queryKey:["invitation",P],queryFn:async()=>{if(!P)throw new Error("No token provided");const e=await N("GET",`/api/team/invitations/verify?token=${P}`);if(!e.ok){const a=await e.json();throw new Error(a.message||"Failed to verify invitation")}return e.json()},enabled:!!P,retry:!1}),A=i({mutationFn:async e=>{const a=await N("POST","/api/team/invitations/accept",{token:P,username:e.username,password:e.password,fullName:e.fullName});if(!a.ok){const e=await a.json();throw new Error(e.message||"Failed to accept invitation")}return a.json()},onSuccess:e=>{_({title:b("auth.welcome_team","Welcome to the team!"),description:b("auth.account_created_success","Your account has been created successfully. You are now logged in.")}),y("/")},onError:e=>{_({title:b("common.error","Error"),description:e.message,variant:"destructive"})}}),T=e=>a=>{k((s=>({...s,[e]:a.target.value}))),q.length>0&&E([])};return P?S?r.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:r.jsx(l,{className:"w-full max-w-md",children:r.jsx(o,{className:"pt-6",children:r.jsxs("div",{className:"text-center",children:[r.jsx(d,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),r.jsx("p",{className:"text-gray-600",children:b("auth.verifying_invitation","Verifying invitation...")})]})})})}):I||!L?r.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:r.jsx(l,{className:"w-full max-w-md",children:r.jsx(o,{className:"pt-6",children:r.jsxs("div",{className:"text-center",children:[r.jsx(c,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),r.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-2",children:b("auth.invitation_not_found_title","Invitation Not Found")}),r.jsx("p",{className:"text-gray-600 mb-4",children:(null==I?void 0:I.message)||b("auth.invitation_not_found_desc","This invitation link is invalid, expired, or has already been used.")}),r.jsx(m,{onClick:()=>y("/auth"),variant:"outline",children:b("auth.go_to_login","Go to Login")})]})})})}):r.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:r.jsxs(l,{className:"w-full max-w-md",children:[r.jsxs(h,{className:"text-center",children:[r.jsx("div",{className:"mx-auto mb-4",children:r.jsx(u,{className:"h-12 w-12 text-blue-600"})}),r.jsx(x,{className:"text-2xl",children:b("auth.accept_invitation_title","Accept Team Invitation")}),r.jsxs(p,{children:[b("auth.invited_as_role","You've been invited to join as a {{role}}",{role:L.role}),r.jsx("br",{}),r.jsx("span",{className:"text-sm text-gray-500",children:L.email})]})]}),r.jsxs(o,{children:[r.jsxs("form",{onSubmit:e=>{e.preventDefault();const a=[];(!F.username||F.username.length<3)&&a.push(b("auth.validation.username_min_length","Username must be at least 3 characters long")),(!F.password||F.password.length<6)&&a.push(b("auth.validation.password_min_length","Password must be at least 6 characters long")),F.password!==F.confirmPassword&&a.push(b("auth.validation.passwords_no_match","Passwords do not match")),F.fullName&&0!==F.fullName.trim().length||a.push(b("auth.validation.full_name_required","Full name is required")),E(a),0===a.length&&A.mutate(F)},className:"space-y-4",children:[q.length>0&&r.jsx(j,{variant:"destructive",children:r.jsx(g,{children:r.jsx("ul",{className:"list-disc list-inside space-y-1",children:q.map(((e,a)=>r.jsx("li",{children:e},a)))})})}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(v,{htmlFor:"fullName",children:b("auth.full_name","Full Name")}),r.jsx(w,{id:"fullName",type:"text",placeholder:b("auth.enter_full_name","Enter your full name"),value:F.fullName,onChange:T("fullName"),required:!0})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(v,{htmlFor:"username",children:b("auth.username","Username")}),r.jsx(w,{id:"username",type:"text",placeholder:b("auth.choose_username","Choose a username"),value:F.username,onChange:T("username"),required:!0,minLength:3})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(v,{htmlFor:"password",children:b("auth.password","Password")}),r.jsx(w,{id:"password",type:"password",placeholder:b("auth.create_password","Create a password"),value:F.password,onChange:T("password"),required:!0,minLength:6})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(v,{htmlFor:"confirmPassword",children:b("auth.confirm_password","Confirm Password")}),r.jsx(w,{id:"confirmPassword",type:"password",placeholder:b("auth.confirm_password_placeholder","Confirm your password"),value:F.confirmPassword,onChange:T("confirmPassword"),required:!0})]}),r.jsx(m,{type:"submit",className:"w-full",disabled:A.isPending,children:A.isPending?r.jsxs(r.Fragment,{children:[r.jsx(d,{className:"h-4 w-4 animate-spin mr-2"}),b("auth.creating_account","Creating Account...")]}):r.jsxs(r.Fragment,{children:[r.jsx(f,{className:"h-4 w-4 mr-2"}),b("auth.accept_invitation_button","Accept Invitation & Create Account")]})})]}),r.jsx("div",{className:"mt-6 text-center",children:r.jsx("p",{className:"text-xs text-gray-500",children:b("auth.invitation_agreement","By accepting this invitation, you agree to join the team and follow the company's policies.")})})]})]})}):r.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:r.jsx(l,{className:"w-full max-w-md",children:r.jsx(o,{className:"pt-6",children:r.jsxs("div",{className:"text-center",children:[r.jsx(c,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),r.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-2",children:b("auth.invalid_invitation_title","Invalid Invitation Link")}),r.jsx("p",{className:"text-gray-600 mb-4",children:b("auth.invalid_invitation_desc","The invitation link is missing or invalid. Please check your email and try again.")}),r.jsx(m,{onClick:()=>y("/auth"),variant:"outline",children:b("auth.go_to_login","Go to Login")})]})})})})}export{y as default};
