import{u as s,r as e,j as a,R as l,B as n,C as i,a as t,b as r,c as d,d as c}from"./index-Du4k3PvU.js";function o(){var o;const{user:m,isLoading:u}=s(),[x,h]=e.useState(null),[g,p]=e.useState(!1),[j,y]=e.useState(null);if(u)return a.jsx("div",{children:"Loading..."});if(!m)return a.jsx(l,{to:"/login"});const b=async()=>{p(!0),y(null);try{const s=await c("GET","/api/debug/pipeline-stages"),e=await s.json();h(e)}catch(s){y(s.message)}finally{p(!1)}};return a.jsxs("div",{className:"container mx-auto p-6",children:[a.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Pipeline Debug Page"}),a.jsxs("div",{className:"grid gap-4 mb-6",children:[a.jsx(n,{onClick:b,disabled:g,children:g?"Loading...":"Fetch Debug Data"}),null===(null==(o=null==x?void 0:x.user)?void 0:o.companyId)&&a.jsx(n,{onClick:async()=>{var s,e;p(!0),y(null);try{const a=null==(e=null==(s=null==x?void 0:x.allCompanies)?void 0:s[0])?void 0:e.id;if(!a)return void y("No companies available to associate with");const l=await c("POST","/api/debug/fix-user-company",{companyId:a}),n=await l.json();console.log("User company fixed:",n),await b()}catch(a){y(a.message)}finally{p(!1)}},disabled:g,variant:"destructive",children:"Fix User Company Association"}),a.jsx(n,{onClick:async()=>{var s,e,a;p(!0),y(null);try{const l=(null==(s=null==x?void 0:x.user)?void 0:s.companyId)||(null==(a=null==(e=null==x?void 0:x.allCompanies)?void 0:e[0])?void 0:a.id),n=await c("POST","/api/debug/create-default-stages",{companyId:l}),i=await n.json();console.log("Default stages created:",i),await b()}catch(l){y(l.message)}finally{p(!1)}},disabled:g,variant:"outline",children:"Create Default Stages"}),a.jsx(n,{onClick:async()=>{p(!0),y(null);try{const s=await c("POST","/api/pipeline/stages",{name:"Test Stage",color:"#FF5733",order:1}),e=await s.json();console.log("Test stage created:",e),await b()}catch(s){y(s.message)}finally{p(!1)}},disabled:g,variant:"secondary",children:"Test Stage Creation"})]}),j&&a.jsxs(i,{className:"mb-6 border-red-200",children:[a.jsx(t,{children:a.jsx(r,{className:"text-red-600",children:"Error"})}),a.jsx(d,{children:a.jsx("p",{className:"text-red-600",children:j})})]}),x&&a.jsxs(i,{children:[a.jsx(t,{children:a.jsx(r,{children:"Debug Information"})}),a.jsx(d,{children:a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold",children:"Current User (Session):"}),a.jsx("pre",{className:"bg-gray-100 p-2 rounded text-sm",children:JSON.stringify(x.user,null,2)})]}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold",children:"Database User:"}),a.jsx("pre",{className:"bg-gray-100 p-2 rounded text-sm",children:JSON.stringify(x.dbUser,null,2)})]}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold",children:"User's Company:"}),a.jsx("pre",{className:"bg-gray-100 p-2 rounded text-sm",children:JSON.stringify(x.company,null,2)})]}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold",children:"All Companies:"}),a.jsx("pre",{className:"bg-gray-100 p-2 rounded text-sm",children:JSON.stringify(x.allCompanies,null,2)})]}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold",children:"Statistics:"}),a.jsxs("p",{children:["All stages in DB: ",x.allStages]}),a.jsxs("p",{children:["Company stages: ",x.companyStages]})]}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold",children:"Company Pipeline Stages:"}),a.jsx("pre",{className:"bg-gray-100 p-2 rounded text-sm",children:JSON.stringify(x.stages,null,2)})]})]})})]})]})}export{o as default};
