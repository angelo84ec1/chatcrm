import{u as s,e,r as a,n as i,j as n,L as r,al as l,B as d,a2 as t,C as c,a as o,b as m,g as h,c as u,an as x,I as j,aI as p,aJ as w,aK as N,aL as f,aM as y,aN as v,aO as C,ao as g,ap as b,aq as L,ar as S,as as A,at as E,aj as F,d as k}from"./index-C_9oFDzq.js";function q(){const{user:q,isLoading:P}=s(),{toast:T}=e(),[U,I]=a.useState(""),[K,R]=a.useState(null);a.useEffect((()=>{P||!q||q.isSuperAdmin||(window.location.href="/")}),[q,P]);const{data:$,isLoading:z}=i({queryKey:["/api/admin/users"],queryFn:async()=>{const s=await k("GET","/api/admin/users");if(!s.ok)throw new Error("Failed to fetch users");return s.json()},enabled:!!(null==q?void 0:q.isSuperAdmin)}),{data:G}=i({queryKey:["/api/admin/companies"],queryFn:async()=>{const s=await k("GET","/api/admin/companies");if(!s.ok)throw new Error("Failed to fetch companies");return s.json()},enabled:!!(null==q?void 0:q.isSuperAdmin)}),M=null==$?void 0:$.filter((s=>{const e=s.fullName.toLowerCase().includes(U.toLowerCase())||s.username.toLowerCase().includes(U.toLowerCase())||s.email.toLowerCase().includes(U.toLowerCase())||s.role.toLowerCase().includes(U.toLowerCase()),a=null===K||s.companyId===K;return e&&a}));return P?n.jsx("div",{className:"flex items-center justify-center min-h-screen",children:n.jsx(r,{className:"h-8 w-8 animate-spin text-primary"})}):(null==q?void 0:q.isSuperAdmin)?n.jsx(l,{children:n.jsxs("div",{className:"p-6",children:[n.jsxs("div",{className:"flex justify-between items-center mb-6",children:[n.jsx("h1",{className:"text-2xl",children:"Users"}),n.jsxs(d,{onClick:()=>window.location.href="/admin/users/new",variant:"brand",className:"btn-brand-primary",children:[n.jsx(t,{className:"mr-2 h-4 w-4"}),"New User"]})]}),n.jsxs(c,{className:"mb-6",children:[n.jsxs(o,{children:[n.jsx(m,{children:"Manage Users"}),n.jsx(h,{children:"View and manage all users in the system"})]}),n.jsxs(u,{children:[n.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[n.jsxs("div",{className:"relative flex-1",children:[n.jsx(x,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),n.jsx(j,{placeholder:"Search users...",className:"pl-8",value:U,onChange:s=>I(s.target.value)})]}),n.jsxs(p,{children:[n.jsx(w,{asChild:!0,children:n.jsxs(d,{variant:"outline",className:"gap-2",children:[n.jsx(N,{className:"h-4 w-4"}),null!==K?"Filtered":"Filter"]})}),n.jsxs(f,{align:"end",className:"w-56",children:[n.jsx(y,{children:"Filter by Company"}),n.jsx(v,{}),n.jsx(C,{onClick:()=>R(null),children:"All Companies"}),null==G?void 0:G.map((s=>n.jsx(C,{onClick:()=>R(s.id),children:s.name},s.id)))]})]})]}),z?n.jsx("div",{className:"flex justify-center py-8",children:n.jsx(r,{className:"h-8 w-8 animate-spin text-primary"})}):0===(null==M?void 0:M.length)?n.jsx("div",{className:"text-center py-8 text-muted-foreground",children:U||null!==K?"No users match your search":"No users found."}):n.jsx("div",{className:"rounded-md border",children:n.jsxs(g,{children:[n.jsx(b,{children:n.jsxs(L,{children:[n.jsx(S,{children:"Name"}),n.jsx(S,{children:"Email"}),n.jsx(S,{children:"Role"}),n.jsx(S,{children:"Company"}),n.jsx(S,{children:"Actions"})]})}),n.jsx(A,{children:null==M?void 0:M.map((s=>n.jsxs(L,{children:[n.jsx(E,{className:"font-medium",children:s.fullName}),n.jsx(E,{children:s.email}),n.jsx(E,{children:s.isSuperAdmin?n.jsx(F,{className:"bg-purple-100 text-purple-800 hover:bg-purple-100",children:"Super Admin"}):n.jsx(F,{variant:"outline",className:"capitalize",children:s.role})}),n.jsx(E,{children:s.companyName||"System"}),n.jsx(E,{children:n.jsxs(p,{children:[n.jsx(w,{asChild:!0,children:n.jsx(d,{variant:"ghost",size:"sm",className:"btn-brand-primary",children:"Actions"})}),n.jsxs(f,{align:"end",children:[n.jsx(C,{onClick:()=>window.location.href=`/admin/users/${s.id}`,children:"Edit User"}),n.jsx(C,{onClick:()=>(async s=>{try{const e=await k("POST",`/api/admin/users/${s}/reset-password`,{});if(!e.ok){const s=await e.json();throw new Error(s.message||"Failed to reset password")}const a=await e.json();T({title:"Password Reset",description:`Temporary password: ${a.temporaryPassword}`})}catch(e){T({title:"Error",description:e.message||"Failed to reset password",variant:"destructive"})}})(s.id),children:"Reset Password"})]})]})})]},s.id)))})]})})]})]})]})}):null}export{q as default};
