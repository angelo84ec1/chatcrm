import{u as s,f as e,r as a,h as i,j as r,L as n,K as l,B as d,U as t,C as c,a as o,b as m,l as h,c as u,N as x,I as j,ab as p,ac as w,ad as f,ae as N,af as y,ag as v,ah as C,O as g,Q as b,V as L,W as S,X as A,Y as E,H as F,d as k}from"./index-Du4k3PvU.js";function U(){const{user:U,isLoading:q}=s(),{toast:P}=e(),[T,K]=a.useState(""),[R,$]=a.useState(null);a.useEffect((()=>{q||!U||U.isSuperAdmin||(window.location.href="/")}),[U,q]);const{data:z,isLoading:G}=i({queryKey:["/api/admin/users"],queryFn:async()=>{const s=await k("GET","/api/admin/users");if(!s.ok)throw new Error("Failed to fetch users");return s.json()},enabled:!!(null==U?void 0:U.isSuperAdmin)}),{data:I}=i({queryKey:["/api/admin/companies"],queryFn:async()=>{const s=await k("GET","/api/admin/companies");if(!s.ok)throw new Error("Failed to fetch companies");return s.json()},enabled:!!(null==U?void 0:U.isSuperAdmin)}),O=null==z?void 0:z.filter((s=>{const e=s.fullName.toLowerCase().includes(T.toLowerCase())||s.username.toLowerCase().includes(T.toLowerCase())||s.email.toLowerCase().includes(T.toLowerCase())||s.role.toLowerCase().includes(T.toLowerCase()),a=null===R||s.companyId===R;return e&&a}));return q?r.jsx("div",{className:"flex items-center justify-center min-h-screen",children:r.jsx(n,{className:"h-8 w-8 animate-spin text-primary"})}):(null==U?void 0:U.isSuperAdmin)?r.jsx(l,{children:r.jsxs("div",{className:"p-6",children:[r.jsxs("div",{className:"flex justify-between items-center mb-6",children:[r.jsx("h1",{className:"text-2xl",children:"Users"}),r.jsxs(d,{onClick:()=>window.location.href="/admin/users/new",variant:"brand",className:"btn-brand-primary",children:[r.jsx(t,{className:"mr-2 h-4 w-4"}),"New User"]})]}),r.jsxs(c,{className:"mb-6",children:[r.jsxs(o,{children:[r.jsx(m,{children:"Manage Users"}),r.jsx(h,{children:"View and manage all users in the system"})]}),r.jsxs(u,{children:[r.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[r.jsxs("div",{className:"relative flex-1",children:[r.jsx(x,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),r.jsx(j,{placeholder:"Search users...",className:"pl-8",value:T,onChange:s=>K(s.target.value)})]}),r.jsxs(p,{children:[r.jsx(w,{asChild:!0,children:r.jsxs(d,{variant:"outline",className:"gap-2",children:[r.jsx(f,{className:"h-4 w-4"}),null!==R?"Filtered":"Filter"]})}),r.jsxs(N,{align:"end",className:"w-56",children:[r.jsx(y,{children:"Filter by Company"}),r.jsx(v,{}),r.jsx(C,{onClick:()=>$(null),children:"All Companies"}),null==I?void 0:I.map((s=>r.jsx(C,{onClick:()=>$(s.id),children:s.name},s.id)))]})]})]}),G?r.jsx("div",{className:"flex justify-center py-8",children:r.jsx(n,{className:"h-8 w-8 animate-spin text-primary"})}):0===(null==O?void 0:O.length)?r.jsx("div",{className:"text-center py-8 text-muted-foreground",children:T||null!==R?"No users match your search":"No users found."}):r.jsx("div",{className:"rounded-md border",children:r.jsxs(g,{children:[r.jsx(b,{children:r.jsxs(L,{children:[r.jsx(S,{children:"Name"}),r.jsx(S,{children:"Email"}),r.jsx(S,{children:"Role"}),r.jsx(S,{children:"Company"}),r.jsx(S,{children:"Actions"})]})}),r.jsx(A,{children:null==O?void 0:O.map((s=>r.jsxs(L,{children:[r.jsx(E,{className:"font-medium",children:s.fullName}),r.jsx(E,{children:s.email}),r.jsx(E,{children:s.isSuperAdmin?r.jsx(F,{className:"bg-purple-100 text-purple-800 hover:bg-purple-100",children:"Super Admin"}):r.jsx(F,{variant:"outline",className:"capitalize",children:s.role})}),r.jsx(E,{children:s.companyName||"System"}),r.jsx(E,{children:r.jsxs(p,{children:[r.jsx(w,{asChild:!0,children:r.jsx(d,{variant:"ghost",size:"sm",className:"btn-brand-primary",children:"Actions"})}),r.jsxs(N,{align:"end",children:[r.jsx(C,{onClick:()=>window.location.href=`/admin/users/${s.id}`,children:"Edit User"}),r.jsx(C,{onClick:()=>(async s=>{try{const e=await k("POST",`/api/admin/users/${s}/reset-password`,{});if(!e.ok){const s=await e.json();throw new Error(s.message||"Failed to reset password")}const a=await e.json();P({title:"Password Reset",description:`Temporary password: ${a.temporaryPassword}`})}catch(e){P({title:"Error",description:e.message||"Failed to reset password",variant:"destructive"})}})(s.id),children:"Reset Password"})]})]})})]},s.id)))})]})})]})]})]})}):null}export{U as default};
