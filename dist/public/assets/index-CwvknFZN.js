import{q as e,f as s,g as a,bC as n,r as i,h as t,i as r,aO as l,j as c,L as d,aF as o,aG as m,aH as u,aI as h,C as p,c as x,a as g,b as j,l as b,n as v,I as f,aq as y,ar as k,as as N,at as w,au as _,B as C,bD as S,O as P,Q as F,V as E,W as T,X as M,Y as D,H as q,bj as I,bE as A,bF as B,a3 as O,aE as U,T as K,a4 as R,a5 as G,a6 as L,a7 as z,a8 as Y,a9 as V,aa as Q,P as W,S as $,k as H,o as J,bs as X,bG as Z,aw as ee,bz as se,bH as ae,y as ne,D as ie,t as te,v as re,w as le,x as ce,E as de,bI as oe,s as me,d as ue,bJ as he,A as pe,m as xe,bK as ge,a0 as je,bL as be,u as ve,bv as fe,bM as ye,e as ke,K as Ne,G as we,br as _e,bN as Ce,U as Se,aK as Pe,bO as Fe}from"./index-Cy_6krSr.js";import{D as Ee}from"./database-BGWuQcAS.js";const Te=e("Cloud",[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]]),Me=e("FileImage",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["circle",{cx:"10",cy:"12",r:"2",key:"737tya"}],["path",{d:"m20 17-1.296-1.296a2.41 2.41 0 0 0-3.408 0L9 22",key:"wt3hpn"}]]),De=e("HardDrive",[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]]),qe=e("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]),Ie=e("TestTube",[["path",{d:"M14.5 2v17.5c0 1.4-1.1 2.5-2.5 2.5c-1.4 0-2.5-1.1-2.5-2.5V2",key:"125lnx"}],["path",{d:"M8.5 2h7",key:"csnxdl"}],["path",{d:"M14.5 16h-5",key:"1ox875"}]]);function Ae(){var e,he,pe,xe,ge,je;const{toast:be}=s(),{t:ve}=a(),{branding:fe}=n(),[ye,ke]=i.useState("overview"),[Ne,we]=i.useState(""),[_e,Ce]=i.useState(["local"]),[Se,Pe]=i.useState(!1),[Fe,Me]=i.useState(null),[qe,Ie]=i.useState("warning"),[Ae,Be]=i.useState(""),[Oe,Ue]=i.useState(null),[Ke,Re]=i.useState(!1),[Ge,Le]=i.useState(null),[ze,Ye]=i.useState({name:"",frequency:"daily",time:"02:00",day_of_week:0,day_of_month:1,storage_locations:["local"],enabled:!0}),[Ve,Qe]=i.useState({retention_days:30,default_storage_locations:["local"],google_drive:{enabled:!1,folder_id:null,credentials:null},encryption:{enabled:!1,key:null},notifications:{enabled:!1,email:"",on_success:!0,on_failure:!0},cleanup:{enabled:!0,time:"03:00"}}),[We,$e]=i.useState({client_id:"",client_secret:"",redirect_uri:"http://localhost:3000/admin/settings?tab=backup"}),[He,Je]=i.useState(!1),[Xe,Ze]=i.useState(!1),[es,ss]=i.useState({description:"",storage_locations:["local"],file:null}),[as,ns]=i.useState(0),[is,ts]=i.useState(!1),{data:rs,isLoading:ls}=t({queryKey:["/api/admin/backup/config"],queryFn:async()=>{const e=await ue("GET","/api/admin/backup/config");if(!e.ok)throw new Error("Failed to fetch backup configuration");return e.json()}}),{data:cs,isLoading:ds}=t({queryKey:["/api/admin/backup/list"],queryFn:async()=>{const e=await ue("GET","/api/admin/backup/list");if(!e.ok)throw new Error("Failed to fetch backups");return e.json()}}),{data:os,isLoading:ms}=t({queryKey:["/api/admin/backup/stats"],queryFn:async()=>{const e=await ue("GET","/api/admin/backup/stats");if(!e.ok)throw new Error("Failed to fetch backup statistics");return e.json()}}),{data:us,isLoading:hs}=t({queryKey:["/api/admin/backup/google-drive/oauth-config"],queryFn:async()=>{const e=await ue("GET","/api/admin/backup/google-drive/oauth-config");if(!e.ok)throw new Error("Failed to fetch OAuth configuration");return e.json()}}),ps=r({mutationFn:async()=>{const e=await ue("POST","/api/admin/backup/create",{description:Ne||ve("admin.backup.default_description","Manual backup"),storage_locations:_e});if(!e.ok)throw new Error("Failed to create backup");return e.json()},onSuccess:()=>{be({title:ve("common.success","Success"),description:ve("admin.backup.messages.backup_started","Backup creation started successfully")}),we(""),me.invalidateQueries({queryKey:["/api/admin/backup/list"]}),me.invalidateQueries({queryKey:["/api/admin/backup/stats"]})},onError:e=>{be({title:ve("common.error","Error"),description:e.message,variant:"destructive"})}}),xs=r({mutationFn:async e=>{const s=await ue("DELETE",`/api/admin/backup/${e}`);if(!s.ok)throw new Error("Failed to delete backup");return s.json()},onSuccess:()=>{be({title:ve("common.success","Success"),description:ve("admin.backup.messages.backup_deleted","Backup deleted successfully")}),me.invalidateQueries({queryKey:["/api/admin/backup/list"]}),me.invalidateQueries({queryKey:["/api/admin/backup/stats"]})},onError:e=>{be({title:ve("common.error","Error"),description:e.message,variant:"destructive"})}}),gs=r({mutationFn:async e=>{const s=await ue("POST",`/api/admin/backup/verify/${e}`);if(!s.ok)throw new Error("Failed to verify backup");return s.json()},onSuccess:e=>{be({title:e.valid?ve("admin.backup.messages.backup_valid","Backup Valid"):ve("admin.backup.messages.backup_invalid","Backup Invalid"),description:e.message,variant:e.valid?"default":"destructive"})},onError:e=>{be({title:ve("common.error","Error"),description:e.message,variant:"destructive"})}}),js=r({mutationFn:async({file:e,description:s,storage_locations:a})=>{const n=new FormData;return n.append("backup",e),n.append("description",s),n.append("storage_locations",JSON.stringify(a)),new Promise(((e,s)=>{const a=new XMLHttpRequest;a.upload.onprogress=e=>{if(e.lengthComputable){const s=Math.round(e.loaded/e.total*100);ns(s)}},a.onload=()=>{if(200===a.status)try{const s=JSON.parse(a.responseText);e(s)}catch(n){s(new Error("Invalid response format"))}else try{const e=JSON.parse(a.responseText);s(new Error(e.error||"Upload failed"))}catch(n){s(new Error(`Upload failed with status ${a.status}`))}},a.onerror=()=>s(new Error("Network error during upload")),a.open("POST","/api/admin/backup/upload"),a.send(n)}))},onMutate:()=>{ts(!0),ns(0)},onSuccess:()=>{be({title:ve("common.success","Success"),description:ve("admin.backup.messages.backup_uploaded","Backup uploaded successfully")}),Ze(!1),ks(),me.invalidateQueries({queryKey:["/api/admin/backup/list"]}),me.invalidateQueries({queryKey:["/api/admin/backup/stats"]})},onError:e=>{be({title:ve("common.error","Error"),description:e.message,variant:"destructive"})},onSettled:()=>{ts(!1),ns(0)}}),bs=r({mutationFn:async({backupId:e,confirmationText:s})=>{Ue({status:"downloading",message:ve("admin.backup.restore.preparing","Preparing restoration...")});const a=await ue("POST",`/api/admin/backup/restore/${e}`,{confirmationText:s});if(!a.ok)throw new Error("Failed to restore backup");return a.json()},onSuccess:e=>{e.success?(Ue({status:"completed",message:e.message}),be({title:ve("admin.backup.messages.restore_successful","Restore Successful"),description:e.message}),setTimeout((()=>{me.invalidateQueries({queryKey:["/api/admin/backup/list"]}),me.invalidateQueries({queryKey:["/api/admin/backup/stats"]}),Pe(!1),vs()}),3e3)):(Ue({status:"failed",message:e.message}),be({title:ve("admin.backup.messages.restore_failed","Restore Failed"),description:e.message,variant:"destructive"}))},onError:e=>{Ue({status:"failed",message:e.message}),be({title:ve("admin.backup.messages.restore_error","Restore Error"),description:e.message,variant:"destructive"})}}),vs=()=>{Me(null),Ie("warning"),Be(""),Ue(null)},fs=e=>"creating"===e.status||"failed"===e.status||"uploading"===e.status,ys=()=>(null==Fe?void 0:Fe.filename)||"RESTORE",ks=()=>{ss({description:"",storage_locations:["local"],file:null}),ns(0),ts(!1)},Ns=r({mutationFn:async e=>{var s;const a={...rs,schedules:Ge?(null==(s=null==rs?void 0:rs.schedules)?void 0:s.map((s=>s.id===Ge.id?{...e,id:Ge.id}:s)))||[]:[...(null==rs?void 0:rs.schedules)||[],{...e,id:crypto.randomUUID()}]},n=await ue("POST","/api/admin/backup/config",a);if(!n.ok)throw new Error("Failed to save schedule");return n.json()},onSuccess:()=>{be({title:ve("common.success","Success"),description:Ge?ve("admin.backup.messages.schedule_updated","Schedule updated successfully"):ve("admin.backup.messages.schedule_created","Schedule created successfully")}),Re(!1),Ms(),me.invalidateQueries({queryKey:["/api/admin/backup/config"]})},onError:e=>{be({title:ve("common.error","Error"),description:e.message,variant:"destructive"})}}),ws=r({mutationFn:async e=>{var s;const a={...rs,schedules:(null==(s=null==rs?void 0:rs.schedules)?void 0:s.filter((s=>s.id!==e)))||[]},n=await ue("POST","/api/admin/backup/config",a);if(!n.ok)throw new Error("Failed to delete schedule");return n.json()},onSuccess:()=>{be({title:ve("common.success","Success"),description:ve("admin.backup.messages.schedule_deleted","Schedule deleted successfully")}),me.invalidateQueries({queryKey:["/api/admin/backup/config"]})},onError:e=>{be({title:ve("common.error","Error"),description:e.message,variant:"destructive"})}}),_s=r({mutationFn:async({scheduleId:e,enabled:s})=>{var a;const n={...rs,schedules:(null==(a=null==rs?void 0:rs.schedules)?void 0:a.map((a=>a.id===e?{...a,enabled:s}:a)))||[]},i=await ue("POST","/api/admin/backup/config",n);if(!i.ok)throw new Error("Failed to update schedule");return i.json()},onSuccess:()=>{me.invalidateQueries({queryKey:["/api/admin/backup/config"]})},onError:e=>{be({title:ve("common.error","Error"),description:e.message,variant:"destructive"})}}),Cs=r({mutationFn:async e=>{const s=await ue("POST","/api/admin/backup/config",e);if(!s.ok)throw new Error("Failed to save settings");return s.json()},onSuccess:()=>{be({title:ve("common.success","Success"),description:ve("admin.backup.messages.settings_saved","Settings saved successfully")}),me.invalidateQueries({queryKey:["/api/admin/backup/config"]})},onError:e=>{be({title:ve("common.error","Error"),description:e.message,variant:"destructive"})}}),Ss=r({mutationFn:async()=>{const e=await ue("POST","/api/admin/backup/google-drive/test");if(!e.ok)throw new Error("Failed to test Google Drive connection");return e.json()},onSuccess:e=>{be({title:e.success?ve("admin.backup.messages.connection_successful","Connection Successful"):ve("admin.backup.messages.connection_failed","Connection Failed"),description:e.message,variant:e.success?"default":"destructive"})},onError:e=>{be({title:ve("common.error","Error"),description:e.message,variant:"destructive"})}}),Ps=r({mutationFn:async e=>{const s=await ue("POST","/api/admin/backup/google-drive/oauth-config",e);if(!s.ok)throw new Error("Failed to save OAuth configuration");return s.json()},onSuccess:e=>{e.success?(be({title:ve("common.success","Success"),description:e.message}),Je(!1),me.invalidateQueries({queryKey:["/api/admin/backup/google-drive/oauth-config"]}),me.invalidateQueries({queryKey:["/api/admin/backup/config"]})):be({title:ve("common.error","Error"),description:e.message,variant:"destructive"})},onError:e=>{be({title:ve("common.error","Error"),description:e.message,variant:"destructive"})}}),Fs=r({mutationFn:async()=>{const e=await ue("DELETE","/api/admin/backup/google-drive/oauth-config");if(!e.ok)throw new Error("Failed to clear OAuth configuration");return e.json()},onSuccess:e=>{e.success?(be({title:ve("common.success","Success"),description:e.message}),me.invalidateQueries({queryKey:["/api/admin/backup/google-drive/oauth-config"]}),me.invalidateQueries({queryKey:["/api/admin/backup/config"]})):be({title:ve("common.error","Error"),description:e.message,variant:"destructive"})},onError:e=>{be({title:ve("common.error","Error"),description:e.message,variant:"destructive"})}}),Es=r({mutationFn:async()=>{const e=await ue("POST","/api/admin/backup/google-drive/oauth-validate");if(!e.ok)throw new Error("Failed to validate OAuth configuration");return e.json()},onSuccess:e=>{be({title:e.valid?ve("admin.backup.messages.validation_successful","Validation Successful"):ve("admin.backup.messages.validation_failed","Validation Failed"),description:e.message,variant:e.valid?"default":"destructive"})},onError:e=>{be({title:ve("common.error","Error"),description:e.message,variant:"destructive"})}}),Ts=e=>{e?(Le(e),Ye({name:e.id,frequency:e.frequency,time:e.time,day_of_week:e.day_of_week||0,day_of_month:e.day_of_month||1,storage_locations:e.storage_locations,enabled:e.enabled})):(Le(null),Ms()),Re(!0)},Ms=()=>{Ye({name:"",frequency:"daily",time:"02:00",day_of_week:0,day_of_month:1,storage_locations:["local"],enabled:!0})},Ds=()=>{$e({client_id:"",client_secret:"",redirect_uri:"http://localhost:3000/admin/settings?tab=backup"}),Je(!1)};l.useEffect((()=>{rs&&Qe({retention_days:rs.retention_days||30,default_storage_locations:rs.storage_locations||["local"],google_drive:rs.google_drive||{enabled:!1,folder_id:null,credentials:null},encryption:rs.encryption||{enabled:!1,key:null},notifications:{enabled:!1,email:"",on_success:!0,on_failure:!0},cleanup:{enabled:!0,time:"03:00"}})}),[rs]),l.useEffect((()=>{us&&us.configured&&$e({client_id:us.client_id||"",client_secret:"",redirect_uri:us.redirect_uri||"http://localhost:3000/admin/settings?tab=backup"})}),[us]);const qs=e=>{if(0===e)return`0 ${ve("common.file_size.bytes","Bytes")}`;const s=[ve("common.file_size.bytes","Bytes"),ve("common.file_size.kb","KB"),ve("common.file_size.mb","MB"),ve("common.file_size.gb","GB"),ve("common.file_size.tb","TB")],a=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,a)).toFixed(2))+" "+s[a]},Is=e=>new Date(e).toLocaleString(),As=e=>{const s={creating:{variant:"secondary",icon:d,text:ve("admin.backup.status.creating","Creating")},completed:{variant:"default",icon:J,text:ve("admin.backup.status.completed","Completed")},failed:{variant:"destructive",icon:H,text:ve("admin.backup.status.failed","Failed")},uploading:{variant:"secondary",icon:Te,text:ve("admin.backup.status.uploading","Uploading")},uploaded:{variant:"default",icon:Te,text:ve("admin.backup.status.uploaded","Uploaded")}},a=s[e]||s.completed,n=a.icon;return c.jsxs(q,{variant:a.variant,className:"flex items-center gap-1",children:[c.jsx(n,{className:"h-3 w-3"}),a.text]})};return ls||ds||ms||hs?c.jsxs("div",{className:"flex items-center justify-center py-8",children:[c.jsx(d,{className:"h-8 w-8 animate-spin mr-2"}),c.jsx("span",{children:ve("admin.backup.loading","Loading backup system...")})]}):c.jsxs("div",{className:"space-y-6",children:[c.jsxs(o,{value:ye,onValueChange:ke,children:[c.jsxs(m,{className:"grid w-full grid-cols-4",children:[c.jsx(u,{value:"overview",children:ve("admin.backup.tabs.overview","Overview")}),c.jsx(u,{value:"backups",children:ve("admin.backup.tabs.backups","Backups")}),c.jsx(u,{value:"schedules",children:ve("admin.backup.tabs.schedules","Schedules")}),c.jsx(u,{value:"settings",children:ve("admin.backup.tabs.settings","Settings")})]}),c.jsxs(h,{value:"overview",className:"space-y-6",children:[c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[c.jsx(p,{children:c.jsx(x,{className:"p-6",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{children:[c.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:ve("admin.backup.stats.total_backups","Total Backups")}),c.jsx("p",{className:"text-2xl font-bold",children:(null==os?void 0:os.total_backups)||0})]}),c.jsx(Ee,{className:"h-8 w-8 text-muted-foreground"})]})})}),c.jsx(p,{children:c.jsx(x,{className:"p-6",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{children:[c.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:ve("admin.backup.stats.total_size","Total Size")}),c.jsx("p",{className:"text-2xl font-bold",children:qs((null==os?void 0:os.total_size)||0)})]}),c.jsx(De,{className:"h-8 w-8 text-muted-foreground"})]})})}),c.jsx(p,{children:c.jsx(x,{className:"p-6",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{children:[c.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:ve("admin.backup.stats.local_backups","Local Backups")}),c.jsx("p",{className:"text-2xl font-bold",children:(null==os?void 0:os.local_backups)||0})]}),c.jsx(De,{className:"h-8 w-8 text-muted-foreground"})]})})}),c.jsx(p,{children:c.jsx(x,{className:"p-6",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{children:[c.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:ve("admin.backup.stats.cloud_backups","Cloud Backups")}),c.jsx("p",{className:"text-2xl font-bold",children:(null==os?void 0:os.cloud_backups)||0})]}),c.jsx(Te,{className:"h-8 w-8 text-muted-foreground"})]})})})]}),c.jsxs(p,{children:[c.jsxs(g,{children:[c.jsx(j,{children:ve("admin.backup.quick_actions.title","Quick Actions")}),c.jsx(b,{children:ve("admin.backup.quick_actions.description","Create manual backups and manage your backup system")})]}),c.jsx(x,{className:"space-y-4",children:c.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[c.jsxs("div",{className:"flex-1",children:[c.jsx(v,{htmlFor:"manual-description",children:ve("admin.backup.quick_actions.backup_description","Backup Description")}),c.jsx(f,{id:"manual-description",placeholder:ve("admin.backup.quick_actions.backup_description_placeholder","Enter backup description..."),value:Ne,onChange:e=>we(e.target.value)})]}),c.jsxs("div",{className:"flex-1",children:[c.jsx(v,{children:ve("admin.backup.quick_actions.storage_locations","Storage Locations")}),c.jsxs(y,{value:_e[0],onValueChange:e=>Ce([e]),children:[c.jsx(k,{children:c.jsx(N,{})}),c.jsxs(w,{children:[c.jsx(_,{value:"local",children:ve("admin.backup.storage.local","Local Storage")}),c.jsxs(_,{value:"google_drive",disabled:!(null==(e=null==rs?void 0:rs.google_drive)?void 0:e.enabled),children:[ve("admin.backup.storage.google_drive","Google Drive")," ",!(null==(he=null==rs?void 0:rs.google_drive)?void 0:he.enabled)&&ve("admin.backup.storage.not_connected","(Not Connected)")]})]})]})]}),c.jsx("div",{className:"flex items-end",children:c.jsxs(C,{onClick:()=>ps.mutate(),disabled:ps.isPending,className:"w-full sm:w-auto",children:[ps.isPending?c.jsx(d,{className:"h-4 w-4 animate-spin mr-2"}):c.jsx(Ee,{className:"h-4 w-4 mr-2"}),ve("admin.backup.actions.create_backup","Create Backup")]})})]})})]})]}),c.jsxs(h,{value:"backups",className:"space-y-6",children:[c.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6",children:[c.jsxs("div",{children:[c.jsx("h2",{className:"text-2xl font-bold",children:ve("admin.backup.history.title","Backup History")}),c.jsx("p",{className:"text-muted-foreground",children:ve("admin.backup.history.description","View and manage all database backups")})]}),c.jsxs(C,{onClick:()=>Ze(!0),className:"flex items-center gap-2",disabled:is,children:[c.jsx(S,{className:"h-4 w-4"}),ve("admin.backup.actions.upload_backup","Upload Backup")]})]}),c.jsx(p,{children:c.jsx(x,{className:"pt-6",children:cs&&cs.length>0?c.jsxs(P,{children:[c.jsx(F,{children:c.jsxs(E,{children:[c.jsx(T,{children:ve("admin.backup.table.filename","Filename")}),c.jsx(T,{children:ve("admin.backup.table.type","Type")}),c.jsx(T,{children:ve("admin.backup.table.size","Size")}),c.jsx(T,{children:ve("admin.backup.table.status","Status")}),c.jsx(T,{children:ve("admin.backup.table.storage","Storage")}),c.jsx(T,{children:ve("admin.backup.table.created","Created")}),c.jsx(T,{children:ve("admin.backup.table.actions","Actions")})]})}),c.jsx(M,{children:cs.map((e=>c.jsxs(E,{children:[c.jsx(D,{className:"font-medium",children:c.jsxs("div",{children:[c.jsx("div",{children:e.filename}),c.jsx("div",{className:"text-sm text-muted-foreground",children:e.description})]})}),c.jsx(D,{children:c.jsx(q,{variant:"manual"===e.type?"default":"secondary",children:e.type})}),c.jsx(D,{children:qs(e.size)}),c.jsx(D,{children:As(e.status)}),c.jsx(D,{children:c.jsxs("div",{className:"flex gap-1",children:[e.storage_locations.includes("local")&&c.jsxs(q,{variant:"outline",className:"text-xs",children:[c.jsx(De,{className:"h-3 w-3 mr-1"}),ve("admin.backup.storage.local","Local")]}),e.storage_locations.includes("google_drive")&&c.jsxs(q,{variant:"outline",className:"text-xs",children:[c.jsx(Te,{className:"h-3 w-3 mr-1"}),ve("admin.backup.storage.drive","Drive")]})]})}),c.jsx(D,{children:Is(e.created_at)}),c.jsx(D,{children:c.jsxs("div",{className:"flex gap-2",children:[c.jsx(C,{size:"sm",variant:"outline",onClick:()=>window.open(`/api/admin/backup/download/${e.id}`,"_blank"),disabled:"completed"!==e.status&&"uploaded"!==e.status,title:ve("admin.backup.actions.download_backup","Download backup"),children:c.jsx(I,{className:"h-4 w-4"})}),c.jsx(C,{size:"sm",variant:"outline",onClick:()=>gs.mutate(e.id),disabled:gs.isPending||"completed"!==e.status,title:ve("admin.backup.actions.verify_backup","Verify backup integrity"),children:c.jsx(A,{className:"h-4 w-4"})}),c.jsx(C,{size:"sm",variant:"outline",onClick:()=>(e=>{Me(e),Pe(!0),Ie("warning"),Be(""),Ue(null)})(e),disabled:fs(e)||bs.isPending,title:ve("admin.backup.actions.restore_backup","Restore database from this backup"),className:"text-orange-600 hover:text-orange-700 hover:bg-orange-50",children:c.jsx(B,{className:"h-4 w-4"})}),c.jsxs(O,{children:[c.jsx(U,{asChild:!0,children:c.jsx(C,{size:"sm",variant:"outline",title:ve("admin.backup.actions.delete_backup","Delete backup"),children:c.jsx(K,{className:"h-4 w-4"})})}),c.jsxs(R,{children:[c.jsxs(G,{children:[c.jsx(L,{children:ve("admin.backup.dialogs.delete_backup_title","Delete Backup")}),c.jsx(z,{children:ve("admin.backup.dialogs.delete_backup_description","Are you sure you want to delete this backup? This action cannot be undone.")})]}),c.jsxs(Y,{children:[c.jsx(V,{children:ve("common.cancel","Cancel")}),c.jsx(Q,{onClick:()=>xs.mutate(e.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:ve("common.delete","Delete")})]})]})]})]})})]},e.id)))})]}):c.jsxs("div",{className:"text-center py-8",children:[c.jsx(Ee,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),c.jsx("h3",{className:"text-lg font-medium mb-2",children:ve("admin.backup.empty.title","No Backups Found")}),c.jsx("p",{className:"text-muted-foreground mb-4",children:ve("admin.backup.empty.description","Create your first backup to get started")}),c.jsx(C,{onClick:()=>ke("overview"),children:ve("admin.backup.actions.create_backup","Create Backup")})]})})})]}),c.jsxs(h,{value:"schedules",className:"space-y-6",children:[c.jsxs("div",{className:"flex justify-between items-center",children:[c.jsxs("div",{children:[c.jsx("h2",{className:"text-2xl font-bold",children:ve("admin.backup.schedules.title","Backup Schedules")}),c.jsx("p",{className:"text-muted-foreground",children:ve("admin.backup.schedules.description","Configure automated backup schedules")})]}),c.jsxs(C,{onClick:()=>Ts(),className:"flex items-center gap-2",children:[c.jsx(W,{className:"h-4 w-4"}),ve("admin.backup.schedules.new_schedule","New Schedule")]})]}),c.jsxs(p,{children:[c.jsxs(g,{children:[c.jsx(j,{children:ve("admin.backup.schedules.active_title","Active Schedules")}),c.jsx(b,{children:ve("admin.backup.schedules.active_description","Manage your automated backup schedules")})]}),c.jsx(x,{children:(null==rs?void 0:rs.schedules)&&rs.schedules.length>0?c.jsxs(P,{children:[c.jsx(F,{children:c.jsxs(E,{children:[c.jsx(T,{children:ve("admin.backup.schedules.table.name","Schedule Name")}),c.jsx(T,{children:ve("admin.backup.schedules.table.frequency","Frequency")}),c.jsx(T,{children:ve("admin.backup.schedules.table.time","Time")}),c.jsx(T,{children:ve("admin.backup.schedules.table.next_run","Next Run")}),c.jsx(T,{children:ve("admin.backup.schedules.table.storage","Storage")}),c.jsx(T,{children:ve("admin.backup.schedules.table.status","Status")}),c.jsx(T,{children:ve("admin.backup.schedules.table.actions","Actions")})]})}),c.jsx(M,{children:rs.schedules.map((e=>{const s=(e=>{const s=new Date,[a,n]=e.time.split(":").map(Number);let i=new Date;switch(i.setHours(a,n,0,0),e.frequency){case"daily":i<=s&&i.setDate(i.getDate()+1);break;case"weekly":let a=(e.day_of_week||0)-i.getDay();(a<=0||0===a&&i<=s)&&(a+=7),i.setDate(i.getDate()+a);break;case"monthly":const n=e.day_of_month||1;i.setDate(n),i<=s&&i.setMonth(i.getMonth()+1)}return i})(e);return c.jsxs(E,{children:[c.jsx(D,{className:"font-medium",children:e.id}),c.jsx(D,{children:c.jsxs("div",{className:"flex flex-col",children:[c.jsx("span",{className:"capitalize",children:e.frequency}),"weekly"===e.frequency&&c.jsx("span",{className:"text-xs text-muted-foreground",children:(a=e.day_of_week||0,[ve("admin.backup.days.sunday","Sunday"),ve("admin.backup.days.monday","Monday"),ve("admin.backup.days.tuesday","Tuesday"),ve("admin.backup.days.wednesday","Wednesday"),ve("admin.backup.days.thursday","Thursday"),ve("admin.backup.days.friday","Friday"),ve("admin.backup.days.saturday","Saturday")][a]||ve("admin.backup.days.sunday","Sunday"))}),"monthly"===e.frequency&&c.jsxs("span",{className:"text-xs text-muted-foreground",children:["Day ",e.day_of_month||1]})]})}),c.jsx(D,{children:e.time}),c.jsx(D,{children:c.jsxs("div",{className:"flex flex-col",children:[c.jsx("span",{children:s.toLocaleDateString()}),c.jsx("span",{className:"text-xs text-muted-foreground",children:s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})}),c.jsx(D,{children:c.jsxs("div",{className:"flex gap-1",children:[e.storage_locations.includes("local")&&c.jsxs(q,{variant:"outline",className:"text-xs",children:[c.jsx(De,{className:"h-3 w-3 mr-1"}),"Local"]}),e.storage_locations.includes("google_drive")&&c.jsxs(q,{variant:"outline",className:"text-xs",children:[c.jsx(Te,{className:"h-3 w-3 mr-1"}),"Drive"]})]})}),c.jsx(D,{children:c.jsx(q,{variant:e.enabled?"default":"secondary",children:e.enabled?ve("admin.backup.schedules.status.enabled","Enabled"):ve("admin.backup.schedules.status.disabled","Disabled")})}),c.jsx(D,{children:c.jsxs("div",{className:"flex gap-2",children:[c.jsx(C,{size:"sm",variant:"outline",onClick:()=>Ts(e),title:ve("admin.backup.actions.edit_schedule","Edit schedule"),children:c.jsx($,{className:"h-4 w-4"})}),c.jsx(C,{size:"sm",variant:"outline",onClick:()=>_s.mutate({scheduleId:e.id,enabled:!e.enabled}),title:e.enabled?ve("admin.backup.actions.disable_schedule","Disable schedule"):ve("admin.backup.actions.enable_schedule","Enable schedule"),children:e.enabled?c.jsx(H,{className:"h-4 w-4"}):c.jsx(J,{className:"h-4 w-4"})}),c.jsxs(O,{children:[c.jsx(U,{asChild:!0,children:c.jsx(C,{size:"sm",variant:"outline",title:ve("admin.backup.actions.delete_schedule","Delete schedule"),children:c.jsx(K,{className:"h-4 w-4"})})}),c.jsxs(R,{children:[c.jsxs(G,{children:[c.jsx(L,{children:ve("admin.backup.dialogs.delete_schedule_title","Delete Schedule")}),c.jsx(z,{children:ve("admin.backup.dialogs.delete_schedule_description","Are you sure you want to delete this backup schedule? This action cannot be undone.")})]}),c.jsxs(Y,{children:[c.jsx(V,{children:ve("common.cancel","Cancel")}),c.jsx(Q,{onClick:()=>ws.mutate(e.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:ve("common.delete","Delete")})]})]})]})]})})]},e.id);var a}))})]}):c.jsxs("div",{className:"text-center py-8",children:[c.jsx(X,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),c.jsx("h3",{className:"text-lg font-medium mb-2",children:ve("admin.backup.schedules.empty.title","No Schedules Configured")}),c.jsx("p",{className:"text-muted-foreground mb-4",children:ve("admin.backup.schedules.empty.description","Create your first automated backup schedule to get started")}),c.jsxs(C,{onClick:()=>Ts(),children:[c.jsx(W,{className:"h-4 w-4 mr-2"}),ve("admin.backup.schedules.actions.create","Create Schedule")]})]})})]})]}),c.jsxs(h,{value:"settings",className:"space-y-6",children:[c.jsxs(p,{children:[c.jsxs(g,{children:[c.jsx(j,{children:ve("admin.backup.settings.general_title","General Settings")}),c.jsx(b,{children:ve("admin.backup.settings.general_description","Configure global backup system preferences")})]}),c.jsxs(x,{className:"space-y-6",children:[c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx(v,{htmlFor:"retention-days",children:ve("admin.backup.settings.retention_label","Backup Retention Period (days)")}),c.jsx(f,{id:"retention-days",type:"number",min:"1",max:"365",value:Ve.retention_days,onChange:e=>Qe({...Ve,retention_days:parseInt(e.target.value)||30})}),c.jsx("p",{className:"text-xs text-muted-foreground",children:ve("admin.backup.settings.retention_help","Backups older than this will be automatically deleted")})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(v,{children:ve("admin.backup.settings.default_storage_locations","Default Storage Locations")}),c.jsxs("div",{className:"space-y-2",children:[c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("input",{type:"checkbox",id:"default-local",checked:Ve.default_storage_locations.includes("local"),onChange:e=>{const s=e.target.checked?[...Ve.default_storage_locations,"local"]:Ve.default_storage_locations.filter((e=>"local"!==e));Qe({...Ve,default_storage_locations:s})}}),c.jsx(v,{htmlFor:"default-local",className:"text-sm",children:ve("admin.backup.storage.local","Local Storage")})]}),c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("input",{type:"checkbox",id:"default-drive",checked:Ve.default_storage_locations.includes("google_drive"),onChange:e=>{const s=e.target.checked?[...Ve.default_storage_locations,"google_drive"]:Ve.default_storage_locations.filter((e=>"google_drive"!==e));Qe({...Ve,default_storage_locations:s})},disabled:!Ve.google_drive.enabled}),c.jsxs(v,{htmlFor:"default-drive",className:"text-sm",children:[ve("admin.backup.storage.google_drive","Google Drive")," ",!Ve.google_drive.enabled&&ve("admin.backup.storage.not_connected","(Not Connected)")]})]})]}),c.jsx("p",{className:"text-xs text-muted-foreground",children:ve("admin.backup.settings.default_storage_help","Default storage locations for new backups")})]})]}),c.jsx(Z,{}),c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{children:[c.jsx("h4",{className:"font-medium",children:"Automatic Cleanup"}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Automatically delete old backups based on retention period"})]}),c.jsx(ee,{checked:Ve.cleanup.enabled,onCheckedChange:e=>Qe({...Ve,cleanup:{...Ve.cleanup,enabled:e}})})]}),Ve.cleanup.enabled&&c.jsxs("div",{className:"space-y-2",children:[c.jsx(v,{htmlFor:"cleanup-time",children:"Cleanup Time"}),c.jsx(f,{id:"cleanup-time",type:"time",value:Ve.cleanup.time,onChange:e=>Qe({...Ve,cleanup:{...Ve.cleanup,time:e.target.value}}),className:"w-32"}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"Daily time when cleanup will run"})]})]})]})]}),c.jsxs(p,{children:[c.jsxs(g,{children:[c.jsx(j,{children:ve("admin.backup.google_drive.title","Google Drive Integration")}),c.jsx(b,{children:ve("admin.backup.google_drive.description","Configure OAuth 2.0 credentials and cloud storage backup options")})]}),c.jsxs(x,{className:"space-y-6",children:[c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{children:[c.jsx("h4",{className:"font-medium",children:ve("admin.backup.oauth.configuration_title","OAuth 2.0 Configuration")}),c.jsx("p",{className:"text-sm text-muted-foreground",children:ve("admin.backup.oauth.configuration_description","Configure Google OAuth credentials for Drive access")})]}),c.jsx("div",{className:"flex items-center gap-2",children:(null==us?void 0:us.configured)?c.jsxs(q,{variant:"default",className:"bg-green-100 text-green-800",children:[c.jsx(J,{className:"h-3 w-3 mr-1"}),ve("admin.backup.oauth.configured_status","Configured")]}):c.jsxs(q,{variant:"secondary",children:[c.jsx(H,{className:"h-3 w-3 mr-1"}),ve("admin.backup.oauth.not_configured_status","Not Configured")]})})]}),(null==us?void 0:us.configured)&&c.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:c.jsxs("div",{className:"flex items-start gap-3",children:[c.jsx(J,{className:"h-5 w-5 text-green-600 mt-0.5 flex-shrink-0"}),c.jsxs("div",{className:"flex-1",children:[c.jsx("h4",{className:"font-medium text-green-800 mb-2",children:ve("admin.backup.oauth.credentials_configured","OAuth Credentials Configured")}),c.jsxs("div",{className:"text-sm text-green-700 space-y-1",children:[c.jsxs("p",{children:[c.jsxs("strong",{children:[ve("admin.backup.oauth.client_id","Client ID"),":"]})," ",us.client_id]}),c.jsxs("p",{children:[c.jsxs("strong",{children:[ve("admin.backup.oauth.redirect_uri","Redirect URI"),":"]})," ",us.redirect_uri]}),c.jsxs("p",{children:[c.jsxs("strong",{children:[ve("admin.backup.oauth.source","Source"),":"]})," ","ui"===us.source?ve("admin.backup.oauth.admin_interface","Admin Interface"):ve("admin.backup.oauth.environment_variables","Environment Variables")]}),us.configured_at&&"Environment Variables"!==us.configured_at&&c.jsxs("p",{children:[c.jsxs("strong",{children:[ve("admin.backup.oauth.configured","Configured"),":"]})," ",new Date(us.configured_at).toLocaleString()]})]}),c.jsxs("div",{className:"flex gap-2 mt-3",children:[c.jsxs(C,{size:"sm",variant:"outline",onClick:()=>Es.mutate(),disabled:Es.isPending,children:[Es.isPending?c.jsx(d,{className:"h-4 w-4 mr-2 animate-spin"}):c.jsx(A,{className:"h-4 w-4 mr-2"}),ve("admin.backup.oauth.validate_credentials","Validate Credentials")]}),"ui"===us.source&&c.jsxs(C,{size:"sm",variant:"outline",onClick:()=>Je(!0),children:[c.jsx($,{className:"h-4 w-4 mr-2"}),ve("admin.backup.oauth.update_credentials","Update Credentials")]}),c.jsxs(O,{children:[c.jsx(U,{asChild:!0,children:c.jsxs(C,{size:"sm",variant:"outline",className:"text-red-600 hover:text-red-700",children:[c.jsx(K,{className:"h-4 w-4 mr-2"}),ve("admin.backup.oauth.clear_credentials","Clear Credentials")]})}),c.jsxs(R,{children:[c.jsxs(G,{children:[c.jsx(L,{children:ve("admin.backup.dialogs.clear_oauth_title","Clear OAuth Credentials")}),c.jsx(z,{children:ve("admin.backup.dialogs.clear_oauth_description","This will remove all stored Google OAuth credentials and disable Google Drive integration. You will need to reconfigure credentials to use Google Drive backups.")})]}),c.jsxs(Y,{children:[c.jsx(V,{children:ve("common.cancel","Cancel")}),c.jsx(Q,{onClick:()=>Fs.mutate(),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:ve("admin.backup.oauth.clear_credentials","Clear Credentials")})]})]})]})]})]})]})}),!(null==us?void 0:us.configured)&&c.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:c.jsxs("div",{className:"flex items-start gap-3",children:[c.jsx(se,{className:"h-5 w-5 text-blue-600 mt-0.5 flex-shrink-0"}),c.jsxs("div",{className:"flex-1",children:[c.jsx("h4",{className:"font-medium text-blue-800 mb-2",children:ve("admin.backup.oauth.setup_required","OAuth Setup Required")}),c.jsx("p",{className:"text-sm text-blue-700 mb-3",children:ve("admin.backup.oauth.setup_description","To enable Google Drive backups, you need to configure OAuth 2.0 credentials from Google Cloud Console.")}),c.jsxs("div",{className:"text-sm text-blue-700 mb-3",children:[c.jsxs("p",{className:"font-medium mb-1",children:[ve("admin.backup.oauth.setup_instructions","Setup Instructions"),":"]}),c.jsxs("ol",{className:"list-decimal list-inside space-y-1 ml-2",children:[c.jsxs("li",{children:[ve("admin.backup.oauth.step_1","Go to")," ",c.jsx("a",{href:"https://console.cloud.google.com",target:"_blank",rel:"noopener noreferrer",className:"underline",children:ve("admin.backup.oauth.google_cloud_console","Google Cloud Console")})]}),c.jsx("li",{children:ve("admin.backup.oauth.step_2","Create a new project or select existing one")}),c.jsx("li",{children:ve("admin.backup.oauth.step_3","Enable the Google Drive API")}),c.jsx("li",{children:ve("admin.backup.oauth.step_4","Create OAuth 2.0 credentials (Web application)")}),c.jsx("li",{children:ve("admin.backup.oauth.step_5","Add your redirect URI to authorized redirect URIs")}),c.jsx("li",{children:ve("admin.backup.oauth.step_6","Copy the Client ID and Client Secret")})]})]}),c.jsxs(C,{size:"sm",onClick:()=>Je(!0),children:[c.jsx(W,{className:"h-4 w-4 mr-2"}),ve("admin.backup.oauth.configure_credentials","Configure OAuth Credentials")]})]})]})}),He&&c.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("h4",{className:"font-medium",children:ve("admin.backup.oauth.credentials_form_title","OAuth 2.0 Credentials")}),c.jsx(C,{size:"sm",variant:"ghost",onClick:Ds,children:c.jsx(H,{className:"h-4 w-4"})})]}),c.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx(v,{htmlFor:"client-id",children:ve("admin.backup.oauth.client_id_label","Google Client ID")}),c.jsx(f,{id:"client-id",value:We.client_id,onChange:e=>$e({...We,client_id:e.target.value}),placeholder:ve("admin.backup.oauth.client_id_placeholder","Enter your Google OAuth Client ID")}),c.jsx("p",{className:"text-xs text-muted-foreground",children:ve("admin.backup.oauth.client_id_help","The Client ID from your Google Cloud Console OAuth credentials")})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(v,{htmlFor:"client-secret",children:ve("admin.backup.oauth.client_secret_label","Google Client Secret")}),c.jsx(f,{id:"client-secret",type:"password",value:We.client_secret,onChange:e=>$e({...We,client_secret:e.target.value}),placeholder:ve("admin.backup.oauth.client_secret_placeholder","Enter your Google OAuth Client Secret")}),c.jsx("p",{className:"text-xs text-muted-foreground",children:ve("admin.backup.oauth.client_secret_help","The Client Secret from your Google Cloud Console OAuth credentials")})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(v,{htmlFor:"redirect-uri",children:ve("admin.backup.oauth.redirect_uri_label","Redirect URI")}),c.jsx(f,{id:"redirect-uri",value:We.redirect_uri,onChange:e=>$e({...We,redirect_uri:e.target.value}),placeholder:"http://localhost:3000/admin/settings?tab=backup"}),c.jsx("p",{className:"text-xs text-muted-foreground",children:ve("admin.backup.oauth.redirect_uri_help","This URI must be added to your Google OAuth authorized redirect URIs")})]})]}),c.jsxs("div",{className:"flex gap-2",children:[c.jsxs(C,{onClick:()=>{We.client_id.trim()&&We.client_secret.trim()?Ps.mutate(We):be({title:ve("common.validation_error","Validation Error"),description:ve("admin.backup.validation.oauth_credentials_required","Client ID and Client Secret are required"),variant:"destructive"})},disabled:Ps.isPending||!We.client_id.trim()||!We.client_secret.trim(),children:[Ps.isPending&&c.jsx(d,{className:"mr-2 h-4 w-4 animate-spin"}),ve("admin.backup.oauth.save_credentials","Save Credentials")]}),c.jsx(C,{variant:"outline",onClick:Ds,children:ve("common.cancel","Cancel")})]})]})})]}),c.jsx(Z,{}),c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{children:[c.jsx("h4",{className:"font-medium",children:ve("admin.backup.google_drive.enable_title","Enable Google Drive Backups")}),c.jsx("p",{className:"text-sm text-muted-foreground",children:ve("admin.backup.google_drive.enable_description","Store backups in Google Drive for cloud redundancy")})]}),c.jsx(ee,{checked:Ve.google_drive.enabled,onCheckedChange:e=>Qe({...Ve,google_drive:{...Ve.google_drive,enabled:e}}),disabled:!(null==us?void 0:us.configured)})]}),Ve.google_drive.enabled&&(null==us?void 0:us.configured)&&c.jsxs("div",{className:"space-y-4",children:[c.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:c.jsxs("div",{className:"flex items-start gap-3",children:[c.jsx(Te,{className:"h-5 w-5 text-blue-600 mt-0.5 flex-shrink-0"}),c.jsxs("div",{children:[c.jsx("h4",{className:"font-medium text-blue-800 mb-2",children:ve("admin.backup.google_drive.connection_title","Google Drive Connection")}),c.jsx("p",{className:"text-sm text-blue-700 mb-3",children:ve("admin.backup.google_drive.connection_description",`Authorize ${fe.appName} to access your Google Drive for backup storage.`,{appName:fe.appName})}),c.jsxs("div",{className:"flex gap-2",children:[c.jsxs(C,{size:"sm",variant:"outline",onClick:()=>window.open("/api/admin/backup/google-drive/auth-url","_blank"),children:[c.jsx(ae,{className:"h-4 w-4 mr-2"}),ve("admin.backup.google_drive.connect_drive","Connect Google Drive")]}),c.jsxs(C,{size:"sm",variant:"outline",onClick:()=>Ss.mutate(),disabled:Ss.isPending,children:[Ss.isPending?c.jsx(d,{className:"h-4 w-4 mr-2 animate-spin"}):c.jsx(A,{className:"h-4 w-4 mr-2"}),ve("admin.backup.google_drive.test_connection","Test Connection")]})]})]})]})}),Ve.google_drive.credentials&&c.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx(J,{className:"h-5 w-5 text-green-600"}),c.jsxs("div",{children:[c.jsx("h4",{className:"font-medium text-green-800",children:ve("admin.backup.google_drive.connected_title","Google Drive Connected")}),c.jsx("p",{className:"text-sm text-green-700",children:ve("admin.backup.google_drive.connected_description","Your Google Drive account is connected and ready for backups.")})]})]})})]}),Ve.google_drive.enabled&&!(null==us?void 0:us.configured)&&c.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:c.jsxs("div",{className:"flex items-start gap-3",children:[c.jsx(ne,{className:"h-5 w-5 text-yellow-600 mt-0.5 flex-shrink-0"}),c.jsxs("div",{children:[c.jsx("h4",{className:"font-medium text-yellow-800",children:ve("admin.backup.google_drive.oauth_required_title","OAuth Configuration Required")}),c.jsx("p",{className:"text-sm text-yellow-700",children:ve("admin.backup.google_drive.oauth_required_description","Please configure OAuth 2.0 credentials above before enabling Google Drive backups.")})]})]})})]})]}),c.jsxs("div",{className:"flex justify-end gap-4",children:[c.jsx(C,{variant:"outline",onClick:()=>{rs&&Qe({retention_days:rs.retention_days||30,default_storage_locations:rs.storage_locations||["local"],google_drive:rs.google_drive||{enabled:!1,folder_id:null,credentials:null},encryption:rs.encryption||{enabled:!1,key:null},notifications:{enabled:!1,email:"",on_success:!0,on_failure:!0},cleanup:{enabled:!0,time:"03:00"}})},children:ve("admin.backup.actions.reset_defaults","Reset to Defaults")}),c.jsxs(C,{onClick:()=>{const e={...rs,retention_days:Ve.retention_days,storage_locations:Ve.default_storage_locations,google_drive:Ve.google_drive,encryption:Ve.encryption};Cs.mutate(e)},disabled:Cs.isPending,children:[Cs.isPending&&c.jsx(d,{className:"mr-2 h-4 w-4 animate-spin"}),ve("admin.backup.actions.save_settings","Save Settings")]})]})]})]}),c.jsx(ie,{open:Se,onOpenChange:e=>{e||bs.isPending||(Pe(!1),vs())},children:c.jsxs(te,{className:"max-w-2xl",children:[c.jsxs(re,{children:[c.jsxs(le,{className:"flex items-center gap-2",children:[c.jsx(B,{className:"h-5 w-5 text-orange-600"}),ve("admin.backup.restore.title","Database Restoration")]}),c.jsxs(ce,{children:["warning"===qe&&ve("admin.backup.restore.warning_step","Review the backup details and understand the implications"),"confirmation"===qe&&ve("admin.backup.restore.confirmation_step","Confirm your intention to restore the database"),"progress"===qe&&ve("admin.backup.restore.progress_step","Database restoration in progress")]})]}),Fe&&c.jsxs("div",{className:"space-y-6",children:[c.jsxs(p,{children:[c.jsx(g,{className:"pb-3",children:c.jsx(j,{className:"text-sm",children:ve("admin.backup.restore.backup_info","Backup Information")})}),c.jsxs(x,{className:"space-y-2 text-sm",children:[c.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[c.jsxs("div",{children:[c.jsxs("span",{className:"font-medium",children:[ve("admin.backup.restore.filename","Filename"),":"]}),c.jsx("div",{className:"text-muted-foreground",children:Fe.filename})]}),c.jsxs("div",{children:[c.jsxs("span",{className:"font-medium",children:[ve("admin.backup.restore.created","Created"),":"]}),c.jsx("div",{className:"text-muted-foreground",children:Is(Fe.created_at)})]}),c.jsxs("div",{children:[c.jsxs("span",{className:"font-medium",children:[ve("admin.backup.restore.size","Size"),":"]}),c.jsx("div",{className:"text-muted-foreground",children:qs(Fe.size)})]}),c.jsxs("div",{children:[c.jsxs("span",{className:"font-medium",children:[ve("admin.backup.restore.type","Type"),":"]}),c.jsx("div",{className:"text-muted-foreground capitalize",children:Fe.type})]})]}),c.jsxs("div",{children:[c.jsxs("span",{className:"font-medium",children:[ve("admin.backup.restore.description","Description"),":"]}),c.jsx("div",{className:"text-muted-foreground",children:Fe.description})]}),c.jsxs("div",{children:[c.jsxs("span",{className:"font-medium",children:[ve("admin.backup.restore.storage","Storage"),":"]}),c.jsxs("div",{className:"flex gap-1 mt-1",children:[Fe.storage_locations.includes("local")&&c.jsxs(q,{variant:"outline",className:"text-xs",children:[c.jsx(De,{className:"h-3 w-3 mr-1"}),ve("admin.backup.storage.local","Local")]}),Fe.storage_locations.includes("google_drive")&&c.jsxs(q,{variant:"outline",className:"text-xs",children:[c.jsx(Te,{className:"h-3 w-3 mr-1"}),ve("admin.backup.storage.google_drive","Google Drive")]})]})]})]})]}),"warning"===qe&&c.jsxs("div",{className:"space-y-4",children:[c.jsx("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:c.jsxs("div",{className:"flex items-start gap-3",children:[c.jsx(ne,{className:"h-5 w-5 text-orange-600 mt-0.5 flex-shrink-0"}),c.jsxs("div",{className:"space-y-2",children:[c.jsx("h4",{className:"font-medium text-orange-800",children:ve("admin.backup.restore.warning_title","Critical Warning")}),c.jsxs("div",{className:"text-sm text-orange-700 space-y-1",children:[c.jsxs("p",{children:["• ",c.jsx("strong",{children:ve("admin.backup.restore.warning_replace","This action will completely replace your current database")})]}),c.jsxs("p",{children:["• ",ve("admin.backup.restore.warning_data_lost","All current data will be permanently lost")]}),c.jsxs("p",{children:["• ",ve("admin.backup.restore.warning_disconnect","All users will be disconnected during the restoration")]}),c.jsxs("p",{children:["• ",ve("admin.backup.restore.warning_undone","The restoration process cannot be undone")]}),c.jsxs("p",{children:["• ",ve("admin.backup.restore.warning_backup","Make sure you have a recent backup of the current state if needed")]})]})]})]})}),c.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:c.jsxs("div",{className:"flex items-start gap-3",children:[c.jsx(se,{className:"h-5 w-5 text-blue-600 mt-0.5 flex-shrink-0"}),c.jsxs("div",{className:"space-y-2",children:[c.jsx("h4",{className:"font-medium text-blue-800",children:ve("admin.backup.restore.process_title","Restoration Process")}),c.jsxs("div",{className:"text-sm text-blue-700 space-y-1",children:[c.jsxs("p",{children:["1. ",ve("admin.backup.restore.process_download","Backup file will be downloaded if stored in cloud")]}),c.jsxs("p",{children:["2. ",ve("admin.backup.restore.process_verify","Backup integrity will be verified")]}),c.jsxs("p",{children:["3. ",ve("admin.backup.restore.process_clean","Current database will be cleaned")]}),c.jsxs("p",{children:["4. ",ve("admin.backup.restore.process_restore","Backup data will be restored")]}),c.jsxs("p",{children:["5. ",ve("admin.backup.restore.process_ready","System will be ready for use")]})]})]})]})})]}),"confirmation"===qe&&c.jsxs("div",{className:"space-y-4",children:[c.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:c.jsxs("div",{className:"flex items-start gap-3",children:[c.jsx(ne,{className:"h-5 w-5 text-red-600 mt-0.5 flex-shrink-0"}),c.jsxs("div",{children:[c.jsx("h4",{className:"font-medium text-red-800 mb-2",children:ve("admin.backup.restore.confirmation_title","Final Confirmation Required")}),c.jsx("p",{className:"text-sm text-red-700 mb-3",children:ve("admin.backup.restore.confirmation_text","To proceed with the database restoration, please type the backup filename exactly as shown below:")}),c.jsx("div",{className:"bg-white border rounded px-3 py-2 font-mono text-sm",children:ys()})]})]})}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(v,{htmlFor:"confirmation-input",children:ve("admin.backup.restore.confirmation_label","Confirmation Text")}),c.jsx(f,{id:"confirmation-input",value:Ae,onChange:e=>Be(e.target.value),placeholder:ve("admin.backup.restore.confirmation_placeholder",'Type "{filename}" to confirm',{filename:ys()}),className:"font-mono"}),c.jsx("p",{className:"text-xs text-muted-foreground",children:ve("admin.backup.restore.confirmation_help","This confirmation ensures you understand the consequences of this action.")})]})]}),"progress"===qe&&c.jsxs("div",{className:"space-y-4",children:[c.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx(d,{className:"h-5 w-5 text-blue-600 animate-spin flex-shrink-0"}),c.jsxs("div",{children:[c.jsx("h4",{className:"font-medium text-blue-800",children:ve("admin.backup.restore.progress_title","Restoration in Progress")}),c.jsx("p",{className:"text-sm text-blue-700",children:(null==Oe?void 0:Oe.message)||ve("admin.backup.restore.progress_processing","Processing...")})]})]})}),"completed"===(null==Oe?void 0:Oe.status)&&c.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx(J,{className:"h-5 w-5 text-green-600 flex-shrink-0"}),c.jsxs("div",{children:[c.jsx("h4",{className:"font-medium text-green-800",children:ve("admin.backup.restore.completed_title","Restoration Completed")}),c.jsx("p",{className:"text-sm text-green-700",children:ve("admin.backup.restore.completed_message","Database has been successfully restored. The dialog will close automatically.")})]})]})}),"failed"===(null==Oe?void 0:Oe.status)&&c.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx(H,{className:"h-5 w-5 text-red-600 flex-shrink-0"}),c.jsxs("div",{children:[c.jsx("h4",{className:"font-medium text-red-800",children:ve("admin.backup.restore.failed_title","Restoration Failed")}),c.jsx("p",{className:"text-sm text-red-700",children:null==Oe?void 0:Oe.message})]})]})})]})]}),c.jsxs(de,{children:["warning"===qe&&c.jsxs(c.Fragment,{children:[c.jsx(C,{variant:"outline",onClick:()=>{Pe(!1),vs()},children:ve("admin.backup.restore.cancel","Cancel")}),c.jsx(C,{onClick:()=>Ie("confirmation"),className:"bg-orange-600 hover:bg-orange-700",children:ve("admin.backup.restore.understand_continue","I Understand, Continue")})]}),"confirmation"===qe&&c.jsxs(c.Fragment,{children:[c.jsx(C,{variant:"outline",onClick:()=>Ie("warning"),children:ve("admin.backup.restore.back","Back")}),c.jsx(C,{onClick:()=>{Fe&&(Ie("progress"),bs.mutate({backupId:Fe.id,confirmationText:Ae}))},disabled:Ae!==ys(),className:"bg-red-600 hover:bg-red-700",children:ve("admin.backup.restore.restore_database","Restore Database")})]}),"progress"===qe&&c.jsx(C,{variant:"outline",onClick:()=>{Pe(!1),vs()},disabled:bs.isPending&&"failed"!==(null==Oe?void 0:Oe.status),children:"completed"===(null==Oe?void 0:Oe.status)||"failed"===(null==Oe?void 0:Oe.status)?ve("admin.backup.restore.close","Close"):ve("common.cancel","Cancel")})]})]})}),c.jsx(ie,{open:Ke,onOpenChange:e=>{e||(Re(!1),Le(null),Ms())},children:c.jsxs(te,{className:"max-w-lg",children:[c.jsxs(re,{children:[c.jsx(le,{children:Ge?ve("admin.backup.schedule_dialog.edit_title","Edit Backup Schedule"):ve("admin.backup.schedule_dialog.create_title","Create Backup Schedule")}),c.jsx(ce,{children:ve("admin.backup.schedule_dialog.description","Configure automated backup schedule settings")})]}),c.jsxs("div",{className:"space-y-6",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx(v,{htmlFor:"schedule-name",children:ve("admin.backup.schedule_dialog.name_label","Schedule Name")}),c.jsx(f,{id:"schedule-name",value:ze.name,onChange:e=>Ye({...ze,name:e.target.value}),placeholder:ve("admin.backup.schedule_dialog.name_placeholder","e.g., Daily Backup, Weekly Archive")}),c.jsx("p",{className:"text-xs text-muted-foreground",children:ve("admin.backup.schedule_dialog.name_help","A descriptive name for this backup schedule")})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(v,{children:ve("admin.backup.schedule_dialog.frequency_label","Backup Frequency")}),c.jsxs(y,{value:ze.frequency,onValueChange:e=>Ye({...ze,frequency:e}),children:[c.jsx(k,{children:c.jsx(N,{})}),c.jsxs(w,{children:[c.jsx(_,{value:"daily",children:ve("admin.backup.schedule_dialog.frequency_daily","Daily")}),c.jsx(_,{value:"weekly",children:ve("admin.backup.schedule_dialog.frequency_weekly","Weekly")}),c.jsx(_,{value:"monthly",children:ve("admin.backup.schedule_dialog.frequency_monthly","Monthly")})]})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(v,{htmlFor:"schedule-time",children:ve("admin.backup.schedule_dialog.time_label","Backup Time")}),c.jsx(f,{id:"schedule-time",type:"time",value:ze.time,onChange:e=>Ye({...ze,time:e.target.value})}),c.jsx("p",{className:"text-xs text-muted-foreground",children:ve("admin.backup.schedule_dialog.time_help","Time when the backup will be executed (24-hour format)")})]}),"weekly"===ze.frequency&&c.jsxs("div",{className:"space-y-2",children:[c.jsx(v,{children:ve("admin.backup.schedule_dialog.day_of_week","Day of Week")}),c.jsxs(y,{value:ze.day_of_week.toString(),onValueChange:e=>Ye({...ze,day_of_week:parseInt(e)}),children:[c.jsx(k,{children:c.jsx(N,{})}),c.jsxs(w,{children:[c.jsx(_,{value:"0",children:ve("admin.backup.days.sunday","Sunday")}),c.jsx(_,{value:"1",children:ve("admin.backup.days.monday","Monday")}),c.jsx(_,{value:"2",children:ve("admin.backup.days.tuesday","Tuesday")}),c.jsx(_,{value:"3",children:ve("admin.backup.days.wednesday","Wednesday")}),c.jsx(_,{value:"4",children:ve("admin.backup.days.thursday","Thursday")}),c.jsx(_,{value:"5",children:ve("admin.backup.days.friday","Friday")}),c.jsx(_,{value:"6",children:ve("admin.backup.days.saturday","Saturday")})]})]})]}),"monthly"===ze.frequency&&c.jsxs("div",{className:"space-y-2",children:[c.jsx(v,{htmlFor:"day-of-month",children:ve("admin.backup.schedule_dialog.day_of_month","Day of Month")}),c.jsx(f,{id:"day-of-month",type:"number",min:"1",max:"31",value:ze.day_of_month,onChange:e=>Ye({...ze,day_of_month:parseInt(e.target.value)||1})}),c.jsx("p",{className:"text-xs text-muted-foreground",children:ve("admin.backup.schedule_dialog.day_of_month_help","Day of the month when backup will be executed (1-31)")})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(v,{children:ve("admin.backup.schedule_dialog.storage_label","Storage Locations")}),c.jsxs("div",{className:"space-y-2",children:[c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("input",{type:"checkbox",id:"schedule-local",checked:ze.storage_locations.includes("local"),onChange:e=>{const s=e.target.checked?[...ze.storage_locations,"local"]:ze.storage_locations.filter((e=>"local"!==e));Ye({...ze,storage_locations:s})}}),c.jsx(v,{htmlFor:"schedule-local",className:"text-sm",children:ve("admin.backup.storage.local","Local Storage")})]}),c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("input",{type:"checkbox",id:"schedule-drive",checked:ze.storage_locations.includes("google_drive"),onChange:e=>{const s=e.target.checked?[...ze.storage_locations,"google_drive"]:ze.storage_locations.filter((e=>"google_drive"!==e));Ye({...ze,storage_locations:s})},disabled:!(null==(pe=null==rs?void 0:rs.google_drive)?void 0:pe.enabled)}),c.jsxs(v,{htmlFor:"schedule-drive",className:"text-sm",children:[ve("admin.backup.storage.google_drive","Google Drive")," ",!(null==(xe=null==rs?void 0:rs.google_drive)?void 0:xe.enabled)&&ve("admin.backup.storage.not_connected","(Not Connected)")]})]})]}),c.jsx("p",{className:"text-xs text-muted-foreground",children:ve("admin.backup.schedule_dialog.storage_help","Where to store the backup files")})]}),c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{children:[c.jsx("h4",{className:"font-medium",children:ve("admin.backup.schedule_dialog.enable_title","Enable Schedule")}),c.jsx("p",{className:"text-sm text-muted-foreground",children:ve("admin.backup.schedule_dialog.enable_help","Start this schedule immediately after creation")})]}),c.jsx(ee,{checked:ze.enabled,onCheckedChange:e=>Ye({...ze,enabled:e})})]})]}),c.jsxs(de,{children:[c.jsx(C,{variant:"outline",onClick:()=>{Re(!1),Le(null),Ms()},children:ve("common.cancel","Cancel")}),c.jsxs(C,{onClick:()=>{if(!ze.name.trim())return void be({title:ve("common.validation_error","Validation Error"),description:ve("admin.backup.validation.schedule_name_required","Schedule name is required"),variant:"destructive"});const e={...ze,id:ze.name.toLowerCase().replace(/\s+/g,"-")};Ns.mutate(e)},disabled:Ns.isPending||!ze.name.trim()||0===ze.storage_locations.length,children:[Ns.isPending&&c.jsx(d,{className:"mr-2 h-4 w-4 animate-spin"}),Ge?ve("admin.backup.schedule_dialog.update_button","Update Schedule"):ve("admin.backup.schedule_dialog.create_button","Create Schedule")]})]})]})}),c.jsx(ie,{open:Xe,onOpenChange:Ze,children:c.jsxs(te,{className:"sm:max-w-[500px]",children:[c.jsxs(re,{children:[c.jsx(le,{children:ve("admin.backup.upload.title","Upload Database Backup")}),c.jsx(ce,{children:ve("admin.backup.upload.description","Upload an external database backup file to add it to your backup collection. Supported formats: .sql, .backup, .dump, .bak")})]}),c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx(v,{children:ve("admin.backup.upload.file_label","Backup File")}),c.jsx(oe,{onFileSelected:e=>{ss((s=>({...s,file:e})))},fileType:".sql,.backup,.dump,.bak",maxSize:500,className:"w-full",showProgress:is,progress:as}),c.jsx("p",{className:"text-xs text-muted-foreground",children:ve("admin.backup.upload.file_help","Maximum file size: 500MB. Supported formats: .sql, .backup, .dump, .bak")})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(v,{htmlFor:"upload-description",children:ve("admin.backup.upload.description_label","Description (Optional)")}),c.jsx(f,{id:"upload-description",placeholder:ve("admin.backup.upload.description_placeholder","Enter a description for this backup..."),value:es.description,onChange:e=>ss((s=>({...s,description:e.target.value}))),disabled:is})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(v,{children:ve("admin.backup.upload.storage_label","Storage Locations")}),c.jsxs("div",{className:"space-y-2",children:[c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("input",{type:"checkbox",id:"upload-local",checked:es.storage_locations.includes("local"),onChange:e=>{const s=e.target.checked?[...es.storage_locations,"local"]:es.storage_locations.filter((e=>"local"!==e));ss((e=>({...e,storage_locations:s})))},disabled:is}),c.jsx(v,{htmlFor:"upload-local",className:"text-sm",children:ve("admin.backup.storage.local","Local Storage")})]}),c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("input",{type:"checkbox",id:"upload-drive",checked:es.storage_locations.includes("google_drive"),onChange:e=>{const s=e.target.checked?[...es.storage_locations,"google_drive"]:es.storage_locations.filter((e=>"google_drive"!==e));ss((e=>({...e,storage_locations:s})))},disabled:!(null==(ge=null==rs?void 0:rs.google_drive)?void 0:ge.enabled)||is}),c.jsxs(v,{htmlFor:"upload-drive",className:"text-sm",children:[ve("admin.backup.storage.google_drive","Google Drive")," ",!(null==(je=null==rs?void 0:rs.google_drive)?void 0:je.enabled)&&ve("admin.backup.storage.not_connected","(Not Connected)")]})]})]}),c.jsx("p",{className:"text-xs text-muted-foreground",children:ve("admin.backup.upload.storage_help","Choose where to store the uploaded backup")})]}),is&&c.jsxs("div",{className:"space-y-2",children:[c.jsxs("div",{className:"flex justify-between text-sm",children:[c.jsx("span",{children:ve("admin.backup.upload.uploading","Uploading...")}),c.jsxs("span",{children:[as,"%"]})]}),c.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:c.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${as}%`}})})]})]}),c.jsxs(de,{children:[c.jsx(C,{variant:"outline",onClick:()=>{Ze(!1),ks()},disabled:is,children:ve("common.cancel","Cancel")}),c.jsx(C,{onClick:()=>{es.file?js.mutate({file:es.file,description:es.description||`Uploaded backup: ${es.file.name}`,storage_locations:es.storage_locations}):be({title:ve("common.error","Error"),description:ve("admin.backup.upload.no_file_selected","Please select a backup file to upload"),variant:"destructive"})},disabled:!es.file||0===es.storage_locations.length||is,children:is?c.jsxs(c.Fragment,{children:[c.jsx(d,{className:"mr-2 h-4 w-4 animate-spin"}),ve("admin.backup.upload.uploading","Uploading...")]}):c.jsxs(c.Fragment,{children:[c.jsx(S,{className:"mr-2 h-4 w-4"}),ve("admin.backup.upload.upload_button","Upload Backup")]})})]})]})})]})}function Be(){const{t:e}=a(),{toast:n}=s(),[l,o]=i.useState(null),{data:m}=t({queryKey:["app-version"],queryFn:async()=>(await ue("GET","/api/auto-update/version")).json()}),{data:u,refetch:h,isLoading:b}=t({queryKey:["update-check"],queryFn:async()=>(await ue("GET","/api/auto-update/check")).json(),enabled:!1}),{data:v,refetch:f}=t({queryKey:["update-history"],queryFn:async()=>(await ue("GET","/api/auto-update/history")).json()}),{data:y,refetch:k}=t({queryKey:["update-status"],queryFn:async()=>(await ue("GET","/api/auto-update/status")).json(),refetchInterval:!!l&&2e3}),N=r({mutationFn:async()=>(await ue("POST","/api/auto-update/start")).json(),onSuccess:s=>{n({title:e("settings.updates.update_started","Update Started"),description:e("settings.updates.update_started_desc","System update has been initiated")}),k()},onError:s=>{n({title:e("common.error","Error"),description:s.message||e("settings.updates.update_failed","Failed to start update"),variant:"destructive"})}});i.useEffect((()=>{if(null==y?void 0:y.isInProgress){const e=new EventSource("/api/auto-update/progress");return e.onmessage=e=>{try{const s=JSON.parse(e.data);o(s),k()}catch(s){}},e.onerror=()=>{e.close(),o(null)},()=>{e.close()}}o(null)}),[null==y?void 0:y.isInProgress,k]);const w=e=>{switch(e){case"completed":return c.jsx(J,{className:"h-4 w-4 text-green-500"});case"failed":case"rolled_back":return c.jsx(H,{className:"h-4 w-4 text-red-500"});case"pending":return c.jsx(be,{className:"h-4 w-4 text-yellow-500"});case"downloading":case"validating":case"applying":return c.jsx(d,{className:"h-4 w-4 text-blue-500 animate-spin"});default:return c.jsx(je,{className:"h-4 w-4 text-gray-500"})}},_=(null==m?void 0:m.version)||"1.0.0",S=null==u?void 0:u.updateAvailable,P=null==u?void 0:u.updatePackage,F=(null==v?void 0:v.updates)||[],E=null==y?void 0:y.isInProgress;return c.jsxs("div",{className:"space-y-6",children:[c.jsxs(p,{children:[c.jsx(g,{children:c.jsxs(j,{className:"flex items-center space-x-2",children:[c.jsx(he,{className:"h-5 w-5"}),c.jsx("span",{children:e("settings.updates.title","System Updates")})]})}),c.jsxs(x,{className:"space-y-4",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{children:[c.jsx("p",{className:"text-sm text-muted-foreground",children:e("settings.updates.current_version","Current Version")}),c.jsxs("p",{className:"text-lg font-semibold",children:["PowerChat Plus v",_]})]}),c.jsx(C,{onClick:()=>{h()},disabled:b||E,variant:"outline",children:b?c.jsxs(c.Fragment,{children:[c.jsx(d,{className:"mr-2 h-4 w-4 animate-spin"}),e("settings.updates.checking","Checking...")]}):c.jsxs(c.Fragment,{children:[c.jsx(he,{className:"mr-2 h-4 w-4"}),e("settings.updates.check_updates","Check for Updates")]})})]}),S&&P&&c.jsxs(pe,{children:[c.jsx(I,{className:"h-4 w-4"}),c.jsx(xe,{children:c.jsxs("div",{className:"space-y-2",children:[c.jsx("p",{className:"font-medium",children:e("settings.updates.update_available","Update Available: v{{version}}",{version:P.version})}),c.jsx("p",{className:"text-sm",children:e("settings.updates.package_size","Package Size: {{size}}",{size:(e=>{if(0===e)return"0 Bytes";const s=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,s)).toFixed(2))+" "+["Bytes","KB","MB","GB"][s]})(P.packageSize)})}),P.releaseNotes&&c.jsxs("div",{className:"text-sm",children:[c.jsx("p",{className:"font-medium mb-1",children:e("settings.updates.release_notes","Release Notes:")}),c.jsx("p",{className:"whitespace-pre-wrap",children:P.releaseNotes})]}),c.jsx(C,{onClick:()=>{N.mutate()},disabled:N.isPending||E,className:"mt-2",children:N.isPending?c.jsxs(c.Fragment,{children:[c.jsx(d,{className:"mr-2 h-4 w-4 animate-spin"}),e("settings.updates.starting","Starting...")]}):c.jsxs(c.Fragment,{children:[c.jsx(I,{className:"mr-2 h-4 w-4"}),e("settings.updates.install_update","Install Update")]})})]})})]}),!S&&u&&c.jsxs(pe,{children:[c.jsx(J,{className:"h-4 w-4"}),c.jsx(xe,{children:e("settings.updates.up_to_date","Your system is up to date")})]})]})]}),(E||l)&&c.jsxs(p,{children:[c.jsx(g,{children:c.jsxs(j,{className:"flex items-center space-x-2",children:[c.jsx(d,{className:"h-5 w-5 animate-spin"}),c.jsx("span",{children:e("settings.updates.update_progress","Update Progress")})]})}),c.jsxs(x,{className:"space-y-4",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsxs("div",{className:"flex justify-between text-sm",children:[c.jsx("span",{children:(null==l?void 0:l.message)||e("settings.updates.preparing","Preparing update...")}),c.jsxs("span",{children:[(null==l?void 0:l.progress)||0,"%"]})]}),c.jsx(ge,{value:(null==l?void 0:l.progress)||0,className:"w-full"})]}),c.jsxs(pe,{variant:"destructive",children:[c.jsx(ne,{className:"h-4 w-4"}),c.jsx(xe,{children:e("settings.updates.update_warning","Do not close this page or restart the system during the update process.")})]})]})]}),c.jsxs(p,{children:[c.jsx(g,{children:c.jsxs(j,{className:"flex items-center space-x-2",children:[c.jsx(X,{className:"h-5 w-5"}),c.jsx("span",{children:e("settings.updates.history","Update History")})]})}),c.jsx(x,{children:0===F.length?c.jsx("p",{className:"text-muted-foreground text-center py-4",children:e("settings.updates.no_history","No update history available")}):c.jsx("div",{className:"space-y-4",children:F.map((s=>{return c.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[c.jsxs("div",{className:"flex items-center space-x-3",children:[w(s.status),c.jsxs("div",{children:[c.jsxs("p",{className:"font-medium",children:["v",s.version]}),c.jsx("p",{className:"text-sm text-muted-foreground",children:new Date(s.createdAt).toLocaleDateString()})]})]}),c.jsxs("div",{className:"flex items-center space-x-2",children:[(a=s.status,c.jsx(q,{variant:{completed:"default",failed:"destructive",rolled_back:"destructive",pending:"secondary",downloading:"default",validating:"default",applying:"default"}[a]||"secondary",children:e(`settings.updates.status.${a}`,a)})),s.progressPercentage>0&&"completed"!==s.status&&c.jsxs("span",{className:"text-sm text-muted-foreground",children:[s.progressPercentage,"%"]})]})]},s.id);var a}))})})]})]})}function Oe(){const{t:e}=a(),{toast:n}=s(),{user:l}=ve(),[o,m]=i.useState({enabled:!1,message:"System is under maintenance. Please try again later.",estimatedCompletion:"",bypassCode:""}),{data:u,refetch:h,isLoading:b,error:y}=t({queryKey:["maintenance-mode"],queryFn:async()=>{const e=await ue("GET","/api/auto-update/maintenance");return await e.json()},refetchOnWindowFocus:!0,refetchInterval:3e4,retry:3,retryDelay:1e3});i.useEffect((()=>{u&&m((e=>({...e,enabled:u.enabled||!1,message:u.message||"System is under maintenance. Please try again later.",estimatedCompletion:u.estimatedCompletion?new Date(u.estimatedCompletion).toISOString().slice(0,16):"",bypassCode:u.bypassCode||e.bypassCode})))}),[u]);const k=r({mutationFn:async e=>(await ue("POST","/api/auto-update/maintenance",e)).json(),onSuccess:(s,a)=>{n({title:e("settings.maintenance.updated","Maintenance Mode Updated"),description:a.enabled?e("settings.maintenance.enabled_success","Maintenance mode has been enabled"):e("settings.maintenance.disabled_success","Maintenance mode has been disabled")}),me.invalidateQueries({queryKey:["maintenance-mode"]}),me.invalidateQueries({queryKey:["maintenance-mode-status"]}),h()},onError:s=>{n({title:e("common.error","Error"),description:s.message||e("settings.maintenance.update_failed","Failed to update maintenance mode"),variant:"destructive"})}}),N=(e,s)=>{m((a=>({...a,[e]:s})))},w=(null==u?void 0:u.enabled)||!1;return b?c.jsx("div",{className:"space-y-6",children:c.jsx(p,{children:c.jsxs(x,{className:"flex items-center justify-center py-8",children:[c.jsx(d,{className:"h-6 w-6 animate-spin mr-2"}),c.jsx("span",{children:"Loading maintenance mode settings..."})]})})}):y?c.jsx("div",{className:"space-y-6",children:c.jsx(p,{children:c.jsx(x,{className:"py-8",children:c.jsxs(pe,{variant:"destructive",children:[c.jsx(ne,{className:"h-4 w-4"}),c.jsx(xe,{children:c.jsxs("div",{className:"space-y-2",children:[c.jsx("p",{children:c.jsx("strong",{children:"Error loading maintenance mode settings:"})}),c.jsx("p",{className:"text-sm",children:y.message}),c.jsx(C,{onClick:()=>h(),variant:"outline",size:"sm",children:"Retry"})]})})]})})})}):c.jsxs("div",{className:"space-y-6",children:[c.jsxs(p,{children:[c.jsx(g,{children:c.jsxs(j,{className:"flex items-center space-x-2",children:[c.jsx($,{className:"h-5 w-5"}),c.jsx("span",{children:e("settings.maintenance.title","Maintenance Mode")})]})}),c.jsx(x,{children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{children:[c.jsx("p",{className:"text-sm text-muted-foreground",children:e("settings.maintenance.current_status","Current Status")}),c.jsx("p",{className:"text-lg font-semibold "+(w?"text-orange-600":"text-green-600"),children:w?e("settings.maintenance.enabled","Enabled"):e("settings.maintenance.disabled","Disabled")})]}),w&&c.jsxs("div",{className:"space-y-2",children:[c.jsxs(pe,{className:"max-w-md",children:[c.jsx(ne,{className:"h-4 w-4"}),c.jsx(xe,{children:e("settings.maintenance.active_warning","Maintenance mode is currently active. Non-admin users cannot access the system.")})]}),(null==l?void 0:l.isSuperAdmin)&&c.jsxs(pe,{className:"max-w-md border-blue-200 bg-blue-50",children:[c.jsx(je,{className:"h-4 w-4 text-blue-600"}),c.jsx(xe,{className:"text-blue-800",children:c.jsxs("div",{className:"space-y-2",children:[c.jsxs("p",{children:[c.jsx("strong",{children:"Super Admin Access:"})," You can access the system because you are a super admin. Regular users will see the maintenance page."]}),c.jsx(C,{type:"button",variant:"outline",size:"sm",onClick:async()=>{try{const e=await ue("GET","/api/auto-update/maintenance/test"),s=await e.json();503===e.status?n({title:"Maintenance Mode Test",description:"✅ Maintenance mode is working correctly! Non-admin users would see the maintenance page.",variant:"default"}):n({title:"Maintenance Mode Test",description:s.message||"Maintenance mode is not active.",variant:"default"})}catch(e){n({title:"Test Failed",description:e.message||"Failed to test maintenance mode",variant:"destructive"})}},className:"text-blue-700 border-blue-300 hover:bg-blue-100",children:"Test Maintenance Mode"})]})})]})]})]})})]}),c.jsxs(p,{children:[c.jsx(g,{children:c.jsxs(j,{className:"flex items-center space-x-2",children:[c.jsx(A,{className:"h-5 w-5"}),c.jsx("span",{children:e("settings.maintenance.configuration","Configuration")})]})}),c.jsx(x,{children:c.jsxs("form",{onSubmit:e=>{e.preventDefault();const s={enabled:o.enabled,message:o.message.trim()||"System is under maintenance. Please try again later."};o.estimatedCompletion&&(s.estimatedCompletion=new Date(o.estimatedCompletion).toISOString()),o.bypassCode.trim()&&(s.bypassCode=o.bypassCode.trim()),k.mutate(s)},className:"space-y-6",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"space-y-0.5",children:[c.jsx(v,{className:"text-base",children:e("settings.maintenance.enable_maintenance","Enable Maintenance Mode")}),c.jsx("p",{className:"text-sm text-muted-foreground",children:e("settings.maintenance.enable_description","When enabled, only super admin users can access the system")})]}),c.jsx(ee,{checked:o.enabled,onCheckedChange:e=>N("enabled",e)})]}),c.jsx(Z,{}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(v,{htmlFor:"message",children:e("settings.maintenance.message","Maintenance Message")}),c.jsx(fe,{id:"message",value:o.message,onChange:e=>N("message",e.target.value),placeholder:e("settings.maintenance.message_placeholder","Enter the message to display to users during maintenance"),rows:3}),c.jsx("p",{className:"text-xs text-muted-foreground",children:e("settings.maintenance.message_help","This message will be displayed to users when they try to access the system during maintenance")})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsxs(v,{htmlFor:"estimatedCompletion",className:"flex items-center space-x-2",children:[c.jsx(be,{className:"h-4 w-4"}),c.jsx("span",{children:e("settings.maintenance.estimated_completion","Estimated Completion (Optional)")})]}),c.jsx(f,{id:"estimatedCompletion",type:"datetime-local",value:o.estimatedCompletion,onChange:e=>N("estimatedCompletion",e.target.value)}),c.jsx("p",{className:"text-xs text-muted-foreground",children:e("settings.maintenance.completion_help","Provide an estimated completion time to inform users when the system will be available again")})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsxs(v,{htmlFor:"bypassCode",className:"flex items-center space-x-2",children:[c.jsx(ye,{className:"h-4 w-4"}),c.jsx("span",{children:e("settings.maintenance.bypass_code","Admin Bypass Code (Optional)")})]}),c.jsxs("div",{className:"flex space-x-2",children:[c.jsx(f,{id:"bypassCode",type:"text",value:o.bypassCode,onChange:e=>N("bypassCode",e.target.value),placeholder:e("settings.maintenance.bypass_placeholder","Enter a secret code for admin access")}),c.jsx(C,{type:"button",variant:"outline",onClick:()=>{const e=Math.random().toString(36).substring(2,10).toUpperCase();N("bypassCode",e)},children:e("settings.maintenance.generate","Generate")})]}),c.jsx("p",{className:"text-xs text-muted-foreground",children:e("settings.maintenance.bypass_help","This code allows super admin users to bypass maintenance mode from the maintenance page")})]}),o.enabled&&c.jsxs(pe,{variant:"destructive",children:[c.jsx(ne,{className:"h-4 w-4"}),c.jsx(xe,{children:c.jsxs("div",{className:"space-y-2",children:[c.jsx("p",{className:"font-medium",children:e("settings.maintenance.warning_title","Warning: Enabling Maintenance Mode")}),c.jsxs("ul",{className:"text-sm space-y-1 ml-4 list-disc",children:[c.jsx("li",{children:e("settings.maintenance.warning_users","All non-admin users will be redirected to the maintenance page")}),c.jsx("li",{children:e("settings.maintenance.warning_api","API requests from non-admin users will return maintenance errors")}),c.jsx("li",{children:e("settings.maintenance.warning_sessions","Existing user sessions will be affected")}),c.jsx("li",{children:e("settings.maintenance.warning_bypass","Only super admin users and those with the bypass code can access the system")})]})]})})]}),c.jsxs(pe,{children:[c.jsx(je,{className:"h-4 w-4"}),c.jsx(xe,{children:c.jsxs("div",{className:"space-y-2",children:[c.jsx("p",{className:"font-medium",children:e("settings.maintenance.info_title","Maintenance Mode Information")}),c.jsxs("ul",{className:"text-sm space-y-1 ml-4 list-disc",children:[c.jsx("li",{children:e("settings.maintenance.info_admin","Super admin users are never affected by maintenance mode")}),c.jsx("li",{children:e("settings.maintenance.info_automatic","Maintenance mode is automatically enabled during system updates")}),c.jsx("li",{children:e("settings.maintenance.info_bypass","The bypass code can be shared with trusted users for emergency access")}),c.jsx("li",{children:e("settings.maintenance.info_disable","You can disable maintenance mode at any time from this page")})]})]})})]}),c.jsx("div",{className:"flex justify-end",children:c.jsx(C,{type:"submit",disabled:k.isPending,className:o.enabled?"bg-orange-600 hover:bg-orange-700":"",children:k.isPending?c.jsxs(c.Fragment,{children:[c.jsx(d,{className:"mr-2 h-4 w-4 animate-spin"}),e("settings.maintenance.updating","Updating...")]}):c.jsxs(c.Fragment,{children:[c.jsx($,{className:"mr-2 h-4 w-4"}),o.enabled?e("settings.maintenance.enable_mode","Enable Maintenance Mode"):e("settings.maintenance.update_settings","Update Settings")]})})})]})})]})]})}function Ue({isOpen:e,onClose:a,onSuccess:n}){const{toast:t}=s(),[r,l]=i.useState(!1),[o,m]=i.useState(!1),[u,h]=i.useState(!1),[p,x]=i.useState(null),[g,j]=i.useState({appId:"",appSecret:"",businessManagerId:"",webhookVerifyToken:"",accessToken:"",webhookUrl:"",companyName:"",logoUrl:""});i.useEffect((()=>{e&&b()}),[e]);const b=async()=>{var e,s;try{h(!0);const a=await fetch("/api/admin/partner-configurations/meta");if(a.ok){const n=await a.json();x(n),j({appId:n.partnerApiKey||"",appSecret:n.partnerSecret||"",businessManagerId:n.partnerId||"",webhookVerifyToken:n.webhookVerifyToken||"",accessToken:n.accessToken||"",webhookUrl:n.partnerWebhookUrl||"",companyName:(null==(e=n.publicProfile)?void 0:e.companyName)||"",logoUrl:(null==(s=n.publicProfile)?void 0:s.logoUrl)||""})}else if(404!==a.status)throw new Error("Failed to load configuration")}catch(a){t({title:"Error",description:"Failed to load existing configuration",variant:"destructive"})}finally{h(!1)}},y=e=>{const{name:s,value:a}=e.target;j((e=>({...e,[s]:a})))};return c.jsx(ie,{open:e,onOpenChange:()=>{r||o||a()},children:c.jsxs(te,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[c.jsx(re,{children:c.jsx(le,{children:"Meta WhatsApp Business API Partner Configuration"})}),u?c.jsxs("div",{className:"flex items-center justify-center py-8",children:[c.jsx(d,{className:"h-8 w-8 animate-spin"}),c.jsx("span",{className:"ml-2",children:"Loading configuration..."})]}):c.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),g.appId&&g.appSecret&&g.businessManagerId)try{l(!0);const e={provider:"meta",partnerApiKey:g.appId,partnerSecret:g.appSecret,partnerId:g.businessManagerId,webhookVerifyToken:g.webhookVerifyToken,accessToken:g.accessToken,partnerWebhookUrl:g.webhookUrl,redirectUrl:`${window.location.origin}/settings/channels/meta/callback`,publicProfile:{companyName:g.companyName,logoUrl:g.logoUrl},isActive:!0},s=p?`/api/admin/partner-configurations/${p.id}`:"/api/admin/partner-configurations",i=p?"PUT":"POST",r=await fetch(s,{method:i,headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!r.ok){const e=await r.json();throw new Error(e.error||"Failed to save configuration")}t({title:"Success",description:p?"Meta Partner API configuration updated successfully":"Meta Partner API configuration created successfully"}),n(),a()}catch(s){t({title:"Error",description:s instanceof Error?s.message:"Failed to save configuration",variant:"destructive"})}finally{l(!1)}else t({title:"Error",description:"App ID, App Secret, and Business Manager ID are required",variant:"destructive"})},className:"space-y-6",children:[c.jsxs("div",{className:"space-y-4",children:[c.jsx("h3",{className:"text-lg font-medium",children:"Tech Provider Credentials"}),c.jsx("p",{className:"text-sm text-gray-600",children:"Configure your Meta Tech Provider credentials for embedded signup"}),c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[c.jsxs("div",{children:[c.jsx(v,{htmlFor:"appId",children:"App ID *"}),c.jsx(f,{id:"appId",name:"appId",value:g.appId,onChange:y,placeholder:"Your Meta App ID",required:!0})]}),c.jsxs("div",{children:[c.jsx(v,{htmlFor:"appSecret",children:"App Secret *"}),c.jsx(f,{id:"appSecret",name:"appSecret",type:"password",value:g.appSecret,onChange:y,placeholder:"Your Meta App Secret",required:!0})]})]}),c.jsxs("div",{children:[c.jsx(v,{htmlFor:"businessManagerId",children:"Business Manager ID *"}),c.jsx(f,{id:"businessManagerId",name:"businessManagerId",value:g.businessManagerId,onChange:y,placeholder:"Your Business Manager ID",required:!0})]}),c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[c.jsxs("div",{children:[c.jsx(v,{htmlFor:"webhookVerifyToken",children:"Webhook Verify Token"}),c.jsx(f,{id:"webhookVerifyToken",name:"webhookVerifyToken",value:g.webhookVerifyToken,onChange:y,placeholder:"Webhook verification token"})]}),c.jsxs("div",{children:[c.jsx(v,{htmlFor:"accessToken",children:"System User Access Token"}),c.jsx(f,{id:"accessToken",name:"accessToken",type:"password",value:g.accessToken,onChange:y,placeholder:"System user access token"})]})]}),c.jsxs("div",{children:[c.jsx(v,{htmlFor:"webhookUrl",children:"Webhook URL"}),c.jsx(f,{id:"webhookUrl",name:"webhookUrl",value:g.webhookUrl,onChange:y,placeholder:"https://yourdomain.com/api/webhooks/meta-whatsapp"})]})]}),c.jsxs("div",{className:"space-y-4",children:[c.jsx("h3",{className:"text-lg font-medium",children:"Company Profile"}),c.jsx("p",{className:"text-sm text-gray-600",children:"This information will be shown to companies during onboarding"}),c.jsxs("div",{children:[c.jsx(v,{htmlFor:"companyName",children:"Company Name"}),c.jsx(f,{id:"companyName",name:"companyName",value:g.companyName,onChange:y,placeholder:"Your company name"})]}),c.jsxs("div",{children:[c.jsx(v,{htmlFor:"logoUrl",children:"Logo URL"}),c.jsx(f,{id:"logoUrl",name:"logoUrl",value:g.logoUrl,onChange:y,placeholder:"https://example.com/logo.png"})]})]}),c.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 pt-4",children:[c.jsxs(C,{type:"button",variant:"outline",onClick:async()=>{try{m(!0);const e=await fetch("/api/admin/partner-configurations/validate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({provider:"meta",appId:g.appId,appSecret:g.appSecret,businessManagerId:g.businessManagerId,accessToken:g.accessToken})}),s=await e.json();return e.ok&&s.valid?(t({title:"Success",description:"Meta Partner API credentials are valid!"}),!0):(t({title:"Validation Failed",description:s.error||"Invalid Meta Partner API credentials",variant:"destructive"}),!1)}catch(e){return t({title:"Error",description:"Failed to validate configuration",variant:"destructive"}),!1}finally{m(!1)}},disabled:o||r||!g.appId||!g.appSecret,className:"flex-1",children:[o?c.jsx(d,{className:"w-4 h-4 mr-2 animate-spin"}):c.jsx(Ie,{className:"w-4 h-4 mr-2"}),"Test Configuration"]}),c.jsxs(C,{type:"submit",disabled:r||o,className:"flex-1",children:[r?c.jsx(d,{className:"w-4 h-4 mr-2 animate-spin"}):c.jsx(J,{className:"w-4 h-4 mr-2"}),p?"Update Configuration":"Save Configuration"]})]})]})]})})}function Ke(){const{toast:e}=s(),{t:l}=a(),{refreshBranding:P}=n(),[F]=ke(),[E,T]=i.useState(null),[M,D]=i.useState(null),[q,I]=i.useState(null),[A,B]=i.useState(null),[O,U]=i.useState(!1),[K,R]=i.useState(!1),G=new URLSearchParams(F.split("?")[1]||"").get("tab")||"branding",[L,z]=i.useState(G);i.useEffect((()=>{const e=new URLSearchParams(F.split("?")[1]||"").get("tab")||"branding";z(e)}),[F]);const[Y,V]=i.useState({appName:"PowerChat",primaryColor:"#333235",secondaryColor:"#4F46E5"}),[Q,W]=i.useState({publishableKey:"",secretKey:"",webhookSecret:"",testMode:!0,enabled:!1}),[H,J]=i.useState({enabled:!0,requireApproval:!1,defaultPlan:""}),[X,se]=i.useState({clientId:"",clientSecret:"",accessToken:"",testMode:!0,enabled:!1}),[ae,ne]=i.useState({clientId:"",clientSecret:"",testMode:!0,enabled:!1}),[ie,te]=i.useState({accountName:"",accountNumber:"",bankName:"",routingNumber:"",swiftCode:"",instructions:"",enabled:!1}),[re,le]=i.useState({defaultCurrency:"USD",dateFormat:"MM/DD/YYYY",timeFormat:"12h"}),[ce,de]=i.useState({enabled:!1,host:"",port:587,security:"starttls",username:"",password:"",fromName:"",fromEmail:"",testEmail:""}),{data:oe,isLoading:pe}=t({queryKey:["/api/admin/settings"],queryFn:async()=>{const e=await ue("GET","/api/admin/settings");if(!e.ok)throw new Error("Failed to fetch settings");return e.json()}}),{data:xe,isLoading:ge}=t({queryKey:["/api/admin/plans"],queryFn:async()=>{const e=await ue("GET","/api/admin/plans");if(!e.ok)throw new Error("Failed to fetch plans");return e.json()}});i.useEffect((()=>{if(oe){const e=oe.find((e=>"branding"===e.key));e&&V(e.value);const s=oe.find((e=>"branding_logo"===e.key));s&&D(s.value);const a=oe.find((e=>"branding_favicon"===e.key));a&&B(a.value);const n=oe.find((e=>"registration_settings"===e.key));n&&J(n.value);const i=oe.find((e=>"payment_stripe"===e.key));i&&W({...i.value,secretKey:i.value.secretKey?"••••••••":""});const t=oe.find((e=>"payment_mercadopago"===e.key));t&&se({...t.value,clientSecret:t.value.clientSecret?"••••••••":"",accessToken:t.value.accessToken?"••••••••":""});const r=oe.find((e=>"payment_paypal"===e.key));r&&ne({...r.value,clientSecret:r.value.clientSecret?"••••••••":""});const l=oe.find((e=>"payment_bank_transfer"===e.key));l&&te(l.value);const c=oe.find((e=>"general_settings"===e.key));c&&le(c.value);const d=oe.find((e=>"smtp_config"===e.key));d&&de({...d.value,password:d.value.password?"••••••••":""})}}),[oe]),i.useEffect((()=>{if(xe&&xe.length>0&&!H.defaultPlan){const e=xe.find((e=>e.isActive))||xe[0];e&&J((s=>({...s,defaultPlan:e.id.toString()})))}}),[xe,H.defaultPlan]);const je=r({mutationFn:async()=>{if(!E)throw new Error("No logo file selected");const e=new FormData;e.append("logo",E);const s=await fetch("/api/admin/settings/branding/logo",{method:"POST",body:e,credentials:"include"});if(!s.ok){const e=await s.json();throw new Error(e.error||"Failed to upload logo")}return s.json()},onSuccess:async()=>{me.invalidateQueries({queryKey:["/api/admin/settings"]}),await P(),e({title:"Logo uploaded",description:"The logo has been uploaded successfully."})},onError:s=>{e({title:"Error uploading logo",description:s.message,variant:"destructive"})}}),be=r({mutationFn:async()=>{if(!q)throw new Error("No favicon file selected");const e=new FormData;e.append("favicon",q);const s=await fetch("/api/admin/settings/branding/favicon",{method:"POST",body:e,credentials:"include"});if(!s.ok){const e=await s.json();throw new Error(e.error||"Failed to upload favicon")}return s.json()},onSuccess:async()=>{me.invalidateQueries({queryKey:["/api/admin/settings"]}),await P(),e({title:"Favicon uploaded",description:"The favicon has been uploaded successfully."})},onError:s=>{e({title:"Error uploading favicon",description:s.message,variant:"destructive"})}}),ve=r({mutationFn:async()=>{if(!Y.appName)throw new Error("Application name is required");const e=await ue("POST","/api/admin/settings/branding",Y);if(!e.ok){const s=await e.json();throw new Error(s.error||"Failed to save branding settings")}return e.json()},onSuccess:async()=>{me.invalidateQueries({queryKey:["/api/admin/settings"]}),await P(),e({title:"Branding settings saved",description:"The branding settings have been saved successfully."})},onError:s=>{e({title:"Error saving branding settings",description:s.message,variant:"destructive"})}}),fe=r({mutationFn:async()=>{const e={...Q,secretKey:"••••••••"===Q.secretKey?void 0:Q.secretKey},s=await ue("POST","/api/admin/settings/payment/stripe",e);if(!s.ok){const e=await s.json();throw new Error(e.error||"Failed to save Stripe settings")}return s.json()},onSuccess:()=>{me.invalidateQueries({queryKey:["/api/admin/settings"]}),e({title:"Stripe settings saved",description:"The Stripe settings have been saved successfully."})},onError:s=>{e({title:"Error saving Stripe settings",description:s.message,variant:"destructive"})}}),ye=r({mutationFn:async()=>{const e=await ue("POST","/api/admin/settings/payment/stripe/test");if(!e.ok){const s=await e.json();throw new Error(s.error||"Failed to test Stripe connection")}return e.json()},onSuccess:s=>{e({title:"Stripe connection successful",description:`Connected to Stripe account: ${s.account.email}`})},onError:s=>{e({title:"Error connecting to Stripe",description:s.message,variant:"destructive"})}}),Te=r({mutationFn:async()=>{const e={...X,clientSecret:"••••••••"===X.clientSecret?void 0:X.clientSecret,accessToken:"••••••••"===X.accessToken?void 0:X.accessToken},s=await ue("POST","/api/admin/settings/payment/mercadopago",e);if(!s.ok){const e=await s.json();throw new Error(e.error||"Failed to save Mercado Pago settings")}return s.json()},onSuccess:()=>{me.invalidateQueries({queryKey:["/api/admin/settings"]}),e({title:"Mercado Pago settings saved",description:"The Mercado Pago settings have been saved successfully."})},onError:s=>{e({title:"Error saving Mercado Pago settings",description:s.message,variant:"destructive"})}}),De=r({mutationFn:async()=>{const e=await ue("POST","/api/admin/settings/payment/mercadopago/test");if(!e.ok){const s=await e.json();throw new Error(s.error||"Failed to test Mercado Pago connection")}return e.json()},onSuccess:s=>{e({title:"Mercado Pago connection successful",description:`Connected to Mercado Pago account: ${s.account.email||s.account.nickname}`})},onError:s=>{e({title:"Error connecting to Mercado Pago",description:s.message,variant:"destructive"})}}),Ie=r({mutationFn:async()=>{const e={...ae,clientSecret:"••••••••"===ae.clientSecret?void 0:ae.clientSecret},s=await ue("POST","/api/admin/settings/payment/paypal",e);if(!s.ok){const e=await s.json();throw new Error(e.error||"Failed to save PayPal settings")}return s.json()},onSuccess:()=>{me.invalidateQueries({queryKey:["/api/admin/settings"]}),e({title:"PayPal settings saved",description:"The PayPal settings have been saved successfully."})},onError:s=>{e({title:"Error saving PayPal settings",description:s.message,variant:"destructive"})}}),Ke=r({mutationFn:async()=>{const e=await ue("POST","/api/admin/settings/payment/paypal/test");if(!e.ok){const s=await e.json();throw new Error(s.error||"Failed to test PayPal connection")}return e.json()},onSuccess:s=>{e({title:"PayPal connection successful",description:`Connected to PayPal ${s.account.environment} environment`})},onError:s=>{e({title:"Error connecting to PayPal",description:s.message,variant:"destructive"})}}),Re=r({mutationFn:async()=>{const e=await ue("POST","/api/admin/settings/payment/bank-transfer",ie);if(!e.ok){const s=await e.json();throw new Error(s.error||"Failed to save bank transfer settings")}return e.json()},onSuccess:()=>{me.invalidateQueries({queryKey:["/api/admin/settings"]}),e({title:"Bank transfer settings saved",description:"The bank transfer settings have been saved successfully."})},onError:s=>{e({title:"Error saving bank transfer settings",description:s.message,variant:"destructive"})}}),Ge=r({mutationFn:async()=>{const e=await ue("POST","/api/admin/settings/general",re);if(!e.ok){const s=await e.json();throw new Error(s.error||"Failed to save general settings")}return e.json()},onSuccess:()=>{me.invalidateQueries({queryKey:["/api/admin/settings"]}),e({title:"General settings saved",description:"The general settings have been saved successfully."})},onError:s=>{e({title:"Error saving general settings",description:s.message,variant:"destructive"})}}),Le=r({mutationFn:async()=>{const e={...ce,password:"••••••••"===ce.password?void 0:ce.password},s=await ue("POST","/api/admin/settings/smtp",e);if(!s.ok){const e=await s.json();throw new Error(e.error||"Failed to save SMTP settings")}return s.json()},onSuccess:()=>{me.invalidateQueries({queryKey:["/api/admin/settings"]}),e({title:"SMTP settings saved",description:"The SMTP settings have been saved successfully."})},onError:s=>{e({title:"Error saving SMTP settings",description:s.message,variant:"destructive"})}}),ze=r({mutationFn:async()=>{if(!ce.testEmail)throw new Error("Test email address is required");const e=await ue("POST","/api/admin/settings/smtp/test",{testEmail:ce.testEmail});if(!e.ok){const s=await e.json();throw new Error(s.error||"Failed to test SMTP connection")}return e.json()},onSuccess:s=>{e({title:"SMTP connection successful",description:s.message||"SMTP connection test passed"})},onError:s=>{e({title:"Error testing SMTP connection",description:s.message,variant:"destructive"})}}),Ye=r({mutationFn:async()=>{try{const e={enabled:Boolean(H.enabled),requireApproval:Boolean(H.requireApproval),defaultPlan:H.defaultPlan||(xe&&xe.length>0?xe[0].id.toString():"1")};if(e.enabled&&!e.defaultPlan)throw new Error("Default plan is required when registration is enabled");const s=await ue("POST","/api/admin/settings/registration",e);if(!s.ok){const e=await s.json();throw new Error(e.error||"Failed to save registration settings")}return await s.json()}catch(e){throw e}},onSuccess:()=>{me.invalidateQueries({queryKey:["/api/admin/settings"]}),e({title:"Registration settings saved",description:"The registration settings have been saved successfully."})},onError:s=>{e({title:"Error saving registration settings",description:s.message,variant:"destructive"})}});return pe?c.jsx(Ne,{children:c.jsx("div",{className:"flex items-center justify-center min-h-screen",children:c.jsx(d,{className:"h-8 w-8 animate-spin text-primary"})})}):c.jsx(Ne,{children:c.jsxs("div",{className:"p-3 sm:p-6",children:[c.jsx("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center mb-6 gap-4",children:c.jsxs("div",{children:[c.jsx("h1",{className:"text-2xl",children:l("admin.settings.title","Settings")}),c.jsx("p",{className:"text-muted-foreground text-sm sm:text-base mt-1",children:"Configure system settings, payment gateways, and application preferences"})]})}),c.jsxs(o,{value:L,onValueChange:z,className:"space-y-6",children:[c.jsx("div",{className:"overflow-x-auto mb-6",children:c.jsxs(m,{className:"grid w-full grid-cols-2 sm:grid-cols-3 lg:grid-cols-9 gap-1 min-w-max",children:[c.jsxs(u,{value:"branding",className:"text-xs sm:text-sm whitespace-nowrap",children:[c.jsx(qe,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1 sm:mr-2"}),c.jsx("span",{className:"hidden sm:inline",children:l("admin.settings.branding","Branding")}),c.jsx("span",{className:"sm:hidden",children:"Brand"})]}),c.jsxs(u,{value:"payment",className:"text-xs sm:text-sm whitespace-nowrap",children:[c.jsx(we,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1 sm:mr-2"}),c.jsx("span",{className:"hidden sm:inline",children:l("admin.settings.payment_gateways","Payment Gateways")}),c.jsx("span",{className:"sm:hidden",children:"Payment"})]}),c.jsxs(u,{value:"email",className:"text-xs sm:text-sm whitespace-nowrap",children:[c.jsx(_e,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1 sm:mr-2"}),c.jsx("span",{className:"hidden sm:inline",children:l("admin.settings.email","Email Settings")}),c.jsx("span",{className:"sm:hidden",children:"Email"})]}),c.jsxs(u,{value:"general",className:"text-xs sm:text-sm whitespace-nowrap",children:[c.jsx(Ce,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1 sm:mr-2"}),c.jsx("span",{className:"hidden sm:inline",children:l("admin.settings.general","General")}),c.jsx("span",{className:"sm:hidden",children:"General"})]}),c.jsxs(u,{value:"platform",className:"text-xs sm:text-sm whitespace-nowrap",children:[c.jsx($,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1 sm:mr-2"}),c.jsx("span",{className:"hidden sm:inline",children:l("admin.settings.partnerapi","Partner API")}),c.jsx("span",{className:"sm:hidden",children:"Partner API"})]}),c.jsxs(u,{value:"registration",className:"text-xs sm:text-sm whitespace-nowrap",children:[c.jsx(Se,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1 sm:mr-2"}),c.jsx("span",{className:"hidden sm:inline",children:l("admin.settings.registration","Registration")}),c.jsx("span",{className:"sm:hidden",children:"Register"})]}),c.jsxs(u,{value:"backup",className:"text-xs sm:text-sm whitespace-nowrap",children:[c.jsx(Ee,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1 sm:mr-2"}),c.jsx("span",{className:"hidden sm:inline",children:l("admin.settings.backup","Database Backup")}),c.jsx("span",{className:"sm:hidden",children:"Backup"})]}),c.jsxs(u,{value:"updates",className:"text-xs sm:text-sm whitespace-nowrap",children:[c.jsx(he,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1 sm:mr-2"}),c.jsx("span",{className:"hidden sm:inline",children:l("admin.settings.updates","System Updates")}),c.jsx("span",{className:"sm:hidden",children:"Updates"})]}),c.jsxs(u,{value:"maintenance",className:"text-xs sm:text-sm whitespace-nowrap",children:[c.jsx($,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1 sm:mr-2"}),c.jsx("span",{className:"hidden sm:inline",children:l("admin.settings.maintenance","Maintenance Mode")}),c.jsx("span",{className:"sm:hidden",children:"Maintenance"})]})]})}),c.jsx(h,{value:"branding",children:c.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6",children:[c.jsxs(p,{children:[c.jsxs(g,{children:[c.jsx(j,{children:l("admin.settings.branding","Application Branding")}),c.jsx(b,{children:l("admin.settings.branding_description","Customize the appearance of your application")})]}),c.jsxs(x,{className:"space-y-4",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx(v,{htmlFor:"appName",children:l("admin.settings.app_name","Application Name")}),c.jsx(f,{id:"appName",value:Y.appName,onChange:e=>V({...Y,appName:e.target.value}),placeholder:"PowerChat"})]}),c.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx(v,{htmlFor:"primaryColor",className:"text-sm",children:l("admin.settings.primary_color","Primary Color")}),c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("div",{className:"w-6 h-6 rounded-full border cursor-pointer flex-shrink-0",style:{backgroundColor:Y.primaryColor},onClick:()=>{const e=document.getElementById("primaryColor");e&&e.click()}}),c.jsx(f,{id:"primaryColor",type:"color",value:Y.primaryColor,onChange:e=>V({...Y,primaryColor:e.target.value}),className:"w-12 sm:w-16 h-8 sm:h-10 p-1 border rounded cursor-pointer flex-shrink-0"}),c.jsx(f,{type:"text",value:Y.primaryColor,onChange:e=>V({...Y,primaryColor:e.target.value}),placeholder:"#333235",className:"flex-1 min-w-0"})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(v,{htmlFor:"secondaryColor",className:"text-sm",children:l("admin.settings.secondary_color","Secondary Color")}),c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("div",{className:"w-6 h-6 rounded-full border cursor-pointer flex-shrink-0",style:{backgroundColor:Y.secondaryColor},onClick:()=>{const e=document.getElementById("secondaryColor");e&&e.click()}}),c.jsx(f,{id:"secondaryColor",type:"color",value:Y.secondaryColor,onChange:e=>V({...Y,secondaryColor:e.target.value}),className:"w-12 sm:w-16 h-8 sm:h-10 p-1 border rounded cursor-pointer flex-shrink-0"}),c.jsx(f,{type:"text",value:Y.secondaryColor,onChange:e=>V({...Y,secondaryColor:e.target.value}),placeholder:"#4F46E5",className:"flex-1 min-w-0"})]})]})]}),c.jsxs(C,{variant:"brand",onClick:()=>ve.mutate(),disabled:ve.isPending,className:"btn-brand-primary",children:[ve.isPending&&c.jsx(d,{className:"mr-2 h-4 w-4 animate-spin"}),l("admin.settings.save_branding","Save Branding Settings")]})]})]}),c.jsxs("div",{className:"space-y-6",children:[c.jsxs(p,{children:[c.jsxs(g,{children:[c.jsx(j,{children:"Logo"}),c.jsx(b,{children:"Upload your company logo (recommended size: 200x50px)"})]}),c.jsxs(x,{className:"space-y-4",children:[M&&c.jsx("div",{className:"border rounded-md p-4 flex items-center justify-center bg-gray-50",children:c.jsx("img",{src:M,alt:"Logo Preview",className:"max-h-16 max-w-full object-contain"})}),c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx(f,{id:"logo",type:"file",accept:"image/*",onChange:e=>{if(e.target.files&&e.target.files[0]){const s=e.target.files[0];T(s),D(URL.createObjectURL(s))}},className:"hidden"}),c.jsxs(v,{htmlFor:"logo",className:"cursor-pointer flex items-center justify-center border rounded-md px-4 py-2 hover:bg-gray-50",children:[c.jsx(S,{className:"h-4 w-4 mr-2"}),"Choose Logo"]}),E&&c.jsxs(C,{onClick:()=>je.mutate(),disabled:je.isPending,children:[je.isPending?c.jsx(d,{className:"mr-2 h-4 w-4 animate-spin"}):c.jsx(Pe,{className:"mr-2 h-4 w-4"}),"Upload"]})]})]})]}),c.jsxs(p,{children:[c.jsxs(g,{children:[c.jsx(j,{children:"Favicon"}),c.jsx(b,{children:"Upload your favicon (recommended size: 32x32px)"})]}),c.jsxs(x,{className:"space-y-4",children:[A&&c.jsx("div",{className:"border rounded-md p-4 flex items-center justify-center bg-gray-50",children:c.jsx("img",{src:A,alt:"Favicon Preview",className:"max-h-8 max-w-full object-contain"})}),c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx(f,{id:"favicon",type:"file",accept:"image/*",onChange:e=>{if(e.target.files&&e.target.files[0]){const s=e.target.files[0];I(s),B(URL.createObjectURL(s))}},className:"hidden"}),c.jsxs(v,{htmlFor:"favicon",className:"cursor-pointer flex items-center justify-center border rounded-md px-4 py-2 hover:bg-gray-50",children:[c.jsx(Me,{className:"h-4 w-4 mr-2"}),"Choose Favicon"]}),q&&c.jsxs(C,{onClick:()=>be.mutate(),disabled:be.isPending,children:[be.isPending?c.jsx(d,{className:"mr-2 h-4 w-4 animate-spin"}):c.jsx(Pe,{className:"mr-2 h-4 w-4"}),"Upload"]})]})]})]})]})]})}),c.jsx(h,{value:"payment",children:c.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6",children:[c.jsxs(p,{children:[c.jsxs(g,{children:[c.jsx(j,{children:"Stripe Integration"}),c.jsx(b,{children:"Configure Stripe payment gateway"})]}),c.jsxs(x,{className:"space-y-4",children:[c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx(ee,{id:"stripe-enabled",checked:Q.enabled,onCheckedChange:e=>W({...Q,enabled:e})}),c.jsx(v,{htmlFor:"stripe-enabled",children:"Enable Stripe Payments"})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(v,{htmlFor:"publishableKey",children:"Publishable Key"}),c.jsx(f,{id:"publishableKey",value:Q.publishableKey,onChange:e=>W({...Q,publishableKey:e.target.value}),placeholder:"pk_test_...",disabled:!Q.enabled})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(v,{htmlFor:"secretKey",children:"Secret Key"}),c.jsx(f,{id:"secretKey",type:"password",value:Q.secretKey,onChange:e=>W({...Q,secretKey:e.target.value}),placeholder:"sk_test_...",disabled:!Q.enabled})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(v,{htmlFor:"webhookSecret",children:"Webhook Secret"}),c.jsx(f,{id:"webhookSecret",value:Q.webhookSecret,onChange:e=>W({...Q,webhookSecret:e.target.value}),placeholder:"whsec_...",disabled:!Q.enabled})]}),c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx(ee,{id:"stripe-test-mode",checked:Q.testMode,onCheckedChange:e=>W({...Q,testMode:e}),disabled:!Q.enabled}),c.jsx(v,{htmlFor:"stripe-test-mode",children:"Test Mode"})]}),c.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:space-x-2",children:[c.jsxs(C,{variant:"brand",onClick:()=>fe.mutate(),disabled:fe.isPending||!Q.enabled,className:"btn-brand-primary w-full sm:w-auto",children:[fe.isPending&&c.jsx(d,{className:"mr-2 h-4 w-4 animate-spin"}),c.jsx("span",{className:"hidden sm:inline",children:"Save Stripe Settings"}),c.jsx("span",{className:"sm:hidden",children:"Save Settings"})]}),c.jsxs(C,{variant:"brand",onClick:()=>ye.mutate(),disabled:ye.isPending||!Q.enabled||!Q.secretKey,className:"w-full sm:w-auto",children:[ye.isPending?c.jsx(d,{className:"mr-2 h-4 w-4 animate-spin"}):c.jsx(Pe,{className:"mr-2 h-4 w-4"}),"Test Connection"]})]})]})]}),c.jsxs(p,{children:[c.jsxs(g,{children:[c.jsx(j,{children:"Mercado Pago Integration"}),c.jsx(b,{children:"Configure Mercado Pago payment gateway"})]}),c.jsxs(x,{className:"space-y-4",children:[c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx(ee,{id:"mercadopago-enabled",checked:X.enabled,onCheckedChange:e=>se({...X,enabled:e})}),c.jsx(v,{htmlFor:"mercadopago-enabled",children:"Enable Mercado Pago Payments"})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(v,{htmlFor:"mercadopago-clientId",children:"Client ID"}),c.jsx(f,{id:"mercadopago-clientId",value:X.clientId,onChange:e=>se({...X,clientId:e.target.value}),placeholder:"2740017016616699",disabled:!X.enabled})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(v,{htmlFor:"mercadopago-clientSecret",children:"Client Secret"}),c.jsx(f,{id:"mercadopago-clientSecret",type:"password",value:X.clientSecret,onChange:e=>se({...X,clientSecret:e.target.value}),placeholder:"9JUknDFhkXkuyEBuEnvWiXrpVFnYdtLc",disabled:!X.enabled})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(v,{htmlFor:"mercadopago-accessToken",children:"Access Token"}),c.jsx(f,{id:"mercadopago-accessToken",type:"password",value:X.accessToken,onChange:e=>se({...X,accessToken:e.target.value}),placeholder:"APP_USR-2740017016616699-021517-c5d115a0e393d32ec81f16ec2dc15e7e-221745631",disabled:!X.enabled}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"This is the Production Access Token from your Mercado Pago Developer Dashboard. Make sure to use the correct token for test or production mode."})]}),c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx(ee,{id:"mercadopago-test-mode",checked:X.testMode,onCheckedChange:e=>se({...X,testMode:e}),disabled:!X.enabled}),c.jsx(v,{htmlFor:"mercadopago-test-mode",children:"Test Mode"})]}),c.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:space-x-2",children:[c.jsxs(C,{variant:"brand",onClick:()=>Te.mutate(),disabled:Te.isPending||!X.enabled,className:"btn-brand-primary w-full sm:w-auto",children:[Te.isPending&&c.jsx(d,{className:"mr-2 h-4 w-4 animate-spin"}),c.jsx("span",{className:"hidden sm:inline",children:"Save Mercado Pago Settings"}),c.jsx("span",{className:"sm:hidden",children:"Save Settings"})]}),c.jsxs(C,{variant:"brand",onClick:()=>De.mutate(),disabled:De.isPending||!X.enabled||!X.accessToken,className:"w-full sm:w-auto",children:[De.isPending?c.jsx(d,{className:"mr-2 h-4 w-4 animate-spin"}):c.jsx(Pe,{className:"mr-2 h-4 w-4"}),"Test Connection"]})]})]})]}),c.jsxs(p,{children:[c.jsxs(g,{children:[c.jsx(j,{children:"PayPal Integration"}),c.jsx(b,{children:"Configure PayPal payment gateway"})]}),c.jsxs(x,{className:"space-y-4",children:[c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx(ee,{id:"paypal-enabled",checked:ae.enabled,onCheckedChange:e=>ne({...ae,enabled:e})}),c.jsx(v,{htmlFor:"paypal-enabled",children:"Enable PayPal Payments"})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(v,{htmlFor:"clientId",children:"Client ID"}),c.jsx(f,{id:"clientId",value:ae.clientId,onChange:e=>ne({...ae,clientId:e.target.value}),placeholder:"Your PayPal Client ID",disabled:!ae.enabled})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(v,{htmlFor:"clientSecret",children:"Client Secret"}),c.jsx(f,{id:"clientSecret",type:"password",value:ae.clientSecret,onChange:e=>ne({...ae,clientSecret:e.target.value}),placeholder:"Your PayPal Client Secret",disabled:!ae.enabled})]}),c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx(ee,{id:"paypal-test-mode",checked:ae.testMode,onCheckedChange:e=>ne({...ae,testMode:e}),disabled:!ae.enabled}),c.jsx(v,{htmlFor:"paypal-test-mode",children:"Sandbox Mode"})]}),c.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:space-x-2",children:[c.jsxs(C,{variant:"brand",onClick:()=>Ie.mutate(),disabled:Ie.isPending||!ae.enabled,className:"btn-brand-primary w-full sm:w-auto",children:[Ie.isPending&&c.jsx(d,{className:"mr-2 h-4 w-4 animate-spin"}),c.jsx("span",{className:"hidden sm:inline",children:"Save PayPal Settings"}),c.jsx("span",{className:"sm:hidden",children:"Save Settings"})]}),c.jsxs(C,{variant:"brand",onClick:()=>Ke.mutate(),disabled:Ke.isPending||!ae.enabled||!ae.clientSecret,className:"w-full sm:w-auto",children:[Ke.isPending?c.jsx(d,{className:"mr-2 h-4 w-4 animate-spin"}):c.jsx(Pe,{className:"mr-2 h-4 w-4"}),"Test Connection"]})]})]})]}),c.jsxs(p,{children:[c.jsxs(g,{children:[c.jsx(j,{children:"Bank Transfer"}),c.jsx(b,{children:"Configure offline payment via bank transfer"})]}),c.jsxs(x,{className:"space-y-4",children:[c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx(ee,{id:"bank-transfer-enabled",checked:ie.enabled,onCheckedChange:e=>te({...ie,enabled:e})}),c.jsx(v,{htmlFor:"bank-transfer-enabled",children:"Enable Bank Transfer"})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(v,{htmlFor:"accountName",children:"Account Name"}),c.jsx(f,{id:"accountName",value:ie.accountName,onChange:e=>te({...ie,accountName:e.target.value}),placeholder:"Company Name",disabled:!ie.enabled})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(v,{htmlFor:"accountNumber",children:"Account Number"}),c.jsx(f,{id:"accountNumber",value:ie.accountNumber,onChange:e=>te({...ie,accountNumber:e.target.value}),placeholder:"123456789",disabled:!ie.enabled})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(v,{htmlFor:"bankName",children:"Bank Name"}),c.jsx(f,{id:"bankName",value:ie.bankName,onChange:e=>te({...ie,bankName:e.target.value}),placeholder:"Bank of Example",disabled:!ie.enabled})]}),c.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx(v,{htmlFor:"routingNumber",children:"Routing Number"}),c.jsx(f,{id:"routingNumber",value:ie.routingNumber,onChange:e=>te({...ie,routingNumber:e.target.value}),placeholder:"Optional",disabled:!ie.enabled})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(v,{htmlFor:"swiftCode",children:"SWIFT Code"}),c.jsx(f,{id:"swiftCode",value:ie.swiftCode,onChange:e=>te({...ie,swiftCode:e.target.value}),placeholder:"Optional",disabled:!ie.enabled})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(v,{htmlFor:"instructions",children:"Payment Instructions"}),c.jsx(f,{id:"instructions",value:ie.instructions,onChange:e=>te({...ie,instructions:e.target.value}),placeholder:"Include payment reference in transfer details",disabled:!ie.enabled})]}),c.jsxs(C,{variant:"brand",onClick:()=>Re.mutate(),disabled:Re.isPending||!ie.enabled,className:"btn-brand-primary",children:[Re.isPending&&c.jsx(d,{className:"mr-2 h-4 w-4 animate-spin"}),"Save Bank Transfer Settings"]})]})]})]})}),c.jsx(h,{value:"email",children:c.jsxs(p,{children:[c.jsxs(g,{children:[c.jsx(j,{children:"SMTP Email Configuration"}),c.jsx(b,{children:"Configure SMTP settings for sending system emails, notifications, and password resets"})]}),c.jsxs(x,{className:"space-y-6",children:[c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx(ee,{id:"smtp-enabled",checked:ce.enabled,onCheckedChange:e=>de({...ce,enabled:e})}),c.jsx(v,{htmlFor:"smtp-enabled",children:"Enable SMTP Email"})]}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"When enabled, the system will use SMTP to send emails for password resets, notifications, and other system communications."}),c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx(v,{htmlFor:"smtp-host",children:"SMTP Host"}),c.jsx(f,{id:"smtp-host",value:ce.host,onChange:e=>de({...ce,host:e.target.value}),placeholder:"smtp.example.com",disabled:!ce.enabled})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(v,{htmlFor:"smtp-username",children:"SMTP Username"}),c.jsx(f,{id:"smtp-username",value:ce.username,onChange:e=>de({...ce,username:e.target.value}),placeholder:"username@example.com",disabled:!ce.enabled})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(v,{htmlFor:"smtp-port",children:"SMTP Port"}),c.jsx(f,{id:"smtp-port",type:"number",value:ce.port,onChange:e=>{const s=parseInt(e.target.value)||587;let a=ce.security;465===s?a="ssl":587===s?a="starttls":25===s&&(a="none"),de({...ce,port:s,security:a})},placeholder:"587",disabled:!ce.enabled}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"Common ports: 587 (STARTTLS), 465 (SSL), 25 (No encryption)"})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(v,{htmlFor:"smtp-password",children:"SMTP Password"}),c.jsx(f,{id:"smtp-password",type:"password",value:ce.password,onChange:e=>de({...ce,password:e.target.value}),placeholder:"••••••••",disabled:!ce.enabled}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"For Gmail, use an App Password instead of your regular password"})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(v,{htmlFor:"smtp-security",children:"Security"}),c.jsxs(y,{value:ce.security,onValueChange:e=>de({...ce,security:e}),disabled:!ce.enabled,children:[c.jsx(k,{id:"smtp-security",children:c.jsx(N,{placeholder:"Select security"})}),c.jsxs(w,{children:[c.jsx(_,{value:"starttls",children:"STARTTLS (Port 587)"}),c.jsx(_,{value:"ssl",children:"SSL/TLS (Port 465)"}),c.jsx(_,{value:"none",children:"None (Port 25)"})]})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(v,{htmlFor:"smtp-from-email",children:"From Email Address"}),c.jsx(f,{id:"smtp-from-email",type:"email",value:ce.fromEmail,onChange:e=>de({...ce,fromEmail:e.target.value}),placeholder:"noreply@example.com",disabled:!ce.enabled})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(v,{htmlFor:"smtp-from-name",children:"From Name"}),c.jsx(f,{id:"smtp-from-name",value:ce.fromName,onChange:e=>de({...ce,fromName:e.target.value}),placeholder:"PowerChat Support",disabled:!ce.enabled})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(v,{htmlFor:"smtp-test-email",children:"Test Email Address"}),c.jsx(f,{id:"smtp-test-email",type:"email",value:ce.testEmail,onChange:e=>de({...ce,testEmail:e.target.value}),placeholder:"test@example.com",disabled:!ce.enabled}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"Email address to send test emails to"})]})]}),c.jsxs("div",{className:"flex space-x-2",children:[c.jsxs(C,{variant:"brand",onClick:()=>Le.mutate(),disabled:Le.isPending||!ce.enabled,className:"btn-brand-primary",children:[Le.isPending&&c.jsx(d,{className:"mr-2 h-4 w-4 animate-spin"}),"Save SMTP Settings"]}),c.jsxs(C,{variant:"brand",onClick:()=>ze.mutate(),disabled:ze.isPending||!ce.enabled||!ce.host||!ce.testEmail,children:[ze.isPending?c.jsx(d,{className:"mr-2 h-4 w-4 animate-spin"}):c.jsx(Pe,{className:"mr-2 h-4 w-4"}),"Test Connection"]})]})]})]})}),c.jsx(h,{value:"general",children:c.jsxs(p,{children:[c.jsxs(g,{children:[c.jsx(j,{children:"General Settings"}),c.jsx(b,{children:"Configure general application settings"})]}),c.jsxs(x,{className:"space-y-4",children:[c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx(v,{htmlFor:"defaultCurrency",children:"Default Currency"}),c.jsxs(y,{value:re.defaultCurrency,onValueChange:e=>le({...re,defaultCurrency:e}),children:[c.jsx(k,{id:"defaultCurrency",children:c.jsx(N,{placeholder:"Select currency"})}),c.jsxs(w,{children:[c.jsx(_,{value:"ARS",children:"ARS - Argentine Peso"}),c.jsx(_,{value:"BRL",children:"BRL - Brazilian Real"}),c.jsx(_,{value:"MXN",children:"MXN - Mexican Peso"}),c.jsx(_,{value:"CLP",children:"CLP - Chilean Peso"}),c.jsx(_,{value:"COP",children:"COP - Colombian Peso"}),c.jsx(_,{value:"PEN",children:"PEN - Peruvian Sol"}),c.jsx(_,{value:"UYU",children:"UYU - Uruguayan Peso"}),c.jsx(_,{value:"PYG",children:"PYG - Paraguayan Guarani"}),c.jsx(_,{value:"BOB",children:"BOB - Bolivian Boliviano"}),c.jsx(_,{value:"VEF",children:"VEF - Venezuelan Bolívar"}),c.jsx(_,{value:"PKR",children:"PKR - Pakistani Rupee"}),c.jsx(_,{value:"INR",children:"INR - Indian Rupee"}),c.jsx(_,{value:"USD",children:"USD - US Dollar"}),c.jsx(_,{value:"EUR",children:"EUR - Euro"})]})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(v,{htmlFor:"dateFormat",children:"Date Format"}),c.jsxs(y,{value:re.dateFormat,onValueChange:e=>le({...re,dateFormat:e}),children:[c.jsx(k,{id:"dateFormat",children:c.jsx(N,{placeholder:"Select date format"})}),c.jsxs(w,{children:[c.jsx(_,{value:"MM/DD/YYYY",children:"MM/DD/YYYY"}),c.jsx(_,{value:"DD/MM/YYYY",children:"DD/MM/YYYY"}),c.jsx(_,{value:"YYYY-MM-DD",children:"YYYY-MM-DD"})]})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(v,{htmlFor:"timeFormat",children:"Time Format"}),c.jsxs(y,{value:re.timeFormat,onValueChange:e=>le({...re,timeFormat:e}),children:[c.jsx(k,{id:"timeFormat",children:c.jsx(N,{placeholder:"Select time format"})}),c.jsxs(w,{children:[c.jsx(_,{value:"12h",children:"12-hour (AM/PM)"}),c.jsx(_,{value:"24h",children:"24-hour"})]})]})]})]}),c.jsxs(C,{variant:"brand",onClick:()=>Ge.mutate(),disabled:Ge.isPending,className:"btn-brand-primary",children:[Ge.isPending&&c.jsx(d,{className:"mr-2 h-4 w-4 animate-spin"}),"Save General Settings"]})]})]})}),c.jsx(h,{value:"registration",children:c.jsxs(p,{children:[c.jsxs(g,{children:[c.jsx(j,{children:"Company Registration Settings"}),c.jsx(b,{children:"Control how new companies can register for your platform"})]}),c.jsxs(x,{className:"space-y-6",children:[c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx(ee,{id:"registration-enabled",checked:H.enabled,onCheckedChange:e=>J({...H,enabled:e})}),c.jsx(v,{htmlFor:"registration-enabled",className:"text-sm font-medium",children:"Enable Company Registration"})]}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"When enabled, new companies can register for accounts. When disabled, the registration page will show a message that registration is currently unavailable."}),c.jsx(Z,{}),c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx(ee,{id:"registration-approval",checked:H.requireApproval,onCheckedChange:e=>J({...H,requireApproval:e}),disabled:!H.enabled}),c.jsx(v,{htmlFor:"registration-approval",className:"text-sm font-medium",children:"Require Admin Approval"})]}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"When enabled, new company registrations will require super admin approval before they can access the platform."}),c.jsx(Z,{}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(v,{htmlFor:"default-plan",children:"Default Plan for New Companies"}),c.jsxs(y,{value:H.defaultPlan,onValueChange:e=>J({...H,defaultPlan:e}),disabled:!H.enabled||ge,children:[c.jsx(k,{children:c.jsx(N,{placeholder:"Select default plan"})}),c.jsx(w,{children:ge?c.jsx(_,{value:"loading",disabled:!0,children:c.jsxs("div",{className:"flex items-center",children:[c.jsx(d,{className:"h-4 w-4 animate-spin mr-2"}),"Loading plans..."]})}):xe&&xe.length>0?xe.filter((e=>e.isActive)).map((e=>c.jsxs(_,{value:e.id.toString(),children:[e.name," ($",e.price,"/month) - ",e.maxUsers," users"]},e.id))):c.jsx(_,{value:"none",disabled:!0,children:"No plans available"})})]}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"New companies will be automatically assigned to this plan upon registration."})]}),c.jsxs(C,{variant:"brand",onClick:()=>{try{const s={enabled:Boolean(H.enabled),requireApproval:Boolean(H.requireApproval),defaultPlan:H.defaultPlan||(xe&&xe.length>0?xe[0].id.toString():"1")};if(s.enabled&&!s.defaultPlan)return void e({title:"Validation Error",description:"Default plan is required when registration is enabled",variant:"destructive"});Ye.mutate()}catch(s){e({title:"Error",description:"An unexpected error occurred",variant:"destructive"})}},disabled:Ye.isPending,className:"btn-brand-primary",children:[Ye.isPending&&c.jsx(d,{className:"mr-2 h-4 w-4 animate-spin"}),"Save Registration Settings"]})]})]})}),c.jsx(h,{value:"backup",children:c.jsx(Ae,{})}),c.jsx(h,{value:"updates",children:c.jsx(Be,{})}),c.jsx(h,{value:"maintenance",children:c.jsx(Oe,{})}),c.jsx(h,{value:"platform",children:c.jsxs(p,{children:[c.jsxs(g,{children:[c.jsx(j,{children:"Platform Configuration"}),c.jsx(b,{children:"Configure platform-wide integrations and partner API settings"})]}),c.jsx(x,{children:c.jsxs("div",{className:"space-y-6",children:[c.jsxs("div",{className:"border rounded-lg p-4",children:[c.jsxs("div",{className:"flex items-center justify-between mb-4",children:[c.jsxs("div",{children:[c.jsx("h3",{className:"text-lg font-medium",children:"360Dialog Partner API"}),c.jsx("p",{className:"text-sm text-gray-500",children:"Configure 360Dialog Partner credentials for company onboarding"})]}),c.jsxs(C,{onClick:()=>U(!0),variant:"outline",className:"btn-brand-primary",children:[c.jsx($,{className:"w-4 h-4 mr-2"}),"Configure"]})]}),c.jsxs("div",{className:"text-sm text-gray-600",children:[c.jsx("p",{children:"• Platform-wide Partner API integration"}),c.jsx("p",{children:"• Enables Integrated Onboarding for companies"}),c.jsx("p",{children:"• Manages client WhatsApp Business accounts"})]})]}),c.jsxs("div",{className:"border rounded-lg p-4",children:[c.jsxs("div",{className:"flex items-center justify-between mb-4",children:[c.jsxs("div",{children:[c.jsx("h3",{className:"text-lg font-medium",children:"Meta WhatsApp Business API"}),c.jsx("p",{className:"text-sm text-gray-500",children:"Configure Meta Tech Provider credentials for embedded signup"})]}),c.jsxs(C,{onClick:()=>R(!0),variant:"outline",className:"btn-brand-primary",children:[c.jsx($,{className:"w-4 h-4 mr-2"}),"Configure"]})]}),c.jsxs("div",{className:"text-sm text-gray-600",children:[c.jsx("p",{children:"• Tech Provider embedded signup integration"}),c.jsx("p",{children:"• Streamlined WhatsApp Business account onboarding"}),c.jsx("p",{children:"• Automatic phone number provisioning"})]})]})]})})]})})]}),c.jsx(Fe,{provider:"360dialog",isOpen:O,onClose:()=>U(!1),onSuccess:()=>{e({title:"Success",description:"360Dialog Partner configuration updated successfully"}),U(!1)}}),c.jsx(Ue,{isOpen:K,onClose:()=>R(!1),onSuccess:()=>{e({title:"Success",description:"Meta Partner configuration updated successfully"}),R(!1)}})]})})}export{Ke as default};
