import{q as e,f as s,g as a,r as n,h as i,i as t,aO as l,j as r,L as c,aF as d,aG as o,aH as m,aI as u,C as h,c as p,a as x,b as g,l as j,n as b,I as v,aq as y,ar as f,as as k,at as N,au as w,B as _,bC as C,O as S,Q as P,V as E,W as F,X as T,Y as M,H as D,bj as q,bD as A,bE as O,a3 as B,aE as I,T as K,a4 as R,a5 as U,a6 as G,a7 as L,a8 as z,a9 as Y,aa as V,P as Q,S as W,k as $,o as H,bs as J,bF as X,aw as Z,bz as ee,bG as se,y as ae,D as ne,t as ie,v as te,w as le,x as re,E as ce,bH as de,s as oe,d as me,bI as ue,A as he,m as pe,bJ as xe,a0 as ge,bK as je,u as be,bv as ve,bL as ye,bM as fe,e as ke,K as Ne,G as we,br as _e,bN as Ce,U as Se,aK as Pe}from"./index-Du4k3PvU.js";import{D as Ee}from"./database-BxMGUDNc.js";const Fe=e("Cloud",[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]]),Te=e("FileImage",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["circle",{cx:"10",cy:"12",r:"2",key:"737tya"}],["path",{d:"m20 17-1.296-1.296a2.41 2.41 0 0 0-3.408 0L9 22",key:"wt3hpn"}]]),Me=e("HardDrive",[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]]),De=e("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]);function qe(){var e,ue,he,pe,xe,ge;const{toast:je}=s(),{t:be}=a(),[ve,ye]=n.useState("overview"),[fe,ke]=n.useState(""),[Ne,we]=n.useState(["local"]),[_e,Ce]=n.useState(!1),[Se,Pe]=n.useState(null),[Te,De]=n.useState("warning"),[qe,Ae]=n.useState(""),[Oe,Be]=n.useState(null),[Ie,Ke]=n.useState(!1),[Re,Ue]=n.useState(null),[Ge,Le]=n.useState({name:"",frequency:"daily",time:"02:00",day_of_week:0,day_of_month:1,storage_locations:["local"],enabled:!0}),[ze,Ye]=n.useState({retention_days:30,default_storage_locations:["local"],google_drive:{enabled:!1,folder_id:null,credentials:null},encryption:{enabled:!1,key:null},notifications:{enabled:!1,email:"",on_success:!0,on_failure:!0},cleanup:{enabled:!0,time:"03:00"}}),[Ve,Qe]=n.useState({client_id:"",client_secret:"",redirect_uri:"http://localhost:3000/admin/settings?tab=backup"}),[We,$e]=n.useState(!1),[He,Je]=n.useState(!1),[Xe,Ze]=n.useState({description:"",storage_locations:["local"],file:null}),[es,ss]=n.useState(0),[as,ns]=n.useState(!1),{data:is,isLoading:ts}=i({queryKey:["/api/admin/backup/config"],queryFn:async()=>{const e=await me("GET","/api/admin/backup/config");if(!e.ok)throw new Error("Failed to fetch backup configuration");return e.json()}}),{data:ls,isLoading:rs}=i({queryKey:["/api/admin/backup/list"],queryFn:async()=>{const e=await me("GET","/api/admin/backup/list");if(!e.ok)throw new Error("Failed to fetch backups");return e.json()}}),{data:cs,isLoading:ds}=i({queryKey:["/api/admin/backup/stats"],queryFn:async()=>{const e=await me("GET","/api/admin/backup/stats");if(!e.ok)throw new Error("Failed to fetch backup statistics");return e.json()}}),{data:os,isLoading:ms}=i({queryKey:["/api/admin/backup/google-drive/oauth-config"],queryFn:async()=>{const e=await me("GET","/api/admin/backup/google-drive/oauth-config");if(!e.ok)throw new Error("Failed to fetch OAuth configuration");return e.json()}}),us=t({mutationFn:async()=>{const e=await me("POST","/api/admin/backup/create",{description:fe||be("admin.backup.default_description","Manual backup"),storage_locations:Ne});if(!e.ok)throw new Error("Failed to create backup");return e.json()},onSuccess:()=>{je({title:be("common.success","Success"),description:be("admin.backup.messages.backup_started","Backup creation started successfully")}),ke(""),oe.invalidateQueries({queryKey:["/api/admin/backup/list"]}),oe.invalidateQueries({queryKey:["/api/admin/backup/stats"]})},onError:e=>{je({title:be("common.error","Error"),description:e.message,variant:"destructive"})}}),hs=t({mutationFn:async e=>{const s=await me("DELETE",`/api/admin/backup/${e}`);if(!s.ok)throw new Error("Failed to delete backup");return s.json()},onSuccess:()=>{je({title:be("common.success","Success"),description:be("admin.backup.messages.backup_deleted","Backup deleted successfully")}),oe.invalidateQueries({queryKey:["/api/admin/backup/list"]}),oe.invalidateQueries({queryKey:["/api/admin/backup/stats"]})},onError:e=>{je({title:be("common.error","Error"),description:e.message,variant:"destructive"})}}),ps=t({mutationFn:async e=>{const s=await me("POST",`/api/admin/backup/verify/${e}`);if(!s.ok)throw new Error("Failed to verify backup");return s.json()},onSuccess:e=>{je({title:e.valid?be("admin.backup.messages.backup_valid","Backup Valid"):be("admin.backup.messages.backup_invalid","Backup Invalid"),description:e.message,variant:e.valid?"default":"destructive"})},onError:e=>{je({title:be("common.error","Error"),description:e.message,variant:"destructive"})}}),xs=t({mutationFn:async({file:e,description:s,storage_locations:a})=>{const n=new FormData;return n.append("backup",e),n.append("description",s),n.append("storage_locations",JSON.stringify(a)),new Promise(((e,s)=>{const a=new XMLHttpRequest;a.upload.onprogress=e=>{if(e.lengthComputable){const s=Math.round(e.loaded/e.total*100);ss(s)}},a.onload=()=>{if(200===a.status)try{const s=JSON.parse(a.responseText);e(s)}catch(n){s(new Error("Invalid response format"))}else try{const e=JSON.parse(a.responseText);s(new Error(e.error||"Upload failed"))}catch(n){s(new Error(`Upload failed with status ${a.status}`))}},a.onerror=()=>s(new Error("Network error during upload")),a.open("POST","/api/admin/backup/upload"),a.send(n)}))},onMutate:()=>{ns(!0),ss(0)},onSuccess:()=>{je({title:be("common.success","Success"),description:be("admin.backup.messages.backup_uploaded","Backup uploaded successfully")}),Je(!1),ys(),oe.invalidateQueries({queryKey:["/api/admin/backup/list"]}),oe.invalidateQueries({queryKey:["/api/admin/backup/stats"]})},onError:e=>{je({title:be("common.error","Error"),description:e.message,variant:"destructive"})},onSettled:()=>{ns(!1),ss(0)}}),gs=t({mutationFn:async({backupId:e,confirmationText:s})=>{Be({status:"downloading",message:be("admin.backup.restore.preparing","Preparing restoration...")});const a=await me("POST",`/api/admin/backup/restore/${e}`,{confirmationText:s});if(!a.ok)throw new Error("Failed to restore backup");return a.json()},onSuccess:e=>{e.success?(Be({status:"completed",message:e.message}),je({title:be("admin.backup.messages.restore_successful","Restore Successful"),description:e.message}),setTimeout((()=>{oe.invalidateQueries({queryKey:["/api/admin/backup/list"]}),oe.invalidateQueries({queryKey:["/api/admin/backup/stats"]}),Ce(!1),js()}),3e3)):(Be({status:"failed",message:e.message}),je({title:be("admin.backup.messages.restore_failed","Restore Failed"),description:e.message,variant:"destructive"}))},onError:e=>{Be({status:"failed",message:e.message}),je({title:be("admin.backup.messages.restore_error","Restore Error"),description:e.message,variant:"destructive"})}}),js=()=>{Pe(null),De("warning"),Ae(""),Be(null)},bs=e=>"creating"===e.status||"failed"===e.status||"uploading"===e.status,vs=()=>(null==Se?void 0:Se.filename)||"RESTORE",ys=()=>{Ze({description:"",storage_locations:["local"],file:null}),ss(0),ns(!1)},fs=t({mutationFn:async e=>{var s;const a={...is,schedules:Re?(null==(s=null==is?void 0:is.schedules)?void 0:s.map((s=>s.id===Re.id?{...e,id:Re.id}:s)))||[]:[...(null==is?void 0:is.schedules)||[],{...e,id:crypto.randomUUID()}]},n=await me("POST","/api/admin/backup/config",a);if(!n.ok)throw new Error("Failed to save schedule");return n.json()},onSuccess:()=>{je({title:be("common.success","Success"),description:Re?be("admin.backup.messages.schedule_updated","Schedule updated successfully"):be("admin.backup.messages.schedule_created","Schedule created successfully")}),Ke(!1),Fs(),oe.invalidateQueries({queryKey:["/api/admin/backup/config"]})},onError:e=>{je({title:be("common.error","Error"),description:e.message,variant:"destructive"})}}),ks=t({mutationFn:async e=>{var s;const a={...is,schedules:(null==(s=null==is?void 0:is.schedules)?void 0:s.filter((s=>s.id!==e)))||[]},n=await me("POST","/api/admin/backup/config",a);if(!n.ok)throw new Error("Failed to delete schedule");return n.json()},onSuccess:()=>{je({title:be("common.success","Success"),description:be("admin.backup.messages.schedule_deleted","Schedule deleted successfully")}),oe.invalidateQueries({queryKey:["/api/admin/backup/config"]})},onError:e=>{je({title:be("common.error","Error"),description:e.message,variant:"destructive"})}}),Ns=t({mutationFn:async({scheduleId:e,enabled:s})=>{var a;const n={...is,schedules:(null==(a=null==is?void 0:is.schedules)?void 0:a.map((a=>a.id===e?{...a,enabled:s}:a)))||[]},i=await me("POST","/api/admin/backup/config",n);if(!i.ok)throw new Error("Failed to update schedule");return i.json()},onSuccess:()=>{oe.invalidateQueries({queryKey:["/api/admin/backup/config"]})},onError:e=>{je({title:be("common.error","Error"),description:e.message,variant:"destructive"})}}),ws=t({mutationFn:async e=>{const s=await me("POST","/api/admin/backup/config",e);if(!s.ok)throw new Error("Failed to save settings");return s.json()},onSuccess:()=>{je({title:be("common.success","Success"),description:be("admin.backup.messages.settings_saved","Settings saved successfully")}),oe.invalidateQueries({queryKey:["/api/admin/backup/config"]})},onError:e=>{je({title:be("common.error","Error"),description:e.message,variant:"destructive"})}}),_s=t({mutationFn:async()=>{const e=await me("POST","/api/admin/backup/google-drive/test");if(!e.ok)throw new Error("Failed to test Google Drive connection");return e.json()},onSuccess:e=>{je({title:e.success?be("admin.backup.messages.connection_successful","Connection Successful"):be("admin.backup.messages.connection_failed","Connection Failed"),description:e.message,variant:e.success?"default":"destructive"})},onError:e=>{je({title:be("common.error","Error"),description:e.message,variant:"destructive"})}}),Cs=t({mutationFn:async e=>{const s=await me("POST","/api/admin/backup/google-drive/oauth-config",e);if(!s.ok)throw new Error("Failed to save OAuth configuration");return s.json()},onSuccess:e=>{e.success?(je({title:be("common.success","Success"),description:e.message}),$e(!1),oe.invalidateQueries({queryKey:["/api/admin/backup/google-drive/oauth-config"]}),oe.invalidateQueries({queryKey:["/api/admin/backup/config"]})):je({title:be("common.error","Error"),description:e.message,variant:"destructive"})},onError:e=>{je({title:be("common.error","Error"),description:e.message,variant:"destructive"})}}),Ss=t({mutationFn:async()=>{const e=await me("DELETE","/api/admin/backup/google-drive/oauth-config");if(!e.ok)throw new Error("Failed to clear OAuth configuration");return e.json()},onSuccess:e=>{e.success?(je({title:be("common.success","Success"),description:e.message}),oe.invalidateQueries({queryKey:["/api/admin/backup/google-drive/oauth-config"]}),oe.invalidateQueries({queryKey:["/api/admin/backup/config"]})):je({title:be("common.error","Error"),description:e.message,variant:"destructive"})},onError:e=>{je({title:be("common.error","Error"),description:e.message,variant:"destructive"})}}),Ps=t({mutationFn:async()=>{const e=await me("POST","/api/admin/backup/google-drive/oauth-validate");if(!e.ok)throw new Error("Failed to validate OAuth configuration");return e.json()},onSuccess:e=>{je({title:e.valid?be("admin.backup.messages.validation_successful","Validation Successful"):be("admin.backup.messages.validation_failed","Validation Failed"),description:e.message,variant:e.valid?"default":"destructive"})},onError:e=>{je({title:be("common.error","Error"),description:e.message,variant:"destructive"})}}),Es=e=>{e?(Ue(e),Le({name:e.id,frequency:e.frequency,time:e.time,day_of_week:e.day_of_week||0,day_of_month:e.day_of_month||1,storage_locations:e.storage_locations,enabled:e.enabled})):(Ue(null),Fs()),Ke(!0)},Fs=()=>{Le({name:"",frequency:"daily",time:"02:00",day_of_week:0,day_of_month:1,storage_locations:["local"],enabled:!0})},Ts=()=>{Qe({client_id:"",client_secret:"",redirect_uri:"http://localhost:3000/admin/settings?tab=backup"}),$e(!1)};l.useEffect((()=>{is&&Ye({retention_days:is.retention_days||30,default_storage_locations:is.storage_locations||["local"],google_drive:is.google_drive||{enabled:!1,folder_id:null,credentials:null},encryption:is.encryption||{enabled:!1,key:null},notifications:{enabled:!1,email:"",on_success:!0,on_failure:!0},cleanup:{enabled:!0,time:"03:00"}})}),[is]),l.useEffect((()=>{os&&os.configured&&Qe({client_id:os.client_id||"",client_secret:"",redirect_uri:os.redirect_uri||"http://localhost:3000/admin/settings?tab=backup"})}),[os]);const Ms=e=>{if(0===e)return`0 ${be("common.file_size.bytes","Bytes")}`;const s=[be("common.file_size.bytes","Bytes"),be("common.file_size.kb","KB"),be("common.file_size.mb","MB"),be("common.file_size.gb","GB"),be("common.file_size.tb","TB")],a=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,a)).toFixed(2))+" "+s[a]},Ds=e=>new Date(e).toLocaleString(),qs=e=>{const s={creating:{variant:"secondary",icon:c,text:be("admin.backup.status.creating","Creating")},completed:{variant:"default",icon:H,text:be("admin.backup.status.completed","Completed")},failed:{variant:"destructive",icon:$,text:be("admin.backup.status.failed","Failed")},uploading:{variant:"secondary",icon:Fe,text:be("admin.backup.status.uploading","Uploading")},uploaded:{variant:"default",icon:Fe,text:be("admin.backup.status.uploaded","Uploaded")}},a=s[e]||s.completed,n=a.icon;return r.jsxs(D,{variant:a.variant,className:"flex items-center gap-1",children:[r.jsx(n,{className:"h-3 w-3"}),a.text]})};return ts||rs||ds||ms?r.jsxs("div",{className:"flex items-center justify-center py-8",children:[r.jsx(c,{className:"h-8 w-8 animate-spin mr-2"}),r.jsx("span",{children:be("admin.backup.loading","Loading backup system...")})]}):r.jsxs("div",{className:"space-y-6",children:[r.jsxs(d,{value:ve,onValueChange:ye,children:[r.jsxs(o,{className:"grid w-full grid-cols-4",children:[r.jsx(m,{value:"overview",children:be("admin.backup.tabs.overview","Overview")}),r.jsx(m,{value:"backups",children:be("admin.backup.tabs.backups","Backups")}),r.jsx(m,{value:"schedules",children:be("admin.backup.tabs.schedules","Schedules")}),r.jsx(m,{value:"settings",children:be("admin.backup.tabs.settings","Settings")})]}),r.jsxs(u,{value:"overview",className:"space-y-6",children:[r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[r.jsx(h,{children:r.jsx(p,{className:"p-6",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:be("admin.backup.stats.total_backups","Total Backups")}),r.jsx("p",{className:"text-2xl font-bold",children:(null==cs?void 0:cs.total_backups)||0})]}),r.jsx(Ee,{className:"h-8 w-8 text-muted-foreground"})]})})}),r.jsx(h,{children:r.jsx(p,{className:"p-6",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:be("admin.backup.stats.total_size","Total Size")}),r.jsx("p",{className:"text-2xl font-bold",children:Ms((null==cs?void 0:cs.total_size)||0)})]}),r.jsx(Me,{className:"h-8 w-8 text-muted-foreground"})]})})}),r.jsx(h,{children:r.jsx(p,{className:"p-6",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:be("admin.backup.stats.local_backups","Local Backups")}),r.jsx("p",{className:"text-2xl font-bold",children:(null==cs?void 0:cs.local_backups)||0})]}),r.jsx(Me,{className:"h-8 w-8 text-muted-foreground"})]})})}),r.jsx(h,{children:r.jsx(p,{className:"p-6",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:be("admin.backup.stats.cloud_backups","Cloud Backups")}),r.jsx("p",{className:"text-2xl font-bold",children:(null==cs?void 0:cs.cloud_backups)||0})]}),r.jsx(Fe,{className:"h-8 w-8 text-muted-foreground"})]})})})]}),r.jsxs(h,{children:[r.jsxs(x,{children:[r.jsx(g,{children:be("admin.backup.quick_actions.title","Quick Actions")}),r.jsx(j,{children:be("admin.backup.quick_actions.description","Create manual backups and manage your backup system")})]}),r.jsx(p,{className:"space-y-4",children:r.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[r.jsxs("div",{className:"flex-1",children:[r.jsx(b,{htmlFor:"manual-description",children:be("admin.backup.quick_actions.backup_description","Backup Description")}),r.jsx(v,{id:"manual-description",placeholder:be("admin.backup.quick_actions.backup_description_placeholder","Enter backup description..."),value:fe,onChange:e=>ke(e.target.value)})]}),r.jsxs("div",{className:"flex-1",children:[r.jsx(b,{children:be("admin.backup.quick_actions.storage_locations","Storage Locations")}),r.jsxs(y,{value:Ne[0],onValueChange:e=>we([e]),children:[r.jsx(f,{children:r.jsx(k,{})}),r.jsxs(N,{children:[r.jsx(w,{value:"local",children:be("admin.backup.storage.local","Local Storage")}),r.jsxs(w,{value:"google_drive",disabled:!(null==(e=null==is?void 0:is.google_drive)?void 0:e.enabled),children:[be("admin.backup.storage.google_drive","Google Drive")," ",!(null==(ue=null==is?void 0:is.google_drive)?void 0:ue.enabled)&&be("admin.backup.storage.not_connected","(Not Connected)")]})]})]})]}),r.jsx("div",{className:"flex items-end",children:r.jsxs(_,{onClick:()=>us.mutate(),disabled:us.isPending,className:"w-full sm:w-auto",children:[us.isPending?r.jsx(c,{className:"h-4 w-4 animate-spin mr-2"}):r.jsx(Ee,{className:"h-4 w-4 mr-2"}),be("admin.backup.actions.create_backup","Create Backup")]})})]})})]})]}),r.jsxs(u,{value:"backups",className:"space-y-6",children:[r.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6",children:[r.jsxs("div",{children:[r.jsx("h2",{className:"text-2xl font-bold",children:be("admin.backup.history.title","Backup History")}),r.jsx("p",{className:"text-muted-foreground",children:be("admin.backup.history.description","View and manage all database backups")})]}),r.jsxs(_,{onClick:()=>Je(!0),className:"flex items-center gap-2",disabled:as,children:[r.jsx(C,{className:"h-4 w-4"}),be("admin.backup.actions.upload_backup","Upload Backup")]})]}),r.jsx(h,{children:r.jsx(p,{className:"pt-6",children:ls&&ls.length>0?r.jsxs(S,{children:[r.jsx(P,{children:r.jsxs(E,{children:[r.jsx(F,{children:be("admin.backup.table.filename","Filename")}),r.jsx(F,{children:be("admin.backup.table.type","Type")}),r.jsx(F,{children:be("admin.backup.table.size","Size")}),r.jsx(F,{children:be("admin.backup.table.status","Status")}),r.jsx(F,{children:be("admin.backup.table.storage","Storage")}),r.jsx(F,{children:be("admin.backup.table.created","Created")}),r.jsx(F,{children:be("admin.backup.table.actions","Actions")})]})}),r.jsx(T,{children:ls.map((e=>r.jsxs(E,{children:[r.jsx(M,{className:"font-medium",children:r.jsxs("div",{children:[r.jsx("div",{children:e.filename}),r.jsx("div",{className:"text-sm text-muted-foreground",children:e.description})]})}),r.jsx(M,{children:r.jsx(D,{variant:"manual"===e.type?"default":"secondary",children:e.type})}),r.jsx(M,{children:Ms(e.size)}),r.jsx(M,{children:qs(e.status)}),r.jsx(M,{children:r.jsxs("div",{className:"flex gap-1",children:[e.storage_locations.includes("local")&&r.jsxs(D,{variant:"outline",className:"text-xs",children:[r.jsx(Me,{className:"h-3 w-3 mr-1"}),be("admin.backup.storage.local","Local")]}),e.storage_locations.includes("google_drive")&&r.jsxs(D,{variant:"outline",className:"text-xs",children:[r.jsx(Fe,{className:"h-3 w-3 mr-1"}),be("admin.backup.storage.drive","Drive")]})]})}),r.jsx(M,{children:Ds(e.created_at)}),r.jsx(M,{children:r.jsxs("div",{className:"flex gap-2",children:[r.jsx(_,{size:"sm",variant:"outline",onClick:()=>window.open(`/api/admin/backup/download/${e.id}`,"_blank"),disabled:"completed"!==e.status&&"uploaded"!==e.status,title:be("admin.backup.actions.download_backup","Download backup"),children:r.jsx(q,{className:"h-4 w-4"})}),r.jsx(_,{size:"sm",variant:"outline",onClick:()=>ps.mutate(e.id),disabled:ps.isPending||"completed"!==e.status,title:be("admin.backup.actions.verify_backup","Verify backup integrity"),children:r.jsx(A,{className:"h-4 w-4"})}),r.jsx(_,{size:"sm",variant:"outline",onClick:()=>(e=>{Pe(e),Ce(!0),De("warning"),Ae(""),Be(null)})(e),disabled:bs(e)||gs.isPending,title:be("admin.backup.actions.restore_backup","Restore database from this backup"),className:"text-orange-600 hover:text-orange-700 hover:bg-orange-50",children:r.jsx(O,{className:"h-4 w-4"})}),r.jsxs(B,{children:[r.jsx(I,{asChild:!0,children:r.jsx(_,{size:"sm",variant:"outline",title:be("admin.backup.actions.delete_backup","Delete backup"),children:r.jsx(K,{className:"h-4 w-4"})})}),r.jsxs(R,{children:[r.jsxs(U,{children:[r.jsx(G,{children:be("admin.backup.dialogs.delete_backup_title","Delete Backup")}),r.jsx(L,{children:be("admin.backup.dialogs.delete_backup_description","Are you sure you want to delete this backup? This action cannot be undone.")})]}),r.jsxs(z,{children:[r.jsx(Y,{children:be("common.cancel","Cancel")}),r.jsx(V,{onClick:()=>hs.mutate(e.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:be("common.delete","Delete")})]})]})]})]})})]},e.id)))})]}):r.jsxs("div",{className:"text-center py-8",children:[r.jsx(Ee,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),r.jsx("h3",{className:"text-lg font-medium mb-2",children:be("admin.backup.empty.title","No Backups Found")}),r.jsx("p",{className:"text-muted-foreground mb-4",children:be("admin.backup.empty.description","Create your first backup to get started")}),r.jsx(_,{onClick:()=>ye("overview"),children:be("admin.backup.actions.create_backup","Create Backup")})]})})})]}),r.jsxs(u,{value:"schedules",className:"space-y-6",children:[r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsxs("div",{children:[r.jsx("h2",{className:"text-2xl font-bold",children:be("admin.backup.schedules.title","Backup Schedules")}),r.jsx("p",{className:"text-muted-foreground",children:be("admin.backup.schedules.description","Configure automated backup schedules")})]}),r.jsxs(_,{onClick:()=>Es(),className:"flex items-center gap-2",children:[r.jsx(Q,{className:"h-4 w-4"}),be("admin.backup.schedules.new_schedule","New Schedule")]})]}),r.jsxs(h,{children:[r.jsxs(x,{children:[r.jsx(g,{children:be("admin.backup.schedules.active_title","Active Schedules")}),r.jsx(j,{children:be("admin.backup.schedules.active_description","Manage your automated backup schedules")})]}),r.jsx(p,{children:(null==is?void 0:is.schedules)&&is.schedules.length>0?r.jsxs(S,{children:[r.jsx(P,{children:r.jsxs(E,{children:[r.jsx(F,{children:be("admin.backup.schedules.table.name","Schedule Name")}),r.jsx(F,{children:be("admin.backup.schedules.table.frequency","Frequency")}),r.jsx(F,{children:be("admin.backup.schedules.table.time","Time")}),r.jsx(F,{children:be("admin.backup.schedules.table.next_run","Next Run")}),r.jsx(F,{children:be("admin.backup.schedules.table.storage","Storage")}),r.jsx(F,{children:be("admin.backup.schedules.table.status","Status")}),r.jsx(F,{children:be("admin.backup.schedules.table.actions","Actions")})]})}),r.jsx(T,{children:is.schedules.map((e=>{const s=(e=>{const s=new Date,[a,n]=e.time.split(":").map(Number);let i=new Date;switch(i.setHours(a,n,0,0),e.frequency){case"daily":i<=s&&i.setDate(i.getDate()+1);break;case"weekly":let a=(e.day_of_week||0)-i.getDay();(a<=0||0===a&&i<=s)&&(a+=7),i.setDate(i.getDate()+a);break;case"monthly":const n=e.day_of_month||1;i.setDate(n),i<=s&&i.setMonth(i.getMonth()+1)}return i})(e);return r.jsxs(E,{children:[r.jsx(M,{className:"font-medium",children:e.id}),r.jsx(M,{children:r.jsxs("div",{className:"flex flex-col",children:[r.jsx("span",{className:"capitalize",children:e.frequency}),"weekly"===e.frequency&&r.jsx("span",{className:"text-xs text-muted-foreground",children:(a=e.day_of_week||0,[be("admin.backup.days.sunday","Sunday"),be("admin.backup.days.monday","Monday"),be("admin.backup.days.tuesday","Tuesday"),be("admin.backup.days.wednesday","Wednesday"),be("admin.backup.days.thursday","Thursday"),be("admin.backup.days.friday","Friday"),be("admin.backup.days.saturday","Saturday")][a]||be("admin.backup.days.sunday","Sunday"))}),"monthly"===e.frequency&&r.jsxs("span",{className:"text-xs text-muted-foreground",children:["Day ",e.day_of_month||1]})]})}),r.jsx(M,{children:e.time}),r.jsx(M,{children:r.jsxs("div",{className:"flex flex-col",children:[r.jsx("span",{children:s.toLocaleDateString()}),r.jsx("span",{className:"text-xs text-muted-foreground",children:s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})}),r.jsx(M,{children:r.jsxs("div",{className:"flex gap-1",children:[e.storage_locations.includes("local")&&r.jsxs(D,{variant:"outline",className:"text-xs",children:[r.jsx(Me,{className:"h-3 w-3 mr-1"}),"Local"]}),e.storage_locations.includes("google_drive")&&r.jsxs(D,{variant:"outline",className:"text-xs",children:[r.jsx(Fe,{className:"h-3 w-3 mr-1"}),"Drive"]})]})}),r.jsx(M,{children:r.jsx(D,{variant:e.enabled?"default":"secondary",children:e.enabled?be("admin.backup.schedules.status.enabled","Enabled"):be("admin.backup.schedules.status.disabled","Disabled")})}),r.jsx(M,{children:r.jsxs("div",{className:"flex gap-2",children:[r.jsx(_,{size:"sm",variant:"outline",onClick:()=>Es(e),title:be("admin.backup.actions.edit_schedule","Edit schedule"),children:r.jsx(W,{className:"h-4 w-4"})}),r.jsx(_,{size:"sm",variant:"outline",onClick:()=>Ns.mutate({scheduleId:e.id,enabled:!e.enabled}),title:e.enabled?be("admin.backup.actions.disable_schedule","Disable schedule"):be("admin.backup.actions.enable_schedule","Enable schedule"),children:e.enabled?r.jsx($,{className:"h-4 w-4"}):r.jsx(H,{className:"h-4 w-4"})}),r.jsxs(B,{children:[r.jsx(I,{asChild:!0,children:r.jsx(_,{size:"sm",variant:"outline",title:be("admin.backup.actions.delete_schedule","Delete schedule"),children:r.jsx(K,{className:"h-4 w-4"})})}),r.jsxs(R,{children:[r.jsxs(U,{children:[r.jsx(G,{children:be("admin.backup.dialogs.delete_schedule_title","Delete Schedule")}),r.jsx(L,{children:be("admin.backup.dialogs.delete_schedule_description","Are you sure you want to delete this backup schedule? This action cannot be undone.")})]}),r.jsxs(z,{children:[r.jsx(Y,{children:be("common.cancel","Cancel")}),r.jsx(V,{onClick:()=>ks.mutate(e.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:be("common.delete","Delete")})]})]})]})]})})]},e.id);var a}))})]}):r.jsxs("div",{className:"text-center py-8",children:[r.jsx(J,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),r.jsx("h3",{className:"text-lg font-medium mb-2",children:be("admin.backup.schedules.empty.title","No Schedules Configured")}),r.jsx("p",{className:"text-muted-foreground mb-4",children:be("admin.backup.schedules.empty.description","Create your first automated backup schedule to get started")}),r.jsxs(_,{onClick:()=>Es(),children:[r.jsx(Q,{className:"h-4 w-4 mr-2"}),be("admin.backup.schedules.actions.create","Create Schedule")]})]})})]})]}),r.jsxs(u,{value:"settings",className:"space-y-6",children:[r.jsxs(h,{children:[r.jsxs(x,{children:[r.jsx(g,{children:be("admin.backup.settings.general_title","General Settings")}),r.jsx(j,{children:be("admin.backup.settings.general_description","Configure global backup system preferences")})]}),r.jsxs(p,{className:"space-y-6",children:[r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsx(b,{htmlFor:"retention-days",children:be("admin.backup.settings.retention_label","Backup Retention Period (days)")}),r.jsx(v,{id:"retention-days",type:"number",min:"1",max:"365",value:ze.retention_days,onChange:e=>Ye({...ze,retention_days:parseInt(e.target.value)||30})}),r.jsx("p",{className:"text-xs text-muted-foreground",children:be("admin.backup.settings.retention_help","Backups older than this will be automatically deleted")})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(b,{children:be("admin.backup.settings.default_storage_locations","Default Storage Locations")}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx("input",{type:"checkbox",id:"default-local",checked:ze.default_storage_locations.includes("local"),onChange:e=>{const s=e.target.checked?[...ze.default_storage_locations,"local"]:ze.default_storage_locations.filter((e=>"local"!==e));Ye({...ze,default_storage_locations:s})}}),r.jsx(b,{htmlFor:"default-local",className:"text-sm",children:be("admin.backup.storage.local","Local Storage")})]}),r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx("input",{type:"checkbox",id:"default-drive",checked:ze.default_storage_locations.includes("google_drive"),onChange:e=>{const s=e.target.checked?[...ze.default_storage_locations,"google_drive"]:ze.default_storage_locations.filter((e=>"google_drive"!==e));Ye({...ze,default_storage_locations:s})},disabled:!ze.google_drive.enabled}),r.jsxs(b,{htmlFor:"default-drive",className:"text-sm",children:[be("admin.backup.storage.google_drive","Google Drive")," ",!ze.google_drive.enabled&&be("admin.backup.storage.not_connected","(Not Connected)")]})]})]}),r.jsx("p",{className:"text-xs text-muted-foreground",children:be("admin.backup.settings.default_storage_help","Default storage locations for new backups")})]})]}),r.jsx(X,{}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium",children:"Automatic Cleanup"}),r.jsx("p",{className:"text-sm text-muted-foreground",children:"Automatically delete old backups based on retention period"})]}),r.jsx(Z,{checked:ze.cleanup.enabled,onCheckedChange:e=>Ye({...ze,cleanup:{...ze.cleanup,enabled:e}})})]}),ze.cleanup.enabled&&r.jsxs("div",{className:"space-y-2",children:[r.jsx(b,{htmlFor:"cleanup-time",children:"Cleanup Time"}),r.jsx(v,{id:"cleanup-time",type:"time",value:ze.cleanup.time,onChange:e=>Ye({...ze,cleanup:{...ze.cleanup,time:e.target.value}}),className:"w-32"}),r.jsx("p",{className:"text-xs text-muted-foreground",children:"Daily time when cleanup will run"})]})]})]})]}),r.jsxs(h,{children:[r.jsxs(x,{children:[r.jsx(g,{children:be("admin.backup.google_drive.title","Google Drive Integration")}),r.jsx(j,{children:be("admin.backup.google_drive.description","Configure OAuth 2.0 credentials and cloud storage backup options")})]}),r.jsxs(p,{className:"space-y-6",children:[r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium",children:be("admin.backup.oauth.configuration_title","OAuth 2.0 Configuration")}),r.jsx("p",{className:"text-sm text-muted-foreground",children:be("admin.backup.oauth.configuration_description","Configure Google OAuth credentials for Drive access")})]}),r.jsx("div",{className:"flex items-center gap-2",children:(null==os?void 0:os.configured)?r.jsxs(D,{variant:"default",className:"bg-green-100 text-green-800",children:[r.jsx(H,{className:"h-3 w-3 mr-1"}),be("admin.backup.oauth.configured_status","Configured")]}):r.jsxs(D,{variant:"secondary",children:[r.jsx($,{className:"h-3 w-3 mr-1"}),be("admin.backup.oauth.not_configured_status","Not Configured")]})})]}),(null==os?void 0:os.configured)&&r.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx(H,{className:"h-5 w-5 text-green-600 mt-0.5 flex-shrink-0"}),r.jsxs("div",{className:"flex-1",children:[r.jsx("h4",{className:"font-medium text-green-800 mb-2",children:be("admin.backup.oauth.credentials_configured","OAuth Credentials Configured")}),r.jsxs("div",{className:"text-sm text-green-700 space-y-1",children:[r.jsxs("p",{children:[r.jsxs("strong",{children:[be("admin.backup.oauth.client_id","Client ID"),":"]})," ",os.client_id]}),r.jsxs("p",{children:[r.jsxs("strong",{children:[be("admin.backup.oauth.redirect_uri","Redirect URI"),":"]})," ",os.redirect_uri]}),r.jsxs("p",{children:[r.jsxs("strong",{children:[be("admin.backup.oauth.source","Source"),":"]})," ","ui"===os.source?be("admin.backup.oauth.admin_interface","Admin Interface"):be("admin.backup.oauth.environment_variables","Environment Variables")]}),os.configured_at&&"Environment Variables"!==os.configured_at&&r.jsxs("p",{children:[r.jsxs("strong",{children:[be("admin.backup.oauth.configured","Configured"),":"]})," ",new Date(os.configured_at).toLocaleString()]})]}),r.jsxs("div",{className:"flex gap-2 mt-3",children:[r.jsxs(_,{size:"sm",variant:"outline",onClick:()=>Ps.mutate(),disabled:Ps.isPending,children:[Ps.isPending?r.jsx(c,{className:"h-4 w-4 mr-2 animate-spin"}):r.jsx(A,{className:"h-4 w-4 mr-2"}),be("admin.backup.oauth.validate_credentials","Validate Credentials")]}),"ui"===os.source&&r.jsxs(_,{size:"sm",variant:"outline",onClick:()=>$e(!0),children:[r.jsx(W,{className:"h-4 w-4 mr-2"}),be("admin.backup.oauth.update_credentials","Update Credentials")]}),r.jsxs(B,{children:[r.jsx(I,{asChild:!0,children:r.jsxs(_,{size:"sm",variant:"outline",className:"text-red-600 hover:text-red-700",children:[r.jsx(K,{className:"h-4 w-4 mr-2"}),be("admin.backup.oauth.clear_credentials","Clear Credentials")]})}),r.jsxs(R,{children:[r.jsxs(U,{children:[r.jsx(G,{children:be("admin.backup.dialogs.clear_oauth_title","Clear OAuth Credentials")}),r.jsx(L,{children:be("admin.backup.dialogs.clear_oauth_description","This will remove all stored Google OAuth credentials and disable Google Drive integration. You will need to reconfigure credentials to use Google Drive backups.")})]}),r.jsxs(z,{children:[r.jsx(Y,{children:be("common.cancel","Cancel")}),r.jsx(V,{onClick:()=>Ss.mutate(),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:be("admin.backup.oauth.clear_credentials","Clear Credentials")})]})]})]})]})]})]})}),!(null==os?void 0:os.configured)&&r.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx(ee,{className:"h-5 w-5 text-blue-600 mt-0.5 flex-shrink-0"}),r.jsxs("div",{className:"flex-1",children:[r.jsx("h4",{className:"font-medium text-blue-800 mb-2",children:be("admin.backup.oauth.setup_required","OAuth Setup Required")}),r.jsx("p",{className:"text-sm text-blue-700 mb-3",children:be("admin.backup.oauth.setup_description","To enable Google Drive backups, you need to configure OAuth 2.0 credentials from Google Cloud Console.")}),r.jsxs("div",{className:"text-sm text-blue-700 mb-3",children:[r.jsxs("p",{className:"font-medium mb-1",children:[be("admin.backup.oauth.setup_instructions","Setup Instructions"),":"]}),r.jsxs("ol",{className:"list-decimal list-inside space-y-1 ml-2",children:[r.jsxs("li",{children:[be("admin.backup.oauth.step_1","Go to")," ",r.jsx("a",{href:"https://console.cloud.google.com",target:"_blank",rel:"noopener noreferrer",className:"underline",children:be("admin.backup.oauth.google_cloud_console","Google Cloud Console")})]}),r.jsx("li",{children:be("admin.backup.oauth.step_2","Create a new project or select existing one")}),r.jsx("li",{children:be("admin.backup.oauth.step_3","Enable the Google Drive API")}),r.jsx("li",{children:be("admin.backup.oauth.step_4","Create OAuth 2.0 credentials (Web application)")}),r.jsx("li",{children:be("admin.backup.oauth.step_5","Add your redirect URI to authorized redirect URIs")}),r.jsx("li",{children:be("admin.backup.oauth.step_6","Copy the Client ID and Client Secret")})]})]}),r.jsxs(_,{size:"sm",onClick:()=>$e(!0),children:[r.jsx(Q,{className:"h-4 w-4 mr-2"}),be("admin.backup.oauth.configure_credentials","Configure OAuth Credentials")]})]})]})}),We&&r.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("h4",{className:"font-medium",children:be("admin.backup.oauth.credentials_form_title","OAuth 2.0 Credentials")}),r.jsx(_,{size:"sm",variant:"ghost",onClick:Ts,children:r.jsx($,{className:"h-4 w-4"})})]}),r.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsx(b,{htmlFor:"client-id",children:be("admin.backup.oauth.client_id_label","Google Client ID")}),r.jsx(v,{id:"client-id",value:Ve.client_id,onChange:e=>Qe({...Ve,client_id:e.target.value}),placeholder:be("admin.backup.oauth.client_id_placeholder","Enter your Google OAuth Client ID")}),r.jsx("p",{className:"text-xs text-muted-foreground",children:be("admin.backup.oauth.client_id_help","The Client ID from your Google Cloud Console OAuth credentials")})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(b,{htmlFor:"client-secret",children:be("admin.backup.oauth.client_secret_label","Google Client Secret")}),r.jsx(v,{id:"client-secret",type:"password",value:Ve.client_secret,onChange:e=>Qe({...Ve,client_secret:e.target.value}),placeholder:be("admin.backup.oauth.client_secret_placeholder","Enter your Google OAuth Client Secret")}),r.jsx("p",{className:"text-xs text-muted-foreground",children:be("admin.backup.oauth.client_secret_help","The Client Secret from your Google Cloud Console OAuth credentials")})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(b,{htmlFor:"redirect-uri",children:be("admin.backup.oauth.redirect_uri_label","Redirect URI")}),r.jsx(v,{id:"redirect-uri",value:Ve.redirect_uri,onChange:e=>Qe({...Ve,redirect_uri:e.target.value}),placeholder:"http://localhost:3000/admin/settings?tab=backup"}),r.jsx("p",{className:"text-xs text-muted-foreground",children:be("admin.backup.oauth.redirect_uri_help","This URI must be added to your Google OAuth authorized redirect URIs")})]})]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsxs(_,{onClick:()=>{Ve.client_id.trim()&&Ve.client_secret.trim()?Cs.mutate(Ve):je({title:be("common.validation_error","Validation Error"),description:be("admin.backup.validation.oauth_credentials_required","Client ID and Client Secret are required"),variant:"destructive"})},disabled:Cs.isPending||!Ve.client_id.trim()||!Ve.client_secret.trim(),children:[Cs.isPending&&r.jsx(c,{className:"mr-2 h-4 w-4 animate-spin"}),be("admin.backup.oauth.save_credentials","Save Credentials")]}),r.jsx(_,{variant:"outline",onClick:Ts,children:be("common.cancel","Cancel")})]})]})})]}),r.jsx(X,{}),r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium",children:be("admin.backup.google_drive.enable_title","Enable Google Drive Backups")}),r.jsx("p",{className:"text-sm text-muted-foreground",children:be("admin.backup.google_drive.enable_description","Store backups in Google Drive for cloud redundancy")})]}),r.jsx(Z,{checked:ze.google_drive.enabled,onCheckedChange:e=>Ye({...ze,google_drive:{...ze.google_drive,enabled:e}}),disabled:!(null==os?void 0:os.configured)})]}),ze.google_drive.enabled&&(null==os?void 0:os.configured)&&r.jsxs("div",{className:"space-y-4",children:[r.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx(Fe,{className:"h-5 w-5 text-blue-600 mt-0.5 flex-shrink-0"}),r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-blue-800 mb-2",children:be("admin.backup.google_drive.connection_title","Google Drive Connection")}),r.jsx("p",{className:"text-sm text-blue-700 mb-3",children:be("admin.backup.google_drive.connection_description","Authorize PowerChat to access your Google Drive for backup storage.")}),r.jsxs("div",{className:"flex gap-2",children:[r.jsxs(_,{size:"sm",variant:"outline",onClick:()=>window.open("/api/admin/backup/google-drive/auth-url","_blank"),children:[r.jsx(se,{className:"h-4 w-4 mr-2"}),be("admin.backup.google_drive.connect_drive","Connect Google Drive")]}),r.jsxs(_,{size:"sm",variant:"outline",onClick:()=>_s.mutate(),disabled:_s.isPending,children:[_s.isPending?r.jsx(c,{className:"h-4 w-4 mr-2 animate-spin"}):r.jsx(A,{className:"h-4 w-4 mr-2"}),be("admin.backup.google_drive.test_connection","Test Connection")]})]})]})]})}),ze.google_drive.credentials&&r.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx(H,{className:"h-5 w-5 text-green-600"}),r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-green-800",children:be("admin.backup.google_drive.connected_title","Google Drive Connected")}),r.jsx("p",{className:"text-sm text-green-700",children:be("admin.backup.google_drive.connected_description","Your Google Drive account is connected and ready for backups.")})]})]})})]}),ze.google_drive.enabled&&!(null==os?void 0:os.configured)&&r.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx(ae,{className:"h-5 w-5 text-yellow-600 mt-0.5 flex-shrink-0"}),r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-yellow-800",children:be("admin.backup.google_drive.oauth_required_title","OAuth Configuration Required")}),r.jsx("p",{className:"text-sm text-yellow-700",children:be("admin.backup.google_drive.oauth_required_description","Please configure OAuth 2.0 credentials above before enabling Google Drive backups.")})]})]})})]})]}),r.jsxs("div",{className:"flex justify-end gap-4",children:[r.jsx(_,{variant:"outline",onClick:()=>{is&&Ye({retention_days:is.retention_days||30,default_storage_locations:is.storage_locations||["local"],google_drive:is.google_drive||{enabled:!1,folder_id:null,credentials:null},encryption:is.encryption||{enabled:!1,key:null},notifications:{enabled:!1,email:"",on_success:!0,on_failure:!0},cleanup:{enabled:!0,time:"03:00"}})},children:be("admin.backup.actions.reset_defaults","Reset to Defaults")}),r.jsxs(_,{onClick:()=>{const e={...is,retention_days:ze.retention_days,storage_locations:ze.default_storage_locations,google_drive:ze.google_drive,encryption:ze.encryption};ws.mutate(e)},disabled:ws.isPending,children:[ws.isPending&&r.jsx(c,{className:"mr-2 h-4 w-4 animate-spin"}),be("admin.backup.actions.save_settings","Save Settings")]})]})]})]}),r.jsx(ne,{open:_e,onOpenChange:e=>{e||gs.isPending||(Ce(!1),js())},children:r.jsxs(ie,{className:"max-w-2xl",children:[r.jsxs(te,{children:[r.jsxs(le,{className:"flex items-center gap-2",children:[r.jsx(O,{className:"h-5 w-5 text-orange-600"}),be("admin.backup.restore.title","Database Restoration")]}),r.jsxs(re,{children:["warning"===Te&&be("admin.backup.restore.warning_step","Review the backup details and understand the implications"),"confirmation"===Te&&be("admin.backup.restore.confirmation_step","Confirm your intention to restore the database"),"progress"===Te&&be("admin.backup.restore.progress_step","Database restoration in progress")]})]}),Se&&r.jsxs("div",{className:"space-y-6",children:[r.jsxs(h,{children:[r.jsx(x,{className:"pb-3",children:r.jsx(g,{className:"text-sm",children:be("admin.backup.restore.backup_info","Backup Information")})}),r.jsxs(p,{className:"space-y-2 text-sm",children:[r.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsxs("span",{className:"font-medium",children:[be("admin.backup.restore.filename","Filename"),":"]}),r.jsx("div",{className:"text-muted-foreground",children:Se.filename})]}),r.jsxs("div",{children:[r.jsxs("span",{className:"font-medium",children:[be("admin.backup.restore.created","Created"),":"]}),r.jsx("div",{className:"text-muted-foreground",children:Ds(Se.created_at)})]}),r.jsxs("div",{children:[r.jsxs("span",{className:"font-medium",children:[be("admin.backup.restore.size","Size"),":"]}),r.jsx("div",{className:"text-muted-foreground",children:Ms(Se.size)})]}),r.jsxs("div",{children:[r.jsxs("span",{className:"font-medium",children:[be("admin.backup.restore.type","Type"),":"]}),r.jsx("div",{className:"text-muted-foreground capitalize",children:Se.type})]})]}),r.jsxs("div",{children:[r.jsxs("span",{className:"font-medium",children:[be("admin.backup.restore.description","Description"),":"]}),r.jsx("div",{className:"text-muted-foreground",children:Se.description})]}),r.jsxs("div",{children:[r.jsxs("span",{className:"font-medium",children:[be("admin.backup.restore.storage","Storage"),":"]}),r.jsxs("div",{className:"flex gap-1 mt-1",children:[Se.storage_locations.includes("local")&&r.jsxs(D,{variant:"outline",className:"text-xs",children:[r.jsx(Me,{className:"h-3 w-3 mr-1"}),be("admin.backup.storage.local","Local")]}),Se.storage_locations.includes("google_drive")&&r.jsxs(D,{variant:"outline",className:"text-xs",children:[r.jsx(Fe,{className:"h-3 w-3 mr-1"}),be("admin.backup.storage.google_drive","Google Drive")]})]})]})]})]}),"warning"===Te&&r.jsxs("div",{className:"space-y-4",children:[r.jsx("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx(ae,{className:"h-5 w-5 text-orange-600 mt-0.5 flex-shrink-0"}),r.jsxs("div",{className:"space-y-2",children:[r.jsx("h4",{className:"font-medium text-orange-800",children:be("admin.backup.restore.warning_title","Critical Warning")}),r.jsxs("div",{className:"text-sm text-orange-700 space-y-1",children:[r.jsxs("p",{children:["• ",r.jsx("strong",{children:be("admin.backup.restore.warning_replace","This action will completely replace your current database")})]}),r.jsxs("p",{children:["• ",be("admin.backup.restore.warning_data_lost","All current data will be permanently lost")]}),r.jsxs("p",{children:["• ",be("admin.backup.restore.warning_disconnect","All users will be disconnected during the restoration")]}),r.jsxs("p",{children:["• ",be("admin.backup.restore.warning_undone","The restoration process cannot be undone")]}),r.jsxs("p",{children:["• ",be("admin.backup.restore.warning_backup","Make sure you have a recent backup of the current state if needed")]})]})]})]})}),r.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx(ee,{className:"h-5 w-5 text-blue-600 mt-0.5 flex-shrink-0"}),r.jsxs("div",{className:"space-y-2",children:[r.jsx("h4",{className:"font-medium text-blue-800",children:be("admin.backup.restore.process_title","Restoration Process")}),r.jsxs("div",{className:"text-sm text-blue-700 space-y-1",children:[r.jsxs("p",{children:["1. ",be("admin.backup.restore.process_download","Backup file will be downloaded if stored in cloud")]}),r.jsxs("p",{children:["2. ",be("admin.backup.restore.process_verify","Backup integrity will be verified")]}),r.jsxs("p",{children:["3. ",be("admin.backup.restore.process_clean","Current database will be cleaned")]}),r.jsxs("p",{children:["4. ",be("admin.backup.restore.process_restore","Backup data will be restored")]}),r.jsxs("p",{children:["5. ",be("admin.backup.restore.process_ready","System will be ready for use")]})]})]})]})})]}),"confirmation"===Te&&r.jsxs("div",{className:"space-y-4",children:[r.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx(ae,{className:"h-5 w-5 text-red-600 mt-0.5 flex-shrink-0"}),r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-red-800 mb-2",children:be("admin.backup.restore.confirmation_title","Final Confirmation Required")}),r.jsx("p",{className:"text-sm text-red-700 mb-3",children:be("admin.backup.restore.confirmation_text","To proceed with the database restoration, please type the backup filename exactly as shown below:")}),r.jsx("div",{className:"bg-white border rounded px-3 py-2 font-mono text-sm",children:vs()})]})]})}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(b,{htmlFor:"confirmation-input",children:be("admin.backup.restore.confirmation_label","Confirmation Text")}),r.jsx(v,{id:"confirmation-input",value:qe,onChange:e=>Ae(e.target.value),placeholder:be("admin.backup.restore.confirmation_placeholder",'Type "{filename}" to confirm',{filename:vs()}),className:"font-mono"}),r.jsx("p",{className:"text-xs text-muted-foreground",children:be("admin.backup.restore.confirmation_help","This confirmation ensures you understand the consequences of this action.")})]})]}),"progress"===Te&&r.jsxs("div",{className:"space-y-4",children:[r.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx(c,{className:"h-5 w-5 text-blue-600 animate-spin flex-shrink-0"}),r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-blue-800",children:be("admin.backup.restore.progress_title","Restoration in Progress")}),r.jsx("p",{className:"text-sm text-blue-700",children:(null==Oe?void 0:Oe.message)||be("admin.backup.restore.progress_processing","Processing...")})]})]})}),"completed"===(null==Oe?void 0:Oe.status)&&r.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx(H,{className:"h-5 w-5 text-green-600 flex-shrink-0"}),r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-green-800",children:be("admin.backup.restore.completed_title","Restoration Completed")}),r.jsx("p",{className:"text-sm text-green-700",children:be("admin.backup.restore.completed_message","Database has been successfully restored. The dialog will close automatically.")})]})]})}),"failed"===(null==Oe?void 0:Oe.status)&&r.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx($,{className:"h-5 w-5 text-red-600 flex-shrink-0"}),r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-red-800",children:be("admin.backup.restore.failed_title","Restoration Failed")}),r.jsx("p",{className:"text-sm text-red-700",children:null==Oe?void 0:Oe.message})]})]})})]})]}),r.jsxs(ce,{children:["warning"===Te&&r.jsxs(r.Fragment,{children:[r.jsx(_,{variant:"outline",onClick:()=>{Ce(!1),js()},children:be("admin.backup.restore.cancel","Cancel")}),r.jsx(_,{onClick:()=>De("confirmation"),className:"bg-orange-600 hover:bg-orange-700",children:be("admin.backup.restore.understand_continue","I Understand, Continue")})]}),"confirmation"===Te&&r.jsxs(r.Fragment,{children:[r.jsx(_,{variant:"outline",onClick:()=>De("warning"),children:be("admin.backup.restore.back","Back")}),r.jsx(_,{onClick:()=>{Se&&(De("progress"),gs.mutate({backupId:Se.id,confirmationText:qe}))},disabled:qe!==vs(),className:"bg-red-600 hover:bg-red-700",children:be("admin.backup.restore.restore_database","Restore Database")})]}),"progress"===Te&&r.jsx(_,{variant:"outline",onClick:()=>{Ce(!1),js()},disabled:gs.isPending&&"failed"!==(null==Oe?void 0:Oe.status),children:"completed"===(null==Oe?void 0:Oe.status)||"failed"===(null==Oe?void 0:Oe.status)?be("admin.backup.restore.close","Close"):be("common.cancel","Cancel")})]})]})}),r.jsx(ne,{open:Ie,onOpenChange:e=>{e||(Ke(!1),Ue(null),Fs())},children:r.jsxs(ie,{className:"max-w-lg",children:[r.jsxs(te,{children:[r.jsx(le,{children:Re?be("admin.backup.schedule_dialog.edit_title","Edit Backup Schedule"):be("admin.backup.schedule_dialog.create_title","Create Backup Schedule")}),r.jsx(re,{children:be("admin.backup.schedule_dialog.description","Configure automated backup schedule settings")})]}),r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsx(b,{htmlFor:"schedule-name",children:be("admin.backup.schedule_dialog.name_label","Schedule Name")}),r.jsx(v,{id:"schedule-name",value:Ge.name,onChange:e=>Le({...Ge,name:e.target.value}),placeholder:be("admin.backup.schedule_dialog.name_placeholder","e.g., Daily Backup, Weekly Archive")}),r.jsx("p",{className:"text-xs text-muted-foreground",children:be("admin.backup.schedule_dialog.name_help","A descriptive name for this backup schedule")})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(b,{children:be("admin.backup.schedule_dialog.frequency_label","Backup Frequency")}),r.jsxs(y,{value:Ge.frequency,onValueChange:e=>Le({...Ge,frequency:e}),children:[r.jsx(f,{children:r.jsx(k,{})}),r.jsxs(N,{children:[r.jsx(w,{value:"daily",children:be("admin.backup.schedule_dialog.frequency_daily","Daily")}),r.jsx(w,{value:"weekly",children:be("admin.backup.schedule_dialog.frequency_weekly","Weekly")}),r.jsx(w,{value:"monthly",children:be("admin.backup.schedule_dialog.frequency_monthly","Monthly")})]})]})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(b,{htmlFor:"schedule-time",children:be("admin.backup.schedule_dialog.time_label","Backup Time")}),r.jsx(v,{id:"schedule-time",type:"time",value:Ge.time,onChange:e=>Le({...Ge,time:e.target.value})}),r.jsx("p",{className:"text-xs text-muted-foreground",children:be("admin.backup.schedule_dialog.time_help","Time when the backup will be executed (24-hour format)")})]}),"weekly"===Ge.frequency&&r.jsxs("div",{className:"space-y-2",children:[r.jsx(b,{children:be("admin.backup.schedule_dialog.day_of_week","Day of Week")}),r.jsxs(y,{value:Ge.day_of_week.toString(),onValueChange:e=>Le({...Ge,day_of_week:parseInt(e)}),children:[r.jsx(f,{children:r.jsx(k,{})}),r.jsxs(N,{children:[r.jsx(w,{value:"0",children:be("admin.backup.days.sunday","Sunday")}),r.jsx(w,{value:"1",children:be("admin.backup.days.monday","Monday")}),r.jsx(w,{value:"2",children:be("admin.backup.days.tuesday","Tuesday")}),r.jsx(w,{value:"3",children:be("admin.backup.days.wednesday","Wednesday")}),r.jsx(w,{value:"4",children:be("admin.backup.days.thursday","Thursday")}),r.jsx(w,{value:"5",children:be("admin.backup.days.friday","Friday")}),r.jsx(w,{value:"6",children:be("admin.backup.days.saturday","Saturday")})]})]})]}),"monthly"===Ge.frequency&&r.jsxs("div",{className:"space-y-2",children:[r.jsx(b,{htmlFor:"day-of-month",children:be("admin.backup.schedule_dialog.day_of_month","Day of Month")}),r.jsx(v,{id:"day-of-month",type:"number",min:"1",max:"31",value:Ge.day_of_month,onChange:e=>Le({...Ge,day_of_month:parseInt(e.target.value)||1})}),r.jsx("p",{className:"text-xs text-muted-foreground",children:be("admin.backup.schedule_dialog.day_of_month_help","Day of the month when backup will be executed (1-31)")})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(b,{children:be("admin.backup.schedule_dialog.storage_label","Storage Locations")}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx("input",{type:"checkbox",id:"schedule-local",checked:Ge.storage_locations.includes("local"),onChange:e=>{const s=e.target.checked?[...Ge.storage_locations,"local"]:Ge.storage_locations.filter((e=>"local"!==e));Le({...Ge,storage_locations:s})}}),r.jsx(b,{htmlFor:"schedule-local",className:"text-sm",children:be("admin.backup.storage.local","Local Storage")})]}),r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx("input",{type:"checkbox",id:"schedule-drive",checked:Ge.storage_locations.includes("google_drive"),onChange:e=>{const s=e.target.checked?[...Ge.storage_locations,"google_drive"]:Ge.storage_locations.filter((e=>"google_drive"!==e));Le({...Ge,storage_locations:s})},disabled:!(null==(he=null==is?void 0:is.google_drive)?void 0:he.enabled)}),r.jsxs(b,{htmlFor:"schedule-drive",className:"text-sm",children:[be("admin.backup.storage.google_drive","Google Drive")," ",!(null==(pe=null==is?void 0:is.google_drive)?void 0:pe.enabled)&&be("admin.backup.storage.not_connected","(Not Connected)")]})]})]}),r.jsx("p",{className:"text-xs text-muted-foreground",children:be("admin.backup.schedule_dialog.storage_help","Where to store the backup files")})]}),r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium",children:be("admin.backup.schedule_dialog.enable_title","Enable Schedule")}),r.jsx("p",{className:"text-sm text-muted-foreground",children:be("admin.backup.schedule_dialog.enable_help","Start this schedule immediately after creation")})]}),r.jsx(Z,{checked:Ge.enabled,onCheckedChange:e=>Le({...Ge,enabled:e})})]})]}),r.jsxs(ce,{children:[r.jsx(_,{variant:"outline",onClick:()=>{Ke(!1),Ue(null),Fs()},children:be("common.cancel","Cancel")}),r.jsxs(_,{onClick:()=>{if(!Ge.name.trim())return void je({title:be("common.validation_error","Validation Error"),description:be("admin.backup.validation.schedule_name_required","Schedule name is required"),variant:"destructive"});const e={...Ge,id:Ge.name.toLowerCase().replace(/\s+/g,"-")};fs.mutate(e)},disabled:fs.isPending||!Ge.name.trim()||0===Ge.storage_locations.length,children:[fs.isPending&&r.jsx(c,{className:"mr-2 h-4 w-4 animate-spin"}),Re?be("admin.backup.schedule_dialog.update_button","Update Schedule"):be("admin.backup.schedule_dialog.create_button","Create Schedule")]})]})]})}),r.jsx(ne,{open:He,onOpenChange:Je,children:r.jsxs(ie,{className:"sm:max-w-[500px]",children:[r.jsxs(te,{children:[r.jsx(le,{children:be("admin.backup.upload.title","Upload Database Backup")}),r.jsx(re,{children:be("admin.backup.upload.description","Upload an external database backup file to add it to your backup collection. Supported formats: .sql, .backup, .dump, .bak")})]}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsx(b,{children:be("admin.backup.upload.file_label","Backup File")}),r.jsx(de,{onFileSelected:e=>{Ze((s=>({...s,file:e})))},fileType:".sql,.backup,.dump,.bak",maxSize:500,className:"w-full",showProgress:as,progress:es}),r.jsx("p",{className:"text-xs text-muted-foreground",children:be("admin.backup.upload.file_help","Maximum file size: 500MB. Supported formats: .sql, .backup, .dump, .bak")})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(b,{htmlFor:"upload-description",children:be("admin.backup.upload.description_label","Description (Optional)")}),r.jsx(v,{id:"upload-description",placeholder:be("admin.backup.upload.description_placeholder","Enter a description for this backup..."),value:Xe.description,onChange:e=>Ze((s=>({...s,description:e.target.value}))),disabled:as})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(b,{children:be("admin.backup.upload.storage_label","Storage Locations")}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx("input",{type:"checkbox",id:"upload-local",checked:Xe.storage_locations.includes("local"),onChange:e=>{const s=e.target.checked?[...Xe.storage_locations,"local"]:Xe.storage_locations.filter((e=>"local"!==e));Ze((e=>({...e,storage_locations:s})))},disabled:as}),r.jsx(b,{htmlFor:"upload-local",className:"text-sm",children:be("admin.backup.storage.local","Local Storage")})]}),r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx("input",{type:"checkbox",id:"upload-drive",checked:Xe.storage_locations.includes("google_drive"),onChange:e=>{const s=e.target.checked?[...Xe.storage_locations,"google_drive"]:Xe.storage_locations.filter((e=>"google_drive"!==e));Ze((e=>({...e,storage_locations:s})))},disabled:!(null==(xe=null==is?void 0:is.google_drive)?void 0:xe.enabled)||as}),r.jsxs(b,{htmlFor:"upload-drive",className:"text-sm",children:[be("admin.backup.storage.google_drive","Google Drive")," ",!(null==(ge=null==is?void 0:is.google_drive)?void 0:ge.enabled)&&be("admin.backup.storage.not_connected","(Not Connected)")]})]})]}),r.jsx("p",{className:"text-xs text-muted-foreground",children:be("admin.backup.upload.storage_help","Choose where to store the uploaded backup")})]}),as&&r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex justify-between text-sm",children:[r.jsx("span",{children:be("admin.backup.upload.uploading","Uploading...")}),r.jsxs("span",{children:[es,"%"]})]}),r.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:r.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${es}%`}})})]})]}),r.jsxs(ce,{children:[r.jsx(_,{variant:"outline",onClick:()=>{Je(!1),ys()},disabled:as,children:be("common.cancel","Cancel")}),r.jsx(_,{onClick:()=>{Xe.file?xs.mutate({file:Xe.file,description:Xe.description||`Uploaded backup: ${Xe.file.name}`,storage_locations:Xe.storage_locations}):je({title:be("common.error","Error"),description:be("admin.backup.upload.no_file_selected","Please select a backup file to upload"),variant:"destructive"})},disabled:!Xe.file||0===Xe.storage_locations.length||as,children:as?r.jsxs(r.Fragment,{children:[r.jsx(c,{className:"mr-2 h-4 w-4 animate-spin"}),be("admin.backup.upload.uploading","Uploading...")]}):r.jsxs(r.Fragment,{children:[r.jsx(C,{className:"mr-2 h-4 w-4"}),be("admin.backup.upload.upload_button","Upload Backup")]})})]})]})})]})}function Ae(){const{t:e}=a(),{toast:l}=s(),[d,o]=n.useState(null),{data:m}=i({queryKey:["app-version"],queryFn:async()=>(await me("GET","/api/auto-update/version")).json()}),{data:u,refetch:j,isLoading:b}=i({queryKey:["update-check"],queryFn:async()=>(await me("GET","/api/auto-update/check")).json(),enabled:!1}),{data:v,refetch:y}=i({queryKey:["update-history"],queryFn:async()=>(await me("GET","/api/auto-update/history")).json()}),{data:f,refetch:k}=i({queryKey:["update-status"],queryFn:async()=>(await me("GET","/api/auto-update/status")).json(),refetchInterval:!!d&&2e3}),N=t({mutationFn:async()=>(await me("POST","/api/auto-update/start")).json(),onSuccess:s=>{l({title:e("settings.updates.update_started","Update Started"),description:e("settings.updates.update_started_desc","System update has been initiated")}),k()},onError:s=>{l({title:e("common.error","Error"),description:s.message||e("settings.updates.update_failed","Failed to start update"),variant:"destructive"})}});n.useEffect((()=>{if(null==f?void 0:f.isInProgress){const e=new EventSource("/api/auto-update/progress");return e.onmessage=e=>{try{const s=JSON.parse(e.data);o(s),k()}catch(s){console.error("Failed to parse progress data:",s)}},e.onerror=()=>{e.close(),o(null)},()=>{e.close()}}o(null)}),[null==f?void 0:f.isInProgress,k]);const w=e=>{switch(e){case"completed":return r.jsx(H,{className:"h-4 w-4 text-green-500"});case"failed":case"rolled_back":return r.jsx($,{className:"h-4 w-4 text-red-500"});case"pending":return r.jsx(je,{className:"h-4 w-4 text-yellow-500"});case"downloading":case"validating":case"applying":return r.jsx(c,{className:"h-4 w-4 text-blue-500 animate-spin"});default:return r.jsx(ge,{className:"h-4 w-4 text-gray-500"})}},C=(null==m?void 0:m.version)||"1.0.0",S=null==u?void 0:u.updateAvailable,P=null==u?void 0:u.updatePackage,E=(null==v?void 0:v.updates)||[],F=null==f?void 0:f.isInProgress;return r.jsxs("div",{className:"space-y-6",children:[r.jsxs(h,{children:[r.jsx(x,{children:r.jsxs(g,{className:"flex items-center space-x-2",children:[r.jsx(ue,{className:"h-5 w-5"}),r.jsx("span",{children:e("settings.updates.title","System Updates")})]})}),r.jsxs(p,{className:"space-y-4",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-muted-foreground",children:e("settings.updates.current_version","Current Version")}),r.jsxs("p",{className:"text-lg font-semibold",children:["PowerChat Plus v",C]})]}),r.jsx(_,{onClick:()=>{j()},disabled:b||F,variant:"outline",children:b?r.jsxs(r.Fragment,{children:[r.jsx(c,{className:"mr-2 h-4 w-4 animate-spin"}),e("settings.updates.checking","Checking...")]}):r.jsxs(r.Fragment,{children:[r.jsx(ue,{className:"mr-2 h-4 w-4"}),e("settings.updates.check_updates","Check for Updates")]})})]}),S&&P&&r.jsxs(he,{children:[r.jsx(q,{className:"h-4 w-4"}),r.jsx(pe,{children:r.jsxs("div",{className:"space-y-2",children:[r.jsx("p",{className:"font-medium",children:e("settings.updates.update_available","Update Available: v{{version}}",{version:P.version})}),r.jsx("p",{className:"text-sm",children:e("settings.updates.package_size","Package Size: {{size}}",{size:(e=>{if(0===e)return"0 Bytes";const s=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,s)).toFixed(2))+" "+["Bytes","KB","MB","GB"][s]})(P.packageSize)})}),P.releaseNotes&&r.jsxs("div",{className:"text-sm",children:[r.jsx("p",{className:"font-medium mb-1",children:e("settings.updates.release_notes","Release Notes:")}),r.jsx("p",{className:"whitespace-pre-wrap",children:P.releaseNotes})]}),r.jsx(_,{onClick:()=>{N.mutate()},disabled:N.isPending||F,className:"mt-2",children:N.isPending?r.jsxs(r.Fragment,{children:[r.jsx(c,{className:"mr-2 h-4 w-4 animate-spin"}),e("settings.updates.starting","Starting...")]}):r.jsxs(r.Fragment,{children:[r.jsx(q,{className:"mr-2 h-4 w-4"}),e("settings.updates.install_update","Install Update")]})})]})})]}),!S&&u&&r.jsxs(he,{children:[r.jsx(H,{className:"h-4 w-4"}),r.jsx(pe,{children:e("settings.updates.up_to_date","Your system is up to date")})]})]})]}),(F||d)&&r.jsxs(h,{children:[r.jsx(x,{children:r.jsxs(g,{className:"flex items-center space-x-2",children:[r.jsx(c,{className:"h-5 w-5 animate-spin"}),r.jsx("span",{children:e("settings.updates.update_progress","Update Progress")})]})}),r.jsxs(p,{className:"space-y-4",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex justify-between text-sm",children:[r.jsx("span",{children:(null==d?void 0:d.message)||e("settings.updates.preparing","Preparing update...")}),r.jsxs("span",{children:[(null==d?void 0:d.progress)||0,"%"]})]}),r.jsx(xe,{value:(null==d?void 0:d.progress)||0,className:"w-full"})]}),r.jsxs(he,{variant:"destructive",children:[r.jsx(ae,{className:"h-4 w-4"}),r.jsx(pe,{children:e("settings.updates.update_warning","Do not close this page or restart the system during the update process.")})]})]})]}),r.jsxs(h,{children:[r.jsx(x,{children:r.jsxs(g,{className:"flex items-center space-x-2",children:[r.jsx(J,{className:"h-5 w-5"}),r.jsx("span",{children:e("settings.updates.history","Update History")})]})}),r.jsx(p,{children:0===E.length?r.jsx("p",{className:"text-muted-foreground text-center py-4",children:e("settings.updates.no_history","No update history available")}):r.jsx("div",{className:"space-y-4",children:E.map((s=>{return r.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[r.jsxs("div",{className:"flex items-center space-x-3",children:[w(s.status),r.jsxs("div",{children:[r.jsxs("p",{className:"font-medium",children:["v",s.version]}),r.jsx("p",{className:"text-sm text-muted-foreground",children:new Date(s.createdAt).toLocaleDateString()})]})]}),r.jsxs("div",{className:"flex items-center space-x-2",children:[(a=s.status,r.jsx(D,{variant:{completed:"default",failed:"destructive",rolled_back:"destructive",pending:"secondary",downloading:"default",validating:"default",applying:"default"}[a]||"secondary",children:e(`settings.updates.status.${a}`,a)})),s.progressPercentage>0&&"completed"!==s.status&&r.jsxs("span",{className:"text-sm text-muted-foreground",children:[s.progressPercentage,"%"]})]})]},s.id);var a}))})})]})]})}function Oe(){const{t:e}=a(),{toast:l}=s(),{user:d}=be(),[o,m]=n.useState({enabled:!1,message:"System is under maintenance. Please try again later.",estimatedCompletion:"",bypassCode:""}),{data:u,refetch:j,isLoading:y,error:f}=i({queryKey:["maintenance-mode"],queryFn:async()=>{const e=await me("GET","/api/auto-update/maintenance");return await e.json()},refetchOnWindowFocus:!0,refetchInterval:3e4,retry:3,retryDelay:1e3});n.useEffect((()=>{u&&m((e=>({...e,enabled:u.enabled||!1,message:u.message||"System is under maintenance. Please try again later.",estimatedCompletion:u.estimatedCompletion?new Date(u.estimatedCompletion).toISOString().slice(0,16):"",bypassCode:u.bypassCode||e.bypassCode})))}),[u]);const k=t({mutationFn:async e=>(await me("POST","/api/auto-update/maintenance",e)).json(),onSuccess:(s,a)=>{l({title:e("settings.maintenance.updated","Maintenance Mode Updated"),description:a.enabled?e("settings.maintenance.enabled_success","Maintenance mode has been enabled"):e("settings.maintenance.disabled_success","Maintenance mode has been disabled")}),oe.invalidateQueries({queryKey:["maintenance-mode"]}),oe.invalidateQueries({queryKey:["maintenance-mode-status"]}),j()},onError:s=>{l({title:e("common.error","Error"),description:s.message||e("settings.maintenance.update_failed","Failed to update maintenance mode"),variant:"destructive"})}}),N=(e,s)=>{m((a=>({...a,[e]:s})))},w=(null==u?void 0:u.enabled)||!1;return y?r.jsx("div",{className:"space-y-6",children:r.jsx(h,{children:r.jsxs(p,{className:"flex items-center justify-center py-8",children:[r.jsx(c,{className:"h-6 w-6 animate-spin mr-2"}),r.jsx("span",{children:"Loading maintenance mode settings..."})]})})}):f?r.jsx("div",{className:"space-y-6",children:r.jsx(h,{children:r.jsx(p,{className:"py-8",children:r.jsxs(he,{variant:"destructive",children:[r.jsx(ae,{className:"h-4 w-4"}),r.jsx(pe,{children:r.jsxs("div",{className:"space-y-2",children:[r.jsx("p",{children:r.jsx("strong",{children:"Error loading maintenance mode settings:"})}),r.jsx("p",{className:"text-sm",children:f.message}),r.jsx(_,{onClick:()=>j(),variant:"outline",size:"sm",children:"Retry"})]})})]})})})}):r.jsxs("div",{className:"space-y-6",children:[r.jsxs(h,{children:[r.jsx(x,{children:r.jsxs(g,{className:"flex items-center space-x-2",children:[r.jsx(W,{className:"h-5 w-5"}),r.jsx("span",{children:e("settings.maintenance.title","Maintenance Mode")})]})}),r.jsx(p,{children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-muted-foreground",children:e("settings.maintenance.current_status","Current Status")}),r.jsx("p",{className:"text-lg font-semibold "+(w?"text-orange-600":"text-green-600"),children:w?e("settings.maintenance.enabled","Enabled"):e("settings.maintenance.disabled","Disabled")})]}),w&&r.jsxs("div",{className:"space-y-2",children:[r.jsxs(he,{className:"max-w-md",children:[r.jsx(ae,{className:"h-4 w-4"}),r.jsx(pe,{children:e("settings.maintenance.active_warning","Maintenance mode is currently active. Non-admin users cannot access the system.")})]}),(null==d?void 0:d.isSuperAdmin)&&r.jsxs(he,{className:"max-w-md border-blue-200 bg-blue-50",children:[r.jsx(ge,{className:"h-4 w-4 text-blue-600"}),r.jsx(pe,{className:"text-blue-800",children:r.jsxs("div",{className:"space-y-2",children:[r.jsxs("p",{children:[r.jsx("strong",{children:"Super Admin Access:"})," You can access the system because you are a super admin. Regular users will see the maintenance page."]}),r.jsx(_,{type:"button",variant:"outline",size:"sm",onClick:async()=>{try{const e=await me("GET","/api/auto-update/maintenance/test"),s=await e.json();503===e.status?l({title:"Maintenance Mode Test",description:"✅ Maintenance mode is working correctly! Non-admin users would see the maintenance page.",variant:"default"}):l({title:"Maintenance Mode Test",description:s.message||"Maintenance mode is not active.",variant:"default"})}catch(e){l({title:"Test Failed",description:e.message||"Failed to test maintenance mode",variant:"destructive"})}},className:"text-blue-700 border-blue-300 hover:bg-blue-100",children:"Test Maintenance Mode"})]})})]})]})]})})]}),r.jsxs(h,{children:[r.jsx(x,{children:r.jsxs(g,{className:"flex items-center space-x-2",children:[r.jsx(A,{className:"h-5 w-5"}),r.jsx("span",{children:e("settings.maintenance.configuration","Configuration")})]})}),r.jsx(p,{children:r.jsxs("form",{onSubmit:e=>{e.preventDefault();const s={enabled:o.enabled,message:o.message.trim()||"System is under maintenance. Please try again later."};o.estimatedCompletion&&(s.estimatedCompletion=new Date(o.estimatedCompletion).toISOString()),o.bypassCode.trim()&&(s.bypassCode=o.bypassCode.trim()),k.mutate(s)},className:"space-y-6",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"space-y-0.5",children:[r.jsx(b,{className:"text-base",children:e("settings.maintenance.enable_maintenance","Enable Maintenance Mode")}),r.jsx("p",{className:"text-sm text-muted-foreground",children:e("settings.maintenance.enable_description","When enabled, only super admin users can access the system")})]}),r.jsx(Z,{checked:o.enabled,onCheckedChange:e=>N("enabled",e)})]}),r.jsx(X,{}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(b,{htmlFor:"message",children:e("settings.maintenance.message","Maintenance Message")}),r.jsx(ve,{id:"message",value:o.message,onChange:e=>N("message",e.target.value),placeholder:e("settings.maintenance.message_placeholder","Enter the message to display to users during maintenance"),rows:3}),r.jsx("p",{className:"text-xs text-muted-foreground",children:e("settings.maintenance.message_help","This message will be displayed to users when they try to access the system during maintenance")})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs(b,{htmlFor:"estimatedCompletion",className:"flex items-center space-x-2",children:[r.jsx(je,{className:"h-4 w-4"}),r.jsx("span",{children:e("settings.maintenance.estimated_completion","Estimated Completion (Optional)")})]}),r.jsx(v,{id:"estimatedCompletion",type:"datetime-local",value:o.estimatedCompletion,onChange:e=>N("estimatedCompletion",e.target.value)}),r.jsx("p",{className:"text-xs text-muted-foreground",children:e("settings.maintenance.completion_help","Provide an estimated completion time to inform users when the system will be available again")})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs(b,{htmlFor:"bypassCode",className:"flex items-center space-x-2",children:[r.jsx(ye,{className:"h-4 w-4"}),r.jsx("span",{children:e("settings.maintenance.bypass_code","Admin Bypass Code (Optional)")})]}),r.jsxs("div",{className:"flex space-x-2",children:[r.jsx(v,{id:"bypassCode",type:"text",value:o.bypassCode,onChange:e=>N("bypassCode",e.target.value),placeholder:e("settings.maintenance.bypass_placeholder","Enter a secret code for admin access")}),r.jsx(_,{type:"button",variant:"outline",onClick:()=>{const e=Math.random().toString(36).substring(2,10).toUpperCase();N("bypassCode",e)},children:e("settings.maintenance.generate","Generate")})]}),r.jsx("p",{className:"text-xs text-muted-foreground",children:e("settings.maintenance.bypass_help","This code allows super admin users to bypass maintenance mode from the maintenance page")})]}),o.enabled&&r.jsxs(he,{variant:"destructive",children:[r.jsx(ae,{className:"h-4 w-4"}),r.jsx(pe,{children:r.jsxs("div",{className:"space-y-2",children:[r.jsx("p",{className:"font-medium",children:e("settings.maintenance.warning_title","Warning: Enabling Maintenance Mode")}),r.jsxs("ul",{className:"text-sm space-y-1 ml-4 list-disc",children:[r.jsx("li",{children:e("settings.maintenance.warning_users","All non-admin users will be redirected to the maintenance page")}),r.jsx("li",{children:e("settings.maintenance.warning_api","API requests from non-admin users will return maintenance errors")}),r.jsx("li",{children:e("settings.maintenance.warning_sessions","Existing user sessions will be affected")}),r.jsx("li",{children:e("settings.maintenance.warning_bypass","Only super admin users and those with the bypass code can access the system")})]})]})})]}),r.jsxs(he,{children:[r.jsx(ge,{className:"h-4 w-4"}),r.jsx(pe,{children:r.jsxs("div",{className:"space-y-2",children:[r.jsx("p",{className:"font-medium",children:e("settings.maintenance.info_title","Maintenance Mode Information")}),r.jsxs("ul",{className:"text-sm space-y-1 ml-4 list-disc",children:[r.jsx("li",{children:e("settings.maintenance.info_admin","Super admin users are never affected by maintenance mode")}),r.jsx("li",{children:e("settings.maintenance.info_automatic","Maintenance mode is automatically enabled during system updates")}),r.jsx("li",{children:e("settings.maintenance.info_bypass","The bypass code can be shared with trusted users for emergency access")}),r.jsx("li",{children:e("settings.maintenance.info_disable","You can disable maintenance mode at any time from this page")})]})]})})]}),r.jsx("div",{className:"flex justify-end",children:r.jsx(_,{type:"submit",disabled:k.isPending,className:o.enabled?"bg-orange-600 hover:bg-orange-700":"",children:k.isPending?r.jsxs(r.Fragment,{children:[r.jsx(c,{className:"mr-2 h-4 w-4 animate-spin"}),e("settings.maintenance.updating","Updating...")]}):r.jsxs(r.Fragment,{children:[r.jsx(W,{className:"mr-2 h-4 w-4"}),o.enabled?e("settings.maintenance.enable_mode","Enable Maintenance Mode"):e("settings.maintenance.update_settings","Update Settings")]})})})]})})]})]})}function Be(){const{toast:e}=s(),{t:l}=a(),{refreshBranding:S}=fe(),[P]=ke(),[E,F]=n.useState(null),[T,M]=n.useState(null),[D,q]=n.useState(null),[A,O]=n.useState(null),B=new URLSearchParams(P.split("?")[1]||"").get("tab")||"branding",[I,K]=n.useState(B);n.useEffect((()=>{const e=new URLSearchParams(P.split("?")[1]||"").get("tab")||"branding";K(e)}),[P]);const[R,U]=n.useState({appName:"PowerChat",primaryColor:"#333235",secondaryColor:"#4F46E5"}),[G,L]=n.useState({publishableKey:"",secretKey:"",webhookSecret:"",testMode:!0,enabled:!1}),[z,Y]=n.useState({enabled:!0,requireApproval:!1,defaultPlan:""}),[V,Q]=n.useState({clientId:"",clientSecret:"",accessToken:"",testMode:!0,enabled:!1}),[$,H]=n.useState({clientId:"",clientSecret:"",testMode:!0,enabled:!1}),[J,ee]=n.useState({accountName:"",accountNumber:"",bankName:"",routingNumber:"",swiftCode:"",instructions:"",enabled:!1}),[se,ae]=n.useState({defaultCurrency:"USD",dateFormat:"MM/DD/YYYY",timeFormat:"12h"}),[ne,ie]=n.useState({enabled:!1,host:"",port:587,security:"starttls",username:"",password:"",fromName:"",fromEmail:"",testEmail:""}),{data:te,isLoading:le}=i({queryKey:["/api/admin/settings"],queryFn:async()=>{const e=await me("GET","/api/admin/settings");if(!e.ok)throw new Error("Failed to fetch settings");return e.json()}}),{data:re,isLoading:ce}=i({queryKey:["/api/admin/plans"],queryFn:async()=>{const e=await me("GET","/api/admin/plans");if(!e.ok)throw new Error("Failed to fetch plans");return e.json()}});n.useEffect((()=>{if(te){const e=te.find((e=>"branding"===e.key));e&&U(e.value);const s=te.find((e=>"branding_logo"===e.key));s&&M(s.value);const a=te.find((e=>"branding_favicon"===e.key));a&&O(a.value);const n=te.find((e=>"registration_settings"===e.key));n&&Y(n.value);const i=te.find((e=>"payment_stripe"===e.key));i&&L({...i.value,secretKey:i.value.secretKey?"••••••••":""});const t=te.find((e=>"payment_mercadopago"===e.key));t&&Q({...t.value,clientSecret:t.value.clientSecret?"••••••••":"",accessToken:t.value.accessToken?"••••••••":""});const l=te.find((e=>"payment_paypal"===e.key));l&&H({...l.value,clientSecret:l.value.clientSecret?"••••••••":""});const r=te.find((e=>"payment_bank_transfer"===e.key));r&&ee(r.value);const c=te.find((e=>"general_settings"===e.key));c&&ae(c.value);const d=te.find((e=>"smtp_config"===e.key));d&&ie({...d.value,password:d.value.password?"••••••••":""})}}),[te]),n.useEffect((()=>{if(re&&re.length>0&&!z.defaultPlan){const e=re.find((e=>e.isActive))||re[0];e&&Y((s=>({...s,defaultPlan:e.id.toString()})))}}),[re,z.defaultPlan]);const de=t({mutationFn:async()=>{if(!E)throw new Error("No logo file selected");const e=new FormData;e.append("logo",E);const s=await fetch("/api/admin/settings/branding/logo",{method:"POST",body:e,credentials:"include"});if(!s.ok){const e=await s.json();throw new Error(e.error||"Failed to upload logo")}return s.json()},onSuccess:async()=>{oe.invalidateQueries({queryKey:["/api/admin/settings"]}),await S(),e({title:"Logo uploaded",description:"The logo has been uploaded successfully."})},onError:s=>{e({title:"Error uploading logo",description:s.message,variant:"destructive"})}}),he=t({mutationFn:async()=>{if(!D)throw new Error("No favicon file selected");const e=new FormData;e.append("favicon",D);const s=await fetch("/api/admin/settings/branding/favicon",{method:"POST",body:e,credentials:"include"});if(!s.ok){const e=await s.json();throw new Error(e.error||"Failed to upload favicon")}return s.json()},onSuccess:async()=>{oe.invalidateQueries({queryKey:["/api/admin/settings"]}),await S(),e({title:"Favicon uploaded",description:"The favicon has been uploaded successfully."})},onError:s=>{e({title:"Error uploading favicon",description:s.message,variant:"destructive"})}}),pe=t({mutationFn:async()=>{if(!R.appName)throw new Error("Application name is required");console.log("Sending branding form data:",JSON.stringify(R));const e=await me("POST","/api/admin/settings/branding",R);if(!e.ok){const s=await e.json();throw console.error("Error response:",s),new Error(s.error||"Failed to save branding settings")}return e.json()},onSuccess:async()=>{oe.invalidateQueries({queryKey:["/api/admin/settings"]}),await S(),e({title:"Branding settings saved",description:"The branding settings have been saved successfully."})},onError:s=>{console.error("Error saving branding settings:",s),e({title:"Error saving branding settings",description:s.message,variant:"destructive"})}}),xe=t({mutationFn:async()=>{const e={...G,secretKey:"••••••••"===G.secretKey?void 0:G.secretKey},s=await me("POST","/api/admin/settings/payment/stripe",e);if(!s.ok){const e=await s.json();throw new Error(e.error||"Failed to save Stripe settings")}return s.json()},onSuccess:()=>{oe.invalidateQueries({queryKey:["/api/admin/settings"]}),e({title:"Stripe settings saved",description:"The Stripe settings have been saved successfully."})},onError:s=>{e({title:"Error saving Stripe settings",description:s.message,variant:"destructive"})}}),ge=t({mutationFn:async()=>{const e=await me("POST","/api/admin/settings/payment/stripe/test");if(!e.ok){const s=await e.json();throw new Error(s.error||"Failed to test Stripe connection")}return e.json()},onSuccess:s=>{e({title:"Stripe connection successful",description:`Connected to Stripe account: ${s.account.email}`})},onError:s=>{e({title:"Error connecting to Stripe",description:s.message,variant:"destructive"})}}),je=t({mutationFn:async()=>{const e={...V,clientSecret:"••••••••"===V.clientSecret?void 0:V.clientSecret,accessToken:"••••••••"===V.accessToken?void 0:V.accessToken},s=await me("POST","/api/admin/settings/payment/mercadopago",e);if(!s.ok){const e=await s.json();throw new Error(e.error||"Failed to save Mercado Pago settings")}return s.json()},onSuccess:()=>{oe.invalidateQueries({queryKey:["/api/admin/settings"]}),e({title:"Mercado Pago settings saved",description:"The Mercado Pago settings have been saved successfully."})},onError:s=>{e({title:"Error saving Mercado Pago settings",description:s.message,variant:"destructive"})}}),be=t({mutationFn:async()=>{const e=await me("POST","/api/admin/settings/payment/mercadopago/test");if(!e.ok){const s=await e.json();throw new Error(s.error||"Failed to test Mercado Pago connection")}return e.json()},onSuccess:s=>{e({title:"Mercado Pago connection successful",description:`Connected to Mercado Pago account: ${s.account.email||s.account.nickname}`})},onError:s=>{e({title:"Error connecting to Mercado Pago",description:s.message,variant:"destructive"})}}),ve=t({mutationFn:async()=>{const e={...$,clientSecret:"••••••••"===$.clientSecret?void 0:$.clientSecret},s=await me("POST","/api/admin/settings/payment/paypal",e);if(!s.ok){const e=await s.json();throw new Error(e.error||"Failed to save PayPal settings")}return s.json()},onSuccess:()=>{oe.invalidateQueries({queryKey:["/api/admin/settings"]}),e({title:"PayPal settings saved",description:"The PayPal settings have been saved successfully."})},onError:s=>{e({title:"Error saving PayPal settings",description:s.message,variant:"destructive"})}}),ye=t({mutationFn:async()=>{const e=await me("POST","/api/admin/settings/payment/paypal/test");if(!e.ok){const s=await e.json();throw new Error(s.error||"Failed to test PayPal connection")}return e.json()},onSuccess:s=>{e({title:"PayPal connection successful",description:`Connected to PayPal ${s.account.environment} environment`})},onError:s=>{e({title:"Error connecting to PayPal",description:s.message,variant:"destructive"})}}),Fe=t({mutationFn:async()=>{const e=await me("POST","/api/admin/settings/payment/bank-transfer",J);if(!e.ok){const s=await e.json();throw new Error(s.error||"Failed to save bank transfer settings")}return e.json()},onSuccess:()=>{oe.invalidateQueries({queryKey:["/api/admin/settings"]}),e({title:"Bank transfer settings saved",description:"The bank transfer settings have been saved successfully."})},onError:s=>{e({title:"Error saving bank transfer settings",description:s.message,variant:"destructive"})}}),Me=t({mutationFn:async()=>{const e=await me("POST","/api/admin/settings/general",se);if(!e.ok){const s=await e.json();throw new Error(s.error||"Failed to save general settings")}return e.json()},onSuccess:()=>{oe.invalidateQueries({queryKey:["/api/admin/settings"]}),e({title:"General settings saved",description:"The general settings have been saved successfully."})},onError:s=>{e({title:"Error saving general settings",description:s.message,variant:"destructive"})}}),Be=t({mutationFn:async()=>{const e={...ne,password:"••••••••"===ne.password?void 0:ne.password},s=await me("POST","/api/admin/settings/smtp",e);if(!s.ok){const e=await s.json();throw new Error(e.error||"Failed to save SMTP settings")}return s.json()},onSuccess:()=>{oe.invalidateQueries({queryKey:["/api/admin/settings"]}),e({title:"SMTP settings saved",description:"The SMTP settings have been saved successfully."})},onError:s=>{e({title:"Error saving SMTP settings",description:s.message,variant:"destructive"})}}),Ie=t({mutationFn:async()=>{if(!ne.testEmail)throw new Error("Test email address is required");const e=await me("POST","/api/admin/settings/smtp/test",{testEmail:ne.testEmail});if(!e.ok){const s=await e.json();throw new Error(s.error||"Failed to test SMTP connection")}return e.json()},onSuccess:s=>{e({title:"SMTP connection successful",description:s.message||"SMTP connection test passed"})},onError:s=>{e({title:"Error testing SMTP connection",description:s.message,variant:"destructive"})}}),Ke=t({mutationFn:async()=>{try{console.log("🚀 MUTATION STARTED - saveRegistrationMutation.mutationFn called");const e={enabled:Boolean(z.enabled),requireApproval:Boolean(z.requireApproval),defaultPlan:z.defaultPlan||(re&&re.length>0?re[0].id.toString():"1")};if(console.log("🔍 Mutation payload prepared:",JSON.stringify(e)),e.enabled&&!e.defaultPlan)throw console.log("❌ Mutation validation failed: Default plan required"),new Error("Default plan is required when registration is enabled");console.log("📡 Making API request to /api/admin/settings/registration..."),console.log("📡 Request payload:",JSON.stringify(e));const s=await me("POST","/api/admin/settings/registration",e);if(console.log("📡 API response received:",s.status,s.statusText),!s.ok){const e=await s.json();throw console.error("❌ API error response:",e),new Error(e.error||"Failed to save registration settings")}const a=await s.json();return console.log("✅ API success response:",a),a}catch(e){throw console.error("❌ Mutation error:",e),e}},onSuccess:()=>{oe.invalidateQueries({queryKey:["/api/admin/settings"]}),e({title:"Registration settings saved",description:"The registration settings have been saved successfully."})},onError:s=>{e({title:"Error saving registration settings",description:s.message,variant:"destructive"})}});return le?r.jsx(Ne,{children:r.jsx("div",{className:"flex items-center justify-center min-h-screen",children:r.jsx(c,{className:"h-8 w-8 animate-spin text-primary"})})}):r.jsx(Ne,{children:r.jsxs("div",{className:"p-3 sm:p-6",children:[r.jsx("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center mb-6 gap-4",children:r.jsxs("div",{children:[r.jsx("h1",{className:"text-2xl",children:l("admin.settings.title","Settings")}),r.jsx("p",{className:"text-muted-foreground text-sm sm:text-base mt-1",children:"Configure system settings, payment gateways, and application preferences"})]})}),r.jsxs(d,{value:I,onValueChange:K,className:"space-y-6",children:[r.jsx("div",{className:"overflow-x-auto mb-6",children:r.jsxs(o,{className:"grid w-full grid-cols-2 sm:grid-cols-3 lg:grid-cols-8 gap-1 min-w-max",children:[r.jsxs(m,{value:"branding",className:"text-xs sm:text-sm whitespace-nowrap",children:[r.jsx(De,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1 sm:mr-2"}),r.jsx("span",{className:"hidden sm:inline",children:l("admin.settings.branding","Branding")}),r.jsx("span",{className:"sm:hidden",children:"Brand"})]}),r.jsxs(m,{value:"payment",className:"text-xs sm:text-sm whitespace-nowrap",children:[r.jsx(we,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1 sm:mr-2"}),r.jsx("span",{className:"hidden sm:inline",children:l("admin.settings.payment_gateways","Payment Gateways")}),r.jsx("span",{className:"sm:hidden",children:"Payment"})]}),r.jsxs(m,{value:"email",className:"text-xs sm:text-sm whitespace-nowrap",children:[r.jsx(_e,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1 sm:mr-2"}),r.jsx("span",{className:"hidden sm:inline",children:l("admin.settings.email","Email Settings")}),r.jsx("span",{className:"sm:hidden",children:"Email"})]}),r.jsxs(m,{value:"general",className:"text-xs sm:text-sm whitespace-nowrap",children:[r.jsx(Ce,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1 sm:mr-2"}),r.jsx("span",{className:"hidden sm:inline",children:l("admin.settings.general","General")}),r.jsx("span",{className:"sm:hidden",children:"General"})]}),r.jsxs(m,{value:"registration",className:"text-xs sm:text-sm whitespace-nowrap",children:[r.jsx(Se,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1 sm:mr-2"}),r.jsx("span",{className:"hidden sm:inline",children:l("admin.settings.registration","Registration")}),r.jsx("span",{className:"sm:hidden",children:"Register"})]}),r.jsxs(m,{value:"backup",className:"text-xs sm:text-sm whitespace-nowrap",children:[r.jsx(Ee,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1 sm:mr-2"}),r.jsx("span",{className:"hidden sm:inline",children:l("admin.settings.backup","Database Backup")}),r.jsx("span",{className:"sm:hidden",children:"Backup"})]}),r.jsxs(m,{value:"updates",className:"text-xs sm:text-sm whitespace-nowrap",children:[r.jsx(ue,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1 sm:mr-2"}),r.jsx("span",{className:"hidden sm:inline",children:l("admin.settings.updates","System Updates")}),r.jsx("span",{className:"sm:hidden",children:"Updates"})]}),r.jsxs(m,{value:"maintenance",className:"text-xs sm:text-sm whitespace-nowrap",children:[r.jsx(W,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1 sm:mr-2"}),r.jsx("span",{className:"hidden sm:inline",children:l("admin.settings.maintenance","Maintenance Mode")}),r.jsx("span",{className:"sm:hidden",children:"Maintenance"})]})]})}),r.jsx(u,{value:"branding",children:r.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6",children:[r.jsxs(h,{children:[r.jsxs(x,{children:[r.jsx(g,{children:l("admin.settings.branding","Application Branding")}),r.jsx(j,{children:l("admin.settings.branding_description","Customize the appearance of your application")})]}),r.jsxs(p,{className:"space-y-4",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsx(b,{htmlFor:"appName",children:l("admin.settings.app_name","Application Name")}),r.jsx(v,{id:"appName",value:R.appName,onChange:e=>U({...R,appName:e.target.value}),placeholder:"PowerChat"})]}),r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsx(b,{htmlFor:"primaryColor",className:"text-sm",children:l("admin.settings.primary_color","Primary Color")}),r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx("div",{className:"w-6 h-6 rounded-full border cursor-pointer flex-shrink-0",style:{backgroundColor:R.primaryColor},onClick:()=>{const e=document.getElementById("primaryColor");e&&e.click()}}),r.jsx(v,{id:"primaryColor",type:"color",value:R.primaryColor,onChange:e=>U({...R,primaryColor:e.target.value}),className:"w-12 sm:w-16 h-8 sm:h-10 p-1 border rounded cursor-pointer flex-shrink-0"}),r.jsx(v,{type:"text",value:R.primaryColor,onChange:e=>U({...R,primaryColor:e.target.value}),placeholder:"#333235",className:"flex-1 min-w-0"})]})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(b,{htmlFor:"secondaryColor",className:"text-sm",children:l("admin.settings.secondary_color","Secondary Color")}),r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx("div",{className:"w-6 h-6 rounded-full border cursor-pointer flex-shrink-0",style:{backgroundColor:R.secondaryColor},onClick:()=>{const e=document.getElementById("secondaryColor");e&&e.click()}}),r.jsx(v,{id:"secondaryColor",type:"color",value:R.secondaryColor,onChange:e=>U({...R,secondaryColor:e.target.value}),className:"w-12 sm:w-16 h-8 sm:h-10 p-1 border rounded cursor-pointer flex-shrink-0"}),r.jsx(v,{type:"text",value:R.secondaryColor,onChange:e=>U({...R,secondaryColor:e.target.value}),placeholder:"#4F46E5",className:"flex-1 min-w-0"})]})]})]}),r.jsxs(_,{variant:"brand",onClick:()=>pe.mutate(),disabled:pe.isPending,className:"btn-brand-primary",children:[pe.isPending&&r.jsx(c,{className:"mr-2 h-4 w-4 animate-spin"}),l("admin.settings.save_branding","Save Branding Settings")]})]})]}),r.jsxs("div",{className:"space-y-6",children:[r.jsxs(h,{children:[r.jsxs(x,{children:[r.jsx(g,{children:"Logo"}),r.jsx(j,{children:"Upload your company logo (recommended size: 200x50px)"})]}),r.jsxs(p,{className:"space-y-4",children:[T&&r.jsx("div",{className:"border rounded-md p-4 flex items-center justify-center bg-gray-50",children:r.jsx("img",{src:T,alt:"Logo Preview",className:"max-h-16 max-w-full object-contain"})}),r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx(v,{id:"logo",type:"file",accept:"image/*",onChange:e=>{if(e.target.files&&e.target.files[0]){const s=e.target.files[0];F(s),M(URL.createObjectURL(s))}},className:"hidden"}),r.jsxs(b,{htmlFor:"logo",className:"cursor-pointer flex items-center justify-center border rounded-md px-4 py-2 hover:bg-gray-50",children:[r.jsx(C,{className:"h-4 w-4 mr-2"}),"Choose Logo"]}),E&&r.jsxs(_,{onClick:()=>de.mutate(),disabled:de.isPending,children:[de.isPending?r.jsx(c,{className:"mr-2 h-4 w-4 animate-spin"}):r.jsx(Pe,{className:"mr-2 h-4 w-4"}),"Upload"]})]})]})]}),r.jsxs(h,{children:[r.jsxs(x,{children:[r.jsx(g,{children:"Favicon"}),r.jsx(j,{children:"Upload your favicon (recommended size: 32x32px)"})]}),r.jsxs(p,{className:"space-y-4",children:[A&&r.jsx("div",{className:"border rounded-md p-4 flex items-center justify-center bg-gray-50",children:r.jsx("img",{src:A,alt:"Favicon Preview",className:"max-h-8 max-w-full object-contain"})}),r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx(v,{id:"favicon",type:"file",accept:"image/*",onChange:e=>{if(e.target.files&&e.target.files[0]){const s=e.target.files[0];q(s),O(URL.createObjectURL(s))}},className:"hidden"}),r.jsxs(b,{htmlFor:"favicon",className:"cursor-pointer flex items-center justify-center border rounded-md px-4 py-2 hover:bg-gray-50",children:[r.jsx(Te,{className:"h-4 w-4 mr-2"}),"Choose Favicon"]}),D&&r.jsxs(_,{onClick:()=>he.mutate(),disabled:he.isPending,children:[he.isPending?r.jsx(c,{className:"mr-2 h-4 w-4 animate-spin"}):r.jsx(Pe,{className:"mr-2 h-4 w-4"}),"Upload"]})]})]})]})]})]})}),r.jsx(u,{value:"payment",children:r.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6",children:[r.jsxs(h,{children:[r.jsxs(x,{children:[r.jsx(g,{children:"Stripe Integration"}),r.jsx(j,{children:"Configure Stripe payment gateway"})]}),r.jsxs(p,{className:"space-y-4",children:[r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx(Z,{id:"stripe-enabled",checked:G.enabled,onCheckedChange:e=>L({...G,enabled:e})}),r.jsx(b,{htmlFor:"stripe-enabled",children:"Enable Stripe Payments"})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(b,{htmlFor:"publishableKey",children:"Publishable Key"}),r.jsx(v,{id:"publishableKey",value:G.publishableKey,onChange:e=>L({...G,publishableKey:e.target.value}),placeholder:"pk_test_...",disabled:!G.enabled})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(b,{htmlFor:"secretKey",children:"Secret Key"}),r.jsx(v,{id:"secretKey",type:"password",value:G.secretKey,onChange:e=>L({...G,secretKey:e.target.value}),placeholder:"sk_test_...",disabled:!G.enabled})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(b,{htmlFor:"webhookSecret",children:"Webhook Secret"}),r.jsx(v,{id:"webhookSecret",value:G.webhookSecret,onChange:e=>L({...G,webhookSecret:e.target.value}),placeholder:"whsec_...",disabled:!G.enabled})]}),r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx(Z,{id:"stripe-test-mode",checked:G.testMode,onCheckedChange:e=>L({...G,testMode:e}),disabled:!G.enabled}),r.jsx(b,{htmlFor:"stripe-test-mode",children:"Test Mode"})]}),r.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:space-x-2",children:[r.jsxs(_,{variant:"brand",onClick:()=>xe.mutate(),disabled:xe.isPending||!G.enabled,className:"btn-brand-primary w-full sm:w-auto",children:[xe.isPending&&r.jsx(c,{className:"mr-2 h-4 w-4 animate-spin"}),r.jsx("span",{className:"hidden sm:inline",children:"Save Stripe Settings"}),r.jsx("span",{className:"sm:hidden",children:"Save Settings"})]}),r.jsxs(_,{variant:"brand",onClick:()=>ge.mutate(),disabled:ge.isPending||!G.enabled||!G.secretKey,className:"w-full sm:w-auto",children:[ge.isPending?r.jsx(c,{className:"mr-2 h-4 w-4 animate-spin"}):r.jsx(Pe,{className:"mr-2 h-4 w-4"}),"Test Connection"]})]})]})]}),r.jsxs(h,{children:[r.jsxs(x,{children:[r.jsx(g,{children:"Mercado Pago Integration"}),r.jsx(j,{children:"Configure Mercado Pago payment gateway"})]}),r.jsxs(p,{className:"space-y-4",children:[r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx(Z,{id:"mercadopago-enabled",checked:V.enabled,onCheckedChange:e=>Q({...V,enabled:e})}),r.jsx(b,{htmlFor:"mercadopago-enabled",children:"Enable Mercado Pago Payments"})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(b,{htmlFor:"mercadopago-clientId",children:"Client ID"}),r.jsx(v,{id:"mercadopago-clientId",value:V.clientId,onChange:e=>Q({...V,clientId:e.target.value}),placeholder:"2740017016616699",disabled:!V.enabled})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(b,{htmlFor:"mercadopago-clientSecret",children:"Client Secret"}),r.jsx(v,{id:"mercadopago-clientSecret",type:"password",value:V.clientSecret,onChange:e=>Q({...V,clientSecret:e.target.value}),placeholder:"9JUknDFhkXkuyEBuEnvWiXrpVFnYdtLc",disabled:!V.enabled})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(b,{htmlFor:"mercadopago-accessToken",children:"Access Token"}),r.jsx(v,{id:"mercadopago-accessToken",type:"password",value:V.accessToken,onChange:e=>Q({...V,accessToken:e.target.value}),placeholder:"APP_USR-2740017016616699-021517-c5d115a0e393d32ec81f16ec2dc15e7e-221745631",disabled:!V.enabled}),r.jsx("p",{className:"text-xs text-muted-foreground",children:"This is the Production Access Token from your Mercado Pago Developer Dashboard. Make sure to use the correct token for test or production mode."})]}),r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx(Z,{id:"mercadopago-test-mode",checked:V.testMode,onCheckedChange:e=>Q({...V,testMode:e}),disabled:!V.enabled}),r.jsx(b,{htmlFor:"mercadopago-test-mode",children:"Test Mode"})]}),r.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:space-x-2",children:[r.jsxs(_,{variant:"brand",onClick:()=>je.mutate(),disabled:je.isPending||!V.enabled,className:"btn-brand-primary w-full sm:w-auto",children:[je.isPending&&r.jsx(c,{className:"mr-2 h-4 w-4 animate-spin"}),r.jsx("span",{className:"hidden sm:inline",children:"Save Mercado Pago Settings"}),r.jsx("span",{className:"sm:hidden",children:"Save Settings"})]}),r.jsxs(_,{variant:"brand",onClick:()=>be.mutate(),disabled:be.isPending||!V.enabled||!V.accessToken,className:"w-full sm:w-auto",children:[be.isPending?r.jsx(c,{className:"mr-2 h-4 w-4 animate-spin"}):r.jsx(Pe,{className:"mr-2 h-4 w-4"}),"Test Connection"]})]})]})]}),r.jsxs(h,{children:[r.jsxs(x,{children:[r.jsx(g,{children:"PayPal Integration"}),r.jsx(j,{children:"Configure PayPal payment gateway"})]}),r.jsxs(p,{className:"space-y-4",children:[r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx(Z,{id:"paypal-enabled",checked:$.enabled,onCheckedChange:e=>H({...$,enabled:e})}),r.jsx(b,{htmlFor:"paypal-enabled",children:"Enable PayPal Payments"})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(b,{htmlFor:"clientId",children:"Client ID"}),r.jsx(v,{id:"clientId",value:$.clientId,onChange:e=>H({...$,clientId:e.target.value}),placeholder:"Your PayPal Client ID",disabled:!$.enabled})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(b,{htmlFor:"clientSecret",children:"Client Secret"}),r.jsx(v,{id:"clientSecret",type:"password",value:$.clientSecret,onChange:e=>H({...$,clientSecret:e.target.value}),placeholder:"Your PayPal Client Secret",disabled:!$.enabled})]}),r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx(Z,{id:"paypal-test-mode",checked:$.testMode,onCheckedChange:e=>H({...$,testMode:e}),disabled:!$.enabled}),r.jsx(b,{htmlFor:"paypal-test-mode",children:"Sandbox Mode"})]}),r.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:space-x-2",children:[r.jsxs(_,{variant:"brand",onClick:()=>ve.mutate(),disabled:ve.isPending||!$.enabled,className:"btn-brand-primary w-full sm:w-auto",children:[ve.isPending&&r.jsx(c,{className:"mr-2 h-4 w-4 animate-spin"}),r.jsx("span",{className:"hidden sm:inline",children:"Save PayPal Settings"}),r.jsx("span",{className:"sm:hidden",children:"Save Settings"})]}),r.jsxs(_,{variant:"brand",onClick:()=>ye.mutate(),disabled:ye.isPending||!$.enabled||!$.clientSecret,className:"w-full sm:w-auto",children:[ye.isPending?r.jsx(c,{className:"mr-2 h-4 w-4 animate-spin"}):r.jsx(Pe,{className:"mr-2 h-4 w-4"}),"Test Connection"]})]})]})]}),r.jsxs(h,{children:[r.jsxs(x,{children:[r.jsx(g,{children:"Bank Transfer"}),r.jsx(j,{children:"Configure offline payment via bank transfer"})]}),r.jsxs(p,{className:"space-y-4",children:[r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx(Z,{id:"bank-transfer-enabled",checked:J.enabled,onCheckedChange:e=>ee({...J,enabled:e})}),r.jsx(b,{htmlFor:"bank-transfer-enabled",children:"Enable Bank Transfer"})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(b,{htmlFor:"accountName",children:"Account Name"}),r.jsx(v,{id:"accountName",value:J.accountName,onChange:e=>ee({...J,accountName:e.target.value}),placeholder:"Company Name",disabled:!J.enabled})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(b,{htmlFor:"accountNumber",children:"Account Number"}),r.jsx(v,{id:"accountNumber",value:J.accountNumber,onChange:e=>ee({...J,accountNumber:e.target.value}),placeholder:"123456789",disabled:!J.enabled})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(b,{htmlFor:"bankName",children:"Bank Name"}),r.jsx(v,{id:"bankName",value:J.bankName,onChange:e=>ee({...J,bankName:e.target.value}),placeholder:"Bank of Example",disabled:!J.enabled})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsx(b,{htmlFor:"routingNumber",children:"Routing Number"}),r.jsx(v,{id:"routingNumber",value:J.routingNumber,onChange:e=>ee({...J,routingNumber:e.target.value}),placeholder:"Optional",disabled:!J.enabled})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(b,{htmlFor:"swiftCode",children:"SWIFT Code"}),r.jsx(v,{id:"swiftCode",value:J.swiftCode,onChange:e=>ee({...J,swiftCode:e.target.value}),placeholder:"Optional",disabled:!J.enabled})]})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(b,{htmlFor:"instructions",children:"Payment Instructions"}),r.jsx(v,{id:"instructions",value:J.instructions,onChange:e=>ee({...J,instructions:e.target.value}),placeholder:"Include payment reference in transfer details",disabled:!J.enabled})]}),r.jsxs(_,{variant:"brand",onClick:()=>Fe.mutate(),disabled:Fe.isPending||!J.enabled,className:"btn-brand-primary",children:[Fe.isPending&&r.jsx(c,{className:"mr-2 h-4 w-4 animate-spin"}),"Save Bank Transfer Settings"]})]})]})]})}),r.jsx(u,{value:"email",children:r.jsxs(h,{children:[r.jsxs(x,{children:[r.jsx(g,{children:"SMTP Email Configuration"}),r.jsx(j,{children:"Configure SMTP settings for sending system emails, notifications, and password resets"})]}),r.jsxs(p,{className:"space-y-6",children:[r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx(Z,{id:"smtp-enabled",checked:ne.enabled,onCheckedChange:e=>ie({...ne,enabled:e})}),r.jsx(b,{htmlFor:"smtp-enabled",children:"Enable SMTP Email"})]}),r.jsx("p",{className:"text-sm text-muted-foreground",children:"When enabled, the system will use SMTP to send emails for password resets, notifications, and other system communications."}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsx(b,{htmlFor:"smtp-host",children:"SMTP Host"}),r.jsx(v,{id:"smtp-host",value:ne.host,onChange:e=>ie({...ne,host:e.target.value}),placeholder:"smtp.example.com",disabled:!ne.enabled})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(b,{htmlFor:"smtp-username",children:"SMTP Username"}),r.jsx(v,{id:"smtp-username",value:ne.username,onChange:e=>ie({...ne,username:e.target.value}),placeholder:"username@example.com",disabled:!ne.enabled})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(b,{htmlFor:"smtp-port",children:"SMTP Port"}),r.jsx(v,{id:"smtp-port",type:"number",value:ne.port,onChange:e=>{const s=parseInt(e.target.value)||587;let a=ne.security;465===s?a="ssl":587===s?a="starttls":25===s&&(a="none"),ie({...ne,port:s,security:a})},placeholder:"587",disabled:!ne.enabled}),r.jsx("p",{className:"text-xs text-muted-foreground",children:"Common ports: 587 (STARTTLS), 465 (SSL), 25 (No encryption)"})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(b,{htmlFor:"smtp-password",children:"SMTP Password"}),r.jsx(v,{id:"smtp-password",type:"password",value:ne.password,onChange:e=>ie({...ne,password:e.target.value}),placeholder:"••••••••",disabled:!ne.enabled}),r.jsx("p",{className:"text-xs text-muted-foreground",children:"For Gmail, use an App Password instead of your regular password"})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(b,{htmlFor:"smtp-security",children:"Security"}),r.jsxs(y,{value:ne.security,onValueChange:e=>ie({...ne,security:e}),disabled:!ne.enabled,children:[r.jsx(f,{id:"smtp-security",children:r.jsx(k,{placeholder:"Select security"})}),r.jsxs(N,{children:[r.jsx(w,{value:"starttls",children:"STARTTLS (Port 587)"}),r.jsx(w,{value:"ssl",children:"SSL/TLS (Port 465)"}),r.jsx(w,{value:"none",children:"None (Port 25)"})]})]})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(b,{htmlFor:"smtp-from-email",children:"From Email Address"}),r.jsx(v,{id:"smtp-from-email",type:"email",value:ne.fromEmail,onChange:e=>ie({...ne,fromEmail:e.target.value}),placeholder:"noreply@example.com",disabled:!ne.enabled})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(b,{htmlFor:"smtp-from-name",children:"From Name"}),r.jsx(v,{id:"smtp-from-name",value:ne.fromName,onChange:e=>ie({...ne,fromName:e.target.value}),placeholder:"PowerChat Support",disabled:!ne.enabled})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(b,{htmlFor:"smtp-test-email",children:"Test Email Address"}),r.jsx(v,{id:"smtp-test-email",type:"email",value:ne.testEmail,onChange:e=>ie({...ne,testEmail:e.target.value}),placeholder:"test@example.com",disabled:!ne.enabled}),r.jsx("p",{className:"text-xs text-muted-foreground",children:"Email address to send test emails to"})]})]}),r.jsxs("div",{className:"flex space-x-2",children:[r.jsxs(_,{variant:"brand",onClick:()=>Be.mutate(),disabled:Be.isPending||!ne.enabled,className:"btn-brand-primary",children:[Be.isPending&&r.jsx(c,{className:"mr-2 h-4 w-4 animate-spin"}),"Save SMTP Settings"]}),r.jsxs(_,{variant:"brand",onClick:()=>Ie.mutate(),disabled:Ie.isPending||!ne.enabled||!ne.host||!ne.testEmail,children:[Ie.isPending?r.jsx(c,{className:"mr-2 h-4 w-4 animate-spin"}):r.jsx(Pe,{className:"mr-2 h-4 w-4"}),"Test Connection"]})]})]})]})}),r.jsx(u,{value:"general",children:r.jsxs(h,{children:[r.jsxs(x,{children:[r.jsx(g,{children:"General Settings"}),r.jsx(j,{children:"Configure general application settings"})]}),r.jsxs(p,{className:"space-y-4",children:[r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsx(b,{htmlFor:"defaultCurrency",children:"Default Currency"}),r.jsxs(y,{value:se.defaultCurrency,onValueChange:e=>ae({...se,defaultCurrency:e}),children:[r.jsx(f,{id:"defaultCurrency",children:r.jsx(k,{placeholder:"Select currency"})}),r.jsxs(N,{children:[r.jsx(w,{value:"ARS",children:"ARS - Argentine Peso"}),r.jsx(w,{value:"BRL",children:"BRL - Brazilian Real"}),r.jsx(w,{value:"MXN",children:"MXN - Mexican Peso"}),r.jsx(w,{value:"CLP",children:"CLP - Chilean Peso"}),r.jsx(w,{value:"COP",children:"COP - Colombian Peso"}),r.jsx(w,{value:"PEN",children:"PEN - Peruvian Sol"}),r.jsx(w,{value:"UYU",children:"UYU - Uruguayan Peso"}),r.jsx(w,{value:"PYG",children:"PYG - Paraguayan Guarani"}),r.jsx(w,{value:"BOB",children:"BOB - Bolivian Boliviano"}),r.jsx(w,{value:"VEF",children:"VEF - Venezuelan Bolívar"}),r.jsx(w,{value:"PKR",children:"PKR - Pakistani Rupee"}),r.jsx(w,{value:"INR",children:"INR - Indian Rupee"}),r.jsx(w,{value:"USD",children:"USD - US Dollar"}),r.jsx(w,{value:"EUR",children:"EUR - Euro"})]})]})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(b,{htmlFor:"dateFormat",children:"Date Format"}),r.jsxs(y,{value:se.dateFormat,onValueChange:e=>ae({...se,dateFormat:e}),children:[r.jsx(f,{id:"dateFormat",children:r.jsx(k,{placeholder:"Select date format"})}),r.jsxs(N,{children:[r.jsx(w,{value:"MM/DD/YYYY",children:"MM/DD/YYYY"}),r.jsx(w,{value:"DD/MM/YYYY",children:"DD/MM/YYYY"}),r.jsx(w,{value:"YYYY-MM-DD",children:"YYYY-MM-DD"})]})]})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(b,{htmlFor:"timeFormat",children:"Time Format"}),r.jsxs(y,{value:se.timeFormat,onValueChange:e=>ae({...se,timeFormat:e}),children:[r.jsx(f,{id:"timeFormat",children:r.jsx(k,{placeholder:"Select time format"})}),r.jsxs(N,{children:[r.jsx(w,{value:"12h",children:"12-hour (AM/PM)"}),r.jsx(w,{value:"24h",children:"24-hour"})]})]})]})]}),r.jsxs(_,{variant:"brand",onClick:()=>Me.mutate(),disabled:Me.isPending,className:"btn-brand-primary",children:[Me.isPending&&r.jsx(c,{className:"mr-2 h-4 w-4 animate-spin"}),"Save General Settings"]})]})]})}),r.jsx(u,{value:"registration",children:r.jsxs(h,{children:[r.jsxs(x,{children:[r.jsx(g,{children:"Company Registration Settings"}),r.jsx(j,{children:"Control how new companies can register for your platform"})]}),r.jsxs(p,{className:"space-y-6",children:[r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx(Z,{id:"registration-enabled",checked:z.enabled,onCheckedChange:e=>Y({...z,enabled:e})}),r.jsx(b,{htmlFor:"registration-enabled",className:"text-sm font-medium",children:"Enable Company Registration"})]}),r.jsx("p",{className:"text-sm text-muted-foreground",children:"When enabled, new companies can register for accounts. When disabled, the registration page will show a message that registration is currently unavailable."}),r.jsx(X,{}),r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx(Z,{id:"registration-approval",checked:z.requireApproval,onCheckedChange:e=>Y({...z,requireApproval:e}),disabled:!z.enabled}),r.jsx(b,{htmlFor:"registration-approval",className:"text-sm font-medium",children:"Require Admin Approval"})]}),r.jsx("p",{className:"text-sm text-muted-foreground",children:"When enabled, new company registrations will require super admin approval before they can access the platform."}),r.jsx(X,{}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(b,{htmlFor:"default-plan",children:"Default Plan for New Companies"}),r.jsxs(y,{value:z.defaultPlan,onValueChange:e=>Y({...z,defaultPlan:e}),disabled:!z.enabled||ce,children:[r.jsx(f,{children:r.jsx(k,{placeholder:"Select default plan"})}),r.jsx(N,{children:ce?r.jsx(w,{value:"loading",disabled:!0,children:r.jsxs("div",{className:"flex items-center",children:[r.jsx(c,{className:"h-4 w-4 animate-spin mr-2"}),"Loading plans..."]})}):re&&re.length>0?re.filter((e=>e.isActive)).map((e=>r.jsxs(w,{value:e.id.toString(),children:[e.name," ($",e.price,"/month) - ",e.maxUsers," users"]},e.id))):r.jsx(w,{value:"none",disabled:!0,children:"No plans available"})})]}),r.jsx("p",{className:"text-sm text-muted-foreground",children:"New companies will be automatically assigned to this plan upon registration."})]}),r.jsxs(_,{variant:"brand",onClick:()=>{try{console.log("🔥 BUTTON CLICKED - Starting registration settings save...");const s={enabled:Boolean(z.enabled),requireApproval:Boolean(z.requireApproval),defaultPlan:z.defaultPlan||(re&&re.length>0?re[0].id.toString():"1")};if(console.log("🔍 Current registration settings state:",z),console.log("🔍 Validated payload:",s),s.enabled&&!s.defaultPlan)return console.log("❌ Validation failed: Default plan required"),void e({title:"Validation Error",description:"Default plan is required when registration is enabled",variant:"destructive"});console.log("✅ Validation passed, calling mutation..."),Ke.mutate()}catch(s){console.error("❌ Error in button click handler:",s),e({title:"Error",description:"An unexpected error occurred",variant:"destructive"})}},disabled:Ke.isPending,className:"btn-brand-primary",children:[Ke.isPending&&r.jsx(c,{className:"mr-2 h-4 w-4 animate-spin"}),"Save Registration Settings"]})]})]})}),r.jsx(u,{value:"backup",children:r.jsx(qe,{})}),r.jsx(u,{value:"updates",children:r.jsx(Ae,{})}),r.jsx(u,{value:"maintenance",children:r.jsx(Oe,{})})]})]})})}export{Be as default};
