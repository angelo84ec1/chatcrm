import{u as e,f as s,r as a,h as r,ai as n,i,j as l,L as d,K as c,B as o,aj as t,C as m,a as x,b as h,l as j,c as u,ak as p,al as f,am as w,an as g,ao as v,I as y,ap as N,aq as b,ar as C,as as S,at as P,au as A,av as E,aw as F,ax as U,ay as k,s as I,d as V,az as q,aA as T,aB as B,aC as K,aD as L}from"./index-Du4k3PvU.js";const z=q({username:L().email("Username must be a valid email address"),email:L().email("Email must be a valid email address"),fullName:L().min(2,"Full name must be at least 2 characters"),password:L().min(6,"Password must be at least 6 characters"),confirmPassword:L(),role:K(["admin","agent","user"]),companyId:B().optional(),isSuperAdmin:T().default(!1)}).refine((e=>e.password===e.confirmPassword),{message:"Passwords don't match",path:["confirmPassword"]});function D(){const{user:q,isLoading:T}=e(),{toast:B}=s();a.useEffect((()=>{T||!q||q.isSuperAdmin||(window.location.href="/")}),[q,T]);const{data:K,isLoading:L}=r({queryKey:["/api/admin/companies"],queryFn:async()=>{const e=await V("GET","/api/admin/companies");if(!e.ok)throw new Error("Failed to fetch companies");return e.json()},enabled:!!(null==q?void 0:q.isSuperAdmin)}),D=(null==K?void 0:K.filter((e=>e.active)))||[],G=n({resolver:k(z),defaultValues:{username:"",email:"",fullName:"",password:"",confirmPassword:"",role:"agent",isSuperAdmin:!1}}),J=i({mutationFn:async e=>{const{confirmPassword:s,...a}=e,r=await V("POST","/api/admin/users",a);if(!r.ok){const e=await r.json();throw new Error(e.message||"Failed to create user")}return r.json()},onSuccess:()=>{I.invalidateQueries({queryKey:["/api/admin/users"]}),B({title:"User Created",description:"The user has been created successfully"}),setTimeout((()=>{window.location.href="/admin/users"}),1500)},onError:e=>{B({title:"Error",description:e.message||"Failed to create user",variant:"destructive"})}});return T?l.jsx("div",{className:"flex items-center justify-center min-h-screen",children:l.jsx(d,{className:"h-8 w-8 animate-spin text-primary"})}):(null==q?void 0:q.isSuperAdmin)?l.jsx(c,{children:l.jsxs("div",{className:"p-6",children:[l.jsxs("div",{className:"flex items-center mb-6",children:[l.jsxs(o,{variant:"ghost",size:"sm",onClick:()=>window.location.href="/admin/users",className:"mr-4",children:[l.jsx(t,{className:"h-4 w-4 mr-2"}),"Back to Users"]}),l.jsx("h1",{className:"text-2xl",children:"Create New User"})]}),l.jsxs(m,{className:"max-w-2xl mx-auto",children:[l.jsxs(x,{children:[l.jsx(h,{children:"User Information"}),l.jsx(j,{children:"Create a new user account in the system"})]}),l.jsx(u,{children:l.jsx(p,{...G,children:l.jsxs("form",{onSubmit:G.handleSubmit((e=>{J.mutate(e)})),className:"space-y-6",children:[l.jsx(f,{control:G.control,name:"fullName",render:({field:e})=>l.jsxs(w,{children:[l.jsx(g,{children:"Full Name"}),l.jsx(v,{children:l.jsx(y,{placeholder:"John Doe",...e})}),l.jsx(N,{})]})}),l.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[l.jsx(f,{control:G.control,name:"username",render:({field:e})=>l.jsxs(w,{children:[l.jsx(g,{children:"Username (Email)"}),l.jsx(v,{children:l.jsx(y,{placeholder:"user@example.com",...e})}),l.jsx(N,{})]})}),l.jsx(f,{control:G.control,name:"email",render:({field:e})=>l.jsxs(w,{children:[l.jsx(g,{children:"Email"}),l.jsx(v,{children:l.jsx(y,{placeholder:"user@example.com",...e})}),l.jsx(N,{})]})})]}),l.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[l.jsx(f,{control:G.control,name:"password",render:({field:e})=>l.jsxs(w,{children:[l.jsx(g,{children:"Password"}),l.jsx(v,{children:l.jsx(y,{type:"password",placeholder:"••••••••",...e})}),l.jsx(N,{})]})}),l.jsx(f,{control:G.control,name:"confirmPassword",render:({field:e})=>l.jsxs(w,{children:[l.jsx(g,{children:"Confirm Password"}),l.jsx(v,{children:l.jsx(y,{type:"password",placeholder:"••••••••",...e})}),l.jsx(N,{})]})})]}),l.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[l.jsx(f,{control:G.control,name:"role",render:({field:e})=>l.jsxs(w,{children:[l.jsx(g,{children:"Role"}),l.jsxs(b,{onValueChange:e.onChange,defaultValue:e.value,children:[l.jsx(v,{children:l.jsx(C,{children:l.jsx(S,{placeholder:"Select a role"})})}),l.jsxs(P,{children:[l.jsx(A,{value:"admin",children:"Admin"}),l.jsx(A,{value:"agent",children:"Agent"}),l.jsx(A,{value:"user",children:"User"})]})]}),l.jsx(N,{})]})}),l.jsxs(w,{children:[l.jsx(g,{children:"Company"}),l.jsxs(b,{onValueChange:e=>{G.setValue("companyId",parseInt(e))},disabled:L||G.watch("isSuperAdmin"),children:[l.jsx(v,{children:l.jsx(C,{children:l.jsx(S,{placeholder:"Select a company"})})}),l.jsx(P,{children:D.map((e=>l.jsx(A,{value:e.id.toString(),children:e.name},e.id)))})]}),l.jsx(N,{})]})]}),l.jsx(f,{control:G.control,name:"isSuperAdmin",render:({field:e})=>l.jsxs(w,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[l.jsxs("div",{className:"space-y-0.5",children:[l.jsx(g,{className:"text-base",children:"Super Admin"}),l.jsx(E,{children:"Super admins have access to all system features and settings"})]}),l.jsx(v,{children:l.jsx(F,{checked:e.value,onCheckedChange:s=>{e.onChange(s),s&&G.setValue("companyId",void 0)}})})]})}),l.jsx(o,{type:"submit",className:"w-full",disabled:J.isPending,children:J.isPending?l.jsxs(l.Fragment,{children:[l.jsx(d,{className:"mr-2 h-4 w-4 animate-spin"}),"Creating User..."]}):l.jsxs(l.Fragment,{children:[l.jsx(U,{className:"mr-2 h-4 w-4"}),"Create User"]})})]})})})]})]})}):null}export{D as default};
