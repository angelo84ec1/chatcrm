import{m as e,r as s,e as a,n as t,f as r,j as i,C as n,c as l,L as c,a as d,o,b as x,g as m,A as h,h as u,i as w,B as j,k as p,p as g,l as v,I as N,E as f,q as y,d as b}from"./index-C_9oFDzq.js";function P(){const[P,k]=e(),E=new URLSearchParams(window.location.search).get("token"),[S,C]=s.useState(""),[F,q]=s.useState(""),[L,R]=s.useState(!1),[T,B]=s.useState(!1),[I,Y]=s.useState(!1),{toast:z}=a(),{data:A,isLoading:D,error:G}=t({queryKey:["validate-reset-token",E],queryFn:async()=>{if(!E)throw new Error("No token provided");const e=await b("GET",`/api/auth/reset-password/${E}`);if(!e.ok){const s=await e.json().catch((()=>({})));throw new Error(s.message||"Failed to validate token")}return await e.json()},enabled:!!E,retry:!1}),K=r({mutationFn:async e=>{const s=await b("POST","/api/auth/reset-password",e);if(!s.ok){const e=await s.json().catch((()=>({})));throw new Error(e.message||"Failed to reset password")}return await s.json()},onSuccess:e=>{Y(!0),z({title:"Password reset successful",description:e.message})},onError:e=>{z({title:"Error",description:e.message,variant:"destructive"})}});return s.useEffect((()=>{E||k("/auth")}),[E,k]),E?D?i.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:i.jsx("div",{className:"max-w-md w-full space-y-8",children:i.jsx(n,{children:i.jsx(l,{className:"pt-6",children:i.jsxs("div",{className:"text-center",children:[i.jsx(c,{className:"mx-auto h-8 w-8 animate-spin text-blue-600"}),i.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Validating reset token..."})]})})})})}):G||!(null==A?void 0:A.valid)?i.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:i.jsx("div",{className:"max-w-md w-full space-y-8",children:i.jsxs(n,{children:[i.jsxs(d,{className:"text-center",children:[i.jsx("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100",children:i.jsx(o,{className:"h-6 w-6 text-red-600"})}),i.jsx(x,{className:"mt-4 text-red-600",children:"Invalid Reset Link"}),i.jsx(m,{children:"This password reset link is invalid or has expired."})]}),i.jsxs(l,{className:"space-y-4",children:[i.jsxs(h,{variant:"destructive",children:[i.jsx(o,{className:"h-4 w-4"}),i.jsx(u,{children:(null==G?void 0:G.message)||(null==A?void 0:A.message)||"The reset link is no longer valid."})]}),i.jsxs("div",{className:"text-center space-y-2",children:[i.jsx(w,{to:"/forgot-password",children:i.jsx(j,{className:"w-full",children:"Request new reset link"})}),i.jsxs(w,{to:"/auth",className:"inline-flex items-center text-sm text-blue-600 hover:text-blue-500",children:[i.jsx(p,{className:"mr-1 h-4 w-4"}),"Back to login"]})]})]})]})})}):I?i.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:i.jsx("div",{className:"max-w-md w-full space-y-8",children:i.jsxs(n,{children:[i.jsxs(d,{className:"text-center",children:[i.jsx("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100",children:i.jsx(g,{className:"h-6 w-6 text-green-600"})}),i.jsx(x,{className:"mt-4 text-green-600",children:"Password Reset Successful"}),i.jsx(m,{children:"Your password has been successfully reset. You can now log in with your new password."})]}),i.jsxs(l,{className:"space-y-4",children:[i.jsxs(h,{children:[i.jsx(g,{className:"h-4 w-4"}),i.jsx(u,{children:"Your password has been updated successfully. For security reasons, you'll need to log in again."})]}),i.jsx("div",{className:"text-center",children:i.jsx(w,{to:"/auth",children:i.jsx(j,{className:"w-full",children:"Continue to login"})})})]})]})})}):i.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:i.jsx("div",{className:"max-w-md w-full space-y-8",children:i.jsxs(n,{children:[i.jsxs(d,{className:"text-center",children:[i.jsx(x,{children:"Reset your password"}),i.jsx(m,{children:"Enter your new password below. Make sure it's at least 6 characters long."})]}),i.jsxs(l,{children:[i.jsxs("form",{onSubmit:e=>{e.preventDefault(),E?S.trim()&&F.trim()?S===F?S.length<6?z({title:"Error",description:"Password must be at least 6 characters long",variant:"destructive"}):K.mutate({token:E,newPassword:S,confirmPassword:F}):z({title:"Error",description:"Passwords do not match",variant:"destructive"}):z({title:"Error",description:"Please fill in all fields",variant:"destructive"}):z({title:"Error",description:"Invalid reset token",variant:"destructive"})},className:"space-y-4",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsx(v,{htmlFor:"newPassword",children:"New password"}),i.jsxs("div",{className:"relative",children:[i.jsx(N,{id:"newPassword",type:L?"text":"password",placeholder:"Enter your new password",value:S,onChange:e=>C(e.target.value),required:!0,disabled:K.isPending,minLength:6}),i.jsx(j,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>R(!L),disabled:K.isPending,children:L?i.jsx(f,{className:"h-4 w-4"}):i.jsx(y,{className:"h-4 w-4"})})]})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx(v,{htmlFor:"confirmPassword",children:"Confirm new password"}),i.jsxs("div",{className:"relative",children:[i.jsx(N,{id:"confirmPassword",type:T?"text":"password",placeholder:"Confirm your new password",value:F,onChange:e=>q(e.target.value),required:!0,disabled:K.isPending,minLength:6}),i.jsx(j,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>B(!T),disabled:K.isPending,children:T?i.jsx(f,{className:"h-4 w-4"}):i.jsx(y,{className:"h-4 w-4"})})]})]}),S&&F&&S!==F&&i.jsxs(h,{variant:"destructive",children:[i.jsx(o,{className:"h-4 w-4"}),i.jsx(u,{children:"Passwords do not match"})]}),i.jsxs(j,{type:"submit",className:"w-full",disabled:K.isPending||S!==F,children:[K.isPending&&i.jsx(c,{className:"mr-2 h-4 w-4 animate-spin"}),"Reset password"]})]}),i.jsx("div",{className:"mt-6 text-center",children:i.jsxs(w,{to:"/auth",className:"inline-flex items-center text-sm text-blue-600 hover:text-blue-500",children:[i.jsx(p,{className:"mr-1 h-4 w-4"}),"Back to login"]})})]})]})})}):null}export{P as default};
