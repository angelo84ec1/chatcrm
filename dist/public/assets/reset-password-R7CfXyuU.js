import{m as e,r as s,e as a,n as t,f as r,j as n,C as i,c as l,L as d,a as c,o,b as m,g as x,A as h,h as u,i as w,B as j,k as p,p as g,a4 as v,l as N,I as f,E as y,q as b,d as k}from"./index-C_9oFDzq.js";function P(){const[P,E]=e(),S=new URLSearchParams(window.location.search).get("token"),[C,F]=s.useState(""),[q,L]=s.useState(""),[R,A]=s.useState(!1),[T,B]=s.useState(!1),[I,Y]=s.useState(!1),{toast:z}=a(),{data:M,isLoading:D,error:G}=t({queryKey:["validate-admin-reset-token",S],queryFn:async()=>{if(!S)throw new Error("No token provided");const e=await k("GET",`/api/admin/auth/reset-password/${S}`);if(!e.ok){const s=await e.json().catch((()=>({})));throw new Error(s.message||"Failed to validate token")}return await e.json()},enabled:!!S,retry:!1}),K=r({mutationFn:async e=>{const s=await k("POST","/api/admin/auth/reset-password",e);if(!s.ok){const e=await s.json().catch((()=>({})));throw new Error(e.message||"Failed to reset password")}return await s.json()},onSuccess:e=>{Y(!0),z({title:"Admin password reset successful",description:e.message})},onError:e=>{z({title:"Error",description:e.message,variant:"destructive"})}});return s.useEffect((()=>{S||E("/admin/login")}),[S,E]),S?D?n.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100 py-12 px-4 sm:px-6 lg:px-8",children:n.jsx("div",{className:"max-w-md w-full space-y-8",children:n.jsx(i,{children:n.jsx(l,{className:"pt-6",children:n.jsxs("div",{className:"text-center",children:[n.jsx(d,{className:"mx-auto h-8 w-8 animate-spin text-blue-600"}),n.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Validating admin reset token..."})]})})})})}):G||!(null==M?void 0:M.valid)?n.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100 py-12 px-4 sm:px-6 lg:px-8",children:n.jsx("div",{className:"max-w-md w-full space-y-8",children:n.jsxs(i,{children:[n.jsxs(c,{className:"text-center",children:[n.jsx("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100",children:n.jsx(o,{className:"h-6 w-6 text-red-600"})}),n.jsx(m,{className:"mt-4 text-red-600",children:"Invalid Admin Reset Link"}),n.jsx(x,{children:"This admin password reset link is invalid or has expired."})]}),n.jsxs(l,{className:"space-y-4",children:[n.jsxs(h,{variant:"destructive",children:[n.jsx(o,{className:"h-4 w-4"}),n.jsx(u,{children:(null==G?void 0:G.message)||(null==M?void 0:M.message)||"The admin reset link is no longer valid."})]}),n.jsxs("div",{className:"text-center space-y-2",children:[n.jsx(w,{to:"/admin/forgot-password",children:n.jsx(j,{className:"w-full btn-brand-primary",variant:"brand",children:"Request new admin reset link"})}),n.jsxs(w,{to:"/admin/login",className:"inline-flex items-center text-sm text-blue-600 hover:text-blue-500",children:[n.jsx(p,{className:"mr-1 h-4 w-4"}),"Back to admin login"]})]})]})]})})}):I?n.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100 py-12 px-4 sm:px-6 lg:px-8",children:n.jsx("div",{className:"max-w-md w-full space-y-8",children:n.jsxs(i,{children:[n.jsxs(c,{className:"text-center",children:[n.jsx("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100",children:n.jsx(g,{className:"h-6 w-6 text-green-600"})}),n.jsx(m,{className:"mt-4 text-green-600",children:"Admin Password Reset Successful"}),n.jsx(x,{children:"Your admin password has been successfully reset. You can now log in with your new password."})]}),n.jsxs(l,{className:"space-y-4",children:[n.jsxs(h,{children:[n.jsx(v,{className:"h-4 w-4"}),n.jsx(u,{children:"Your admin password has been updated successfully. For security reasons, you'll need to log in again."})]}),n.jsx("div",{className:"text-center",children:n.jsx(w,{to:"/admin/login",children:n.jsx(j,{className:"w-full btn-brand-primary",variant:"brand",children:"Continue to admin login"})})})]})]})})}):n.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100 py-12 px-4 sm:px-6 lg:px-8",children:n.jsx("div",{className:"max-w-md w-full space-y-8",children:n.jsxs(i,{children:[n.jsxs(c,{className:"text-center",children:[n.jsx("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-blue-100",children:n.jsx(v,{className:"h-6 w-6 text-blue-600"})}),n.jsx(m,{className:"mt-4",children:"Reset Admin Password"}),n.jsx(x,{children:"Enter your new admin password below. Make sure it's at least 6 characters long."})]}),n.jsxs(l,{children:[n.jsxs("form",{onSubmit:e=>{e.preventDefault(),S?C.trim()&&q.trim()?C===q?C.length<6?z({title:"Error",description:"Password must be at least 6 characters long",variant:"destructive"}):K.mutate({token:S,newPassword:C,confirmPassword:q}):z({title:"Error",description:"Passwords do not match",variant:"destructive"}):z({title:"Error",description:"Please fill in all fields",variant:"destructive"}):z({title:"Error",description:"Invalid reset token",variant:"destructive"})},className:"space-y-4",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx(N,{htmlFor:"newPassword",children:"New admin password"}),n.jsxs("div",{className:"relative",children:[n.jsx(f,{id:"newPassword",type:R?"text":"password",placeholder:"Enter your new admin password",value:C,onChange:e=>F(e.target.value),required:!0,disabled:K.isPending,minLength:6}),n.jsx(j,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>A(!R),disabled:K.isPending,children:R?n.jsx(y,{className:"h-4 w-4"}):n.jsx(b,{className:"h-4 w-4"})})]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(N,{htmlFor:"confirmPassword",children:"Confirm new admin password"}),n.jsxs("div",{className:"relative",children:[n.jsx(f,{id:"confirmPassword",type:T?"text":"password",placeholder:"Confirm your new admin password",value:q,onChange:e=>L(e.target.value),required:!0,disabled:K.isPending,minLength:6}),n.jsx(j,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>B(!T),disabled:K.isPending,children:T?n.jsx(y,{className:"h-4 w-4"}):n.jsx(b,{className:"h-4 w-4"})})]})]}),C&&q&&C!==q&&n.jsxs(h,{variant:"destructive",children:[n.jsx(o,{className:"h-4 w-4"}),n.jsx(u,{children:"Passwords do not match"})]}),n.jsxs(h,{children:[n.jsx(v,{className:"h-4 w-4"}),n.jsx(u,{children:"This will reset your admin account password. Make sure to use a strong, secure password."})]}),n.jsxs(j,{type:"submit",className:"w-full btn-brand-primary",variant:"brand",disabled:K.isPending||C!==q,children:[K.isPending&&n.jsx(d,{className:"mr-2 h-4 w-4 animate-spin"}),"Reset admin password"]})]}),n.jsx("div",{className:"mt-6 text-center",children:n.jsxs(w,{to:"/admin/login",className:"inline-flex items-center text-sm text-blue-600 hover:text-blue-500",children:[n.jsx(p,{className:"mr-1 h-4 w-4"}),"Back to admin login"]})})]})]})})}):null}export{P as default};
