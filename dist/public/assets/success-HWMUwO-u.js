import{e,f as s,r as a,i as t,j as n,C as i,a as r,b as c,l,c as d,L as o,o as m,k as u,aL as x,B as p,d as y}from"./index-hDnRHjz5.js";function f(){const[f,j]=e(),{toast:h}=s(),[v,N]=a.useState(!0),[g,b]=a.useState(!1),[P,w]=a.useState(null),S=new URLSearchParams(window.location.search),I=S.get("source"),F=S.get("transaction_id"),k=S.get("session_id"),Y=S.get("id"),C=S.get("status"),D=S.get("message"),E=t({mutationFn:async()=>{if(!F)return null;const e={transactionId:F,source:I||"stripe"};"moyasar"===I&&Y?e.paymentId=Y:k&&(e.session_id=k);const s=await y("POST","/api/payment/verify",e);if(!s.ok){const e=await s.json();throw new Error(e.error||"Failed to verify payment")}return s.json()},onSuccess:e=>{b(!0),N(!1),w(e),h({title:"Payment Successful",description:"Your subscription has been activated successfully."})},onError:e=>{b(!1),N(!1),h({title:"Payment Verification Failed",description:e.message,variant:"destructive"})}});return a.useEffect((()=>{"moyasar"===I&&C&&Y?"paid"===C?(b(!0),N(!1),w({paymentId:Y,status:C,message:D,source:I}),h({title:"Payment Successful",description:D||"Your payment has been processed successfully."}),F&&E.mutate()):(b(!1),N(!1),w({paymentId:Y,status:C,message:D,source:I}),h({title:"Payment Failed",description:D||"Your payment could not be processed.",variant:"destructive"})):"stripe"===I&&k||F?E.mutate():(b(!1),N(!1),h({title:"Payment Verification Failed",description:"Missing payment information. Please contact support if you completed a payment.",variant:"destructive"}))}),[F,I,C,Y,D,k]),n.jsx("div",{className:"container max-w-md py-12",children:n.jsxs(i,{children:[n.jsxs(r,{className:"text-center",children:[n.jsx(c,{className:"text-2xl",children:v?"Payment Processing":g?"Payment Successful":"failed"===(null==P?void 0:P.status)||"failed"===C?"Payment Failed":"Payment Verification Failed"}),n.jsx(l,{children:v?"We're verifying your payment...":g?"Your subscription has been activated successfully.":"failed"===(null==P?void 0:P.status)||"failed"===C?(null==P?void 0:P.message)||D||"Your payment could not be processed. Please try again.":"We couldn't verify your payment. Please contact support."})]}),n.jsxs(d,{className:"space-y-6",children:[n.jsx("div",{className:"flex justify-center py-6",children:v?n.jsx(o,{className:"h-16 w-16 animate-spin text-primary"}):g?n.jsx(m,{className:"h-16 w-16 text-green-500"}):n.jsx(u,{className:"h-16 w-16 text-red-500"})}),P&&n.jsx("div",{className:"space-y-3 text-sm",children:n.jsxs("div",{className:"border-t pt-4",children:[n.jsx("h3",{className:"font-medium text-center mb-3",children:"Payment Details"}),n.jsxs("div",{className:"space-y-2",children:[P.paymentId&&n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-muted-foreground",children:"Payment ID:"}),n.jsx("span",{className:"font-mono text-xs",children:P.paymentId})]}),F&&n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-muted-foreground",children:"Transaction ID:"}),n.jsx("span",{className:"font-mono text-xs",children:F})]}),P.source&&n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-muted-foreground",children:"Payment Method:"}),n.jsx("span",{className:"capitalize",children:P.source})]}),P.status&&n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-muted-foreground",children:"Status:"}),n.jsx("span",{className:"capitalize "+("paid"===P.status?"text-green-600":"failed"===P.status?"text-red-600":"text-amber-600"),children:P.status})]})]})]})})]}),n.jsxs(x,{className:"flex justify-center gap-4",children:[!g&&!v&&n.jsx(p,{variant:"outline",onClick:()=>j("/settings"),className:"btn-brand-primary",children:"Try Again"}),n.jsx(p,{variant:"outline",onClick:()=>j("/settings"),disabled:v,children:"Return to Settings"}),g&&n.jsx(p,{variant:"outline",className:"btn-brand-primary",onClick:()=>j("/inbox"),disabled:v,children:"Go to Inbox"})]})]})})}export{f as default};
