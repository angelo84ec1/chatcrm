import{m as e,e as s,r as a,f as t,j as n,C as i,a as r,b as c,g as l,c as d,L as o,p as m,o as u,a_ as x,B as p,d as y}from"./index-C_9oFDzq.js";function f(){const[f,j]=e(),{toast:h}=s(),[g,v]=a.useState(!0),[N,b]=a.useState(!1),[P,w]=a.useState(null),S=new URLSearchParams(window.location.search),I=S.get("source"),F=S.get("transaction_id"),Y=S.get("session_id"),k=S.get("id"),C=S.get("status"),_=S.get("message"),D=t({mutationFn:async()=>{if(!F)return null;const e={transactionId:F,source:I||"stripe"};"moyasar"===I&&k?e.paymentId=k:Y&&(e.session_id=Y);const s=await y("POST","/api/payment/verify",e);if(!s.ok){const e=await s.json();throw new Error(e.error||"Failed to verify payment")}return s.json()},onSuccess:e=>{b(!0),v(!1),w(e),h({title:"Payment Successful",description:"Your subscription has been activated successfully."})},onError:e=>{b(!1),v(!1),h({title:"Payment Verification Failed",description:e.message,variant:"destructive"})}});return a.useEffect((()=>{"moyasar"===I&&C&&k?"paid"===C?(b(!0),v(!1),w({paymentId:k,status:C,message:_,source:I}),h({title:"Payment Successful",description:_||"Your payment has been processed successfully."}),F&&D.mutate()):(b(!1),v(!1),w({paymentId:k,status:C,message:_,source:I}),h({title:"Payment Failed",description:_||"Your payment could not be processed.",variant:"destructive"})):"stripe"===I&&Y||F?D.mutate():(b(!1),v(!1),h({title:"Payment Verification Failed",description:"Missing payment information. Please contact support if you completed a payment.",variant:"destructive"}))}),[F,I,C,k,_,Y]),n.jsx("div",{className:"container max-w-md py-12",children:n.jsxs(i,{children:[n.jsxs(r,{className:"text-center",children:[n.jsx(c,{className:"text-2xl",children:g?"Payment Processing":N?"Payment Successful":"failed"===(null==P?void 0:P.status)||"failed"===C?"Payment Failed":"Payment Verification Failed"}),n.jsx(l,{children:g?"We're verifying your payment...":N?"Your subscription has been activated successfully.":"failed"===(null==P?void 0:P.status)||"failed"===C?(null==P?void 0:P.message)||_||"Your payment could not be processed. Please try again.":"We couldn't verify your payment. Please contact support."})]}),n.jsxs(d,{className:"space-y-6",children:[n.jsx("div",{className:"flex justify-center py-6",children:g?n.jsx(o,{className:"h-16 w-16 animate-spin text-primary"}):N?n.jsx(m,{className:"h-16 w-16 text-green-500"}):n.jsx(u,{className:"h-16 w-16 text-red-500"})}),P&&n.jsx("div",{className:"space-y-3 text-sm",children:n.jsxs("div",{className:"border-t pt-4",children:[n.jsx("h3",{className:"font-medium text-center mb-3",children:"Payment Details"}),n.jsxs("div",{className:"space-y-2",children:[P.paymentId&&n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-muted-foreground",children:"Payment ID:"}),n.jsx("span",{className:"font-mono text-xs",children:P.paymentId})]}),F&&n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-muted-foreground",children:"Transaction ID:"}),n.jsx("span",{className:"font-mono text-xs",children:F})]}),P.source&&n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-muted-foreground",children:"Payment Method:"}),n.jsx("span",{className:"capitalize",children:P.source})]}),P.status&&n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-muted-foreground",children:"Status:"}),n.jsx("span",{className:"capitalize "+("paid"===P.status?"text-green-600":"failed"===P.status?"text-red-600":"text-amber-600"),children:P.status})]})]})]})})]}),n.jsxs(x,{className:"flex justify-center gap-4",children:[!N&&!g&&n.jsx(p,{variant:"outline",onClick:()=>j("/settings"),className:"btn-brand-primary",children:"Try Again"}),n.jsx(p,{variant:"outline",onClick:()=>j("/settings"),disabled:g,children:"Return to Settings"}),N&&n.jsx(p,{variant:"outline",className:"btn-brand-primary",onClick:()=>j("/inbox"),disabled:g,children:"Go to Inbox"})]})]})})}export{f as default};
